{"version":3,"sources":["webpack://sitecore/./node_modules/ts-debounce/dist/src/index.esm.js","webpack://sitecore/./stellaris/backgroundgen.ts"],"names":["r","e","n","i","t","o","a","isImmediate","u","callback","c","maxWait","v","Date","now","l","f","d","slice","call","arguments","this","Promise","clearTimeout","setTimeout","apply","forEach","resolve","push","reject","cancel","STARFIELD_SIZE","addImage","elem","img","ix","iy","iw","ih","star","div","document","createElement","className","setAttribute","style","position","top","toString","left","width","height","appendChild","x","y","modifyImageLocational","svgimg","createElementNS","setAttributeNS","connectStars","other","connections","includes","line","STAR_SIZE","Math","random","computeControlPoints","K","length","p1","p2","Array","b","m","setPageBackground","body","html","documentElement","rh","max","offsetHeight","clientHeight","window","innerHeight","rw","innerWidth","clientWidth","console","log","k","dd","cols","ceil","rows","stars","dx","dy","posX","posY","entry","image","cx","cy","index","alera","meiza","reylana","freyskol","lanka","w","h","region","edges","borderDistance","next","isAleran","angle","atan2","isAleranBorder","sort","points","cpX","map","p","cpY","start","data","cp1","cp2","svg","path","drawSpline","generateTerritory","tag","container","getElementById","id","prepend","firstChild","removeChild","addEventListener"],"mappings":"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","file":"638.bundle.js","sourcesContent":["function r(r,e,n){var i,t,o;void 0===e&&(e=50),void 0===n&&(n={});var a=null!=(i=n.isImmediate)&&i,u=null!=(t=n.callback)&&t,c=n.maxWait,v=Date.now(),l=[];function f(){if(void 0!==c){var r=Date.now()-v;if(r+e>=c)return c-r}return e}var d=function(){var e=[].slice.call(arguments),n=this;return new Promise(function(i,t){var c=a&&void 0===o;if(void 0!==o&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,v=Date.now(),!a){var i=r.apply(n,e);u&&u(i),l.forEach(function(r){return(0,r.resolve)(i)}),l=[]}},f()),c){var d=r.apply(n,e);return u&&u(d),i(d)}l.push({resolve:i,reject:t})})};return d.cancel=function(r){void 0!==o&&clearTimeout(o),l.forEach(function(e){return(0,e.reject)(r)}),l=[]},d}export{r as debounce};\n//# sourceMappingURL=index.esm.js.map\n","const STARFIELD_SIZE = 2048;\r\nconst STAR_SIZE = 32;\r\nimport { debounce } from \"ts-debounce\";\r\nimport { xmas, viskey, visval, xkey, ykey, hkey, wkey, getRandomBetween, getOrCreateImgPath, getArrayIndex, svgNamespace } from '../library';\r\nimport { isPhone } from '../browser';\r\nfunction addImage(elem, img, ix, iy, iw, ih, star) {\r\n    if (star) {\r\n        //injectAtlasNode(elem, ix, iy, \"stellaris\", img, STAR_SIZE, STAR_SIZE, \"screen\");\r\n        let div = document.createElement(\"div\");\r\n        div.className = \"tile-stellaris-\" + img;\r\n        div.setAttribute(\"style\", \"mix-blend-mode: screen;\");\r\n        div.style.position = \"absolute\";\r\n        div.style.top = iy.toString() + \"px\";\r\n        div.style.left = ix.toString() + \"px\";\r\n        div.style.width = iw.toString() + \"px\";\r\n        div.style.height = ih.toString() + \"px\";\r\n        elem.appendChild(div);\r\n    }\r\n    else {\r\n        img = modifyImageLocational(ix, iy, img);\r\n        //var pre = '<image x=\"'+ix+'\" y=\"'+iy+'\" width=\"'+iw+'\" height=\"'+ih+'\" xlink:href=\"'+getImageRoot();\r\n        //var post = '.png\" />';\r\n        //return pre+img+post;\r\n        var svgimg = document.createElementNS('http://www.w3.org/2000/svg', 'image');\r\n        svgimg.setAttributeNS(null, wkey, iw.toString());\r\n        svgimg.setAttributeNS(null, hkey, ih.toString());\r\n        svgimg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', getOrCreateImgPath(img, \"stellaris\"));\r\n        svgimg.setAttributeNS(null, xkey, ix.toString());\r\n        svgimg.setAttributeNS(null, ykey, iy.toString());\r\n        svgimg.setAttributeNS(null, viskey, visval);\r\n        elem.appendChild(svgimg);\r\n    }\r\n}\r\nfunction modifyImageLocational(x, y, img) {\r\n    return img;\r\n}\r\nfunction connectStars(elem, star, other) {\r\n    if (star.connections.includes(other)) {\r\n        if (!other.connections.includes(star)) {\r\n            other.connections.push(star);\r\n        }\r\n        return;\r\n    }\r\n    var line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\r\n    line.setAttributeNS(null, \"x1\", (star.x + STAR_SIZE / 2).toString());\r\n    line.setAttributeNS(null, \"y1\", (star.y + STAR_SIZE / 2).toString());\r\n    line.setAttributeNS(null, \"x2\", (other.x + STAR_SIZE / 2).toString());\r\n    line.setAttributeNS(null, \"y2\", (other.y + STAR_SIZE / 2).toString());\r\n    line.setAttributeNS(null, \"stroke\", \"rgb(0, 212, 255)\");\r\n    if (xmas) {\r\n        if (Math.random() < 0.5)\r\n            line.setAttributeNS(null, \"stroke\", \"rgb(255, 0, 0)\");\r\n        else\r\n            line.setAttributeNS(null, \"stroke\", \"rgb(0, 192, 0)\");\r\n    }\r\n    line.setAttributeNS(null, \"stroke-width\", \"2\");\r\n    line.setAttributeNS(null, \"style\", \"mix-blend-mode: screen;\");\r\n    elem.appendChild(line);\r\n    star.connections.push(other);\r\n    other.connections.push(star);\r\n}\r\nfunction generateTerritory(elem, w, h, stars, alera) {\r\n    let region = [];\r\n    let edges = [];\r\n    region.push(alera);\r\n    alera.borderDistance = -1;\r\n    var n = getRandomBetween(4, 9);\r\n    for (var i = 0; i < n; i++) {\r\n        //console.log(i+\"/\"+n+\": \");\r\n        let next = [];\r\n        for (var k = 0; k < region.length; k++) {\r\n            let star = region[k];\r\n            if (typeof star.connections !== 'undefined' && star.connections.length > 0) {\r\n                for (var a = 0; a < star.connections.length; a++) {\r\n                    let other = star.connections[a];\r\n                    if (!region.includes(other) && !next.includes(other)) {\r\n                        next.push(other);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        //console.log(next);\r\n        for (var k = 0; k < next.length; k++) {\r\n            region.push(next[k]);\r\n            next[k].borderDistance = i;\r\n            next[k].isAleran = true;\r\n        }\r\n    }\r\n    for (var i = 0; i < region.length; i++) {\r\n        var star = region[i];\r\n        if (typeof star.connections !== 'undefined' && star.connections.length > 0) {\r\n            //console.log(star);\r\n            //console.log(star.connections);\r\n            for (var k = 0; k < star.connections.length; k++) {\r\n                var other = star.connections[k];\r\n                if (!region.includes(other)) {\r\n                    let entry = { x: (star.x + other.x + STAR_SIZE) / 2, y: (star.y + other.y + STAR_SIZE) / 2 };\r\n                    entry.angle = Math.atan2(entry.y - STAR_SIZE / 2 - alera.y, entry.x - STAR_SIZE / 2 - alera.x);\r\n                    edges.push(entry);\r\n                    star.isAleranBorder = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    edges.sort((a, b) => a.angle - b.angle);\r\n    //console.log(edges);\r\n    //console.log(region);\r\n    var points = edges;\r\n    var cpX = computeControlPoints(points.map(p => p.x));\r\n    var cpY = computeControlPoints(points.map(p => p.y));\r\n    var start = points[0];\r\n    var data = \"M\" + start.x + \" \" + start.y;\r\n    for (var i = 0, l = points.length - 1; i < l; i++) {\r\n        var cp1 = { x: cpX.p1[i], y: cpY.p1[i] };\r\n        var cp2 = { x: cpX.p2[i], y: cpY.p2[i] };\r\n        //drawSpline(elem, points[i], cp1, cp2, points[i + 1])\r\n        //data = data+\" L \"+points[i].x+\" \"+points[i].y;\r\n        data = data + \" C \" + cp1.x + \" \" + cp1.y + \" \" + cp2.x + \" \" + cp2.y + \" \" + points[i + 1].x + \" \" + points[i + 1].y;\r\n    }\r\n    data = data + \" Z\";\r\n    drawSpline(elem, data);\r\n    addImage(elem, \"aleran\", alera.x - 128, alera.y - 128, 256, 256, false);\r\n}\r\n//Credit to https://jsfiddle.net/prafuitu/8m2n5qg6/\r\nfunction computeControlPoints(K) {\r\n    if (K.length == 2) {\r\n        return {\r\n            p1: [K[0]],\r\n            p2: [K[1]]\r\n        };\r\n    }\r\n    let p1 = new Array();\r\n    let p2 = new Array();\r\n    let n = K.length - 1;\r\n    /*rhs vector*/\r\n    let a = new Array();\r\n    let b = new Array();\r\n    let c = new Array();\r\n    let r = new Array();\r\n    /*left most segment*/\r\n    a[0] = 0;\r\n    b[0] = 2;\r\n    c[0] = 1;\r\n    r[0] = K[0] + 2 * K[1];\r\n    /*internal segments*/\r\n    for (var i = 1; i < n - 1; i++) {\r\n        a[i] = 1;\r\n        b[i] = 4;\r\n        c[i] = 1;\r\n        r[i] = 4 * K[i] + 2 * K[i + 1];\r\n    }\r\n    /*right segment*/\r\n    a[n - 1] = 2;\r\n    b[n - 1] = 7;\r\n    c[n - 1] = 0;\r\n    r[n - 1] = 8 * K[n - 1] + K[n];\r\n    /*solves Ax=b with the Thomas algorithm (from Wikipedia)*/\r\n    for (var i = 1; i < n; i++) {\r\n        var m = a[i] / b[i - 1];\r\n        b[i] = b[i] - m * c[i - 1];\r\n        r[i] = r[i] - m * r[i - 1];\r\n    }\r\n    p1[n - 1] = r[n - 1] / b[n - 1];\r\n    for (i = n - 2; i >= 0; --i)\r\n        p1[i] = (r[i] - c[i] * p1[i + 1]) / b[i];\r\n    /*we have p1, now compute p2*/\r\n    for (var i = 0; i < n - 1; i++)\r\n        p2[i] = 2 * K[i + 1] - p1[i + 1];\r\n    p2[n - 1] = 0.5 * (K[n] + p1[n - 1]);\r\n    return { p1: p1, p2: p2 };\r\n}\r\nfunction drawSpline(svg, data) {\r\n    var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n    path.setAttributeNS(null, 'stroke', \"#785FB6\");\r\n    path.setAttributeNS(null, 'stroke-width', \"15\"); //was 5\r\n    path.setAttributeNS(null, 'fill', \"#785FB6\");\r\n    path.setAttributeNS(null, 'fill-opacity', \"0.4\");\r\n    path.setAttributeNS(null, 'stroke-opacity', \"0.85\");\r\n    path.setAttributeNS(null, 'd', data);\r\n    svg.appendChild(path);\r\n}\r\nexport default function setPageBackground() {\r\n    if (isPhone)\r\n        return;\r\n    //var height = findHighestNode(0, document.documentElement.childNodes);\r\n    let body = document.body;\r\n    let html = document.documentElement;\r\n    var rh = Math.max(body.offsetHeight, html.clientHeight, html.offsetHeight, window.innerHeight, document.body.clientHeight);\r\n    var rw = Math.max(window.innerWidth, document.body.clientWidth);\r\n    //console.log(rw+\" x \"+rh);\r\n    console.log(\"Generating stellaris galaxy map background\");\r\n    let elem = document.createElementNS(svgNamespace, \"svg\");\r\n    elem.setAttributeNS(null, \"width\", rw.toString());\r\n    elem.setAttributeNS(null, \"height\", rh.toString());\r\n    for (var i = 0; i < rw; i += STARFIELD_SIZE) {\r\n        for (var k = 0; k < rh; k += STARFIELD_SIZE) {\r\n            addImage(elem, \"starfield\", i, k, STARFIELD_SIZE, STARFIELD_SIZE, false);\r\n        }\r\n    }\r\n    let dStar = STAR_SIZE * 3;\r\n    let dd = STAR_SIZE * 1.35;\r\n    let cols = Math.ceil(rw / dStar);\r\n    let rows = Math.ceil(rh / dStar);\r\n    let stars = new Array(cols * rows);\r\n    for (var i = 0; i < cols; i++) {\r\n        for (var k = 0; k < rows; k++) {\r\n            var dx = (i + 0.5) * dStar;\r\n            var dy = (k + 0.5) * dStar;\r\n            var posX = getRandomBetween(dx - dd, dx + dd);\r\n            var posY = getRandomBetween(dy - dd, dy + dd);\r\n            var img = \"\";\r\n            var f = Math.random();\r\n            if (f < 0.04)\r\n                img = \"hole\";\r\n            else if (f < 0.1)\r\n                img = \"pulsar\";\r\n            else if (f < 0.15)\r\n                img = \"neutron\";\r\n            else\r\n                img = \"star\" + getRandomBetween(0, 7);\r\n            var entry = { image: img, x: posX, y: posY, cx: i, cy: k, index: getArrayIndex(cols, i, k), connections: [] };\r\n            stars[entry.index] = entry;\r\n        }\r\n    }\r\n    let alera = stars[getArrayIndex(cols, getRandomBetween(4, cols - 4), getRandomBetween(4, rows - 4))];\r\n    for (var i = 0; i < stars.length; i++) {\r\n        var star = stars[i];\r\n        if (star.cx > 0 && Math.random() < 0.33) {\r\n            var other = stars[getArrayIndex(cols, star.cx - 1, star.cy)];\r\n            if (other.connections.length < 3)\r\n                connectStars(elem, star, other);\r\n        }\r\n        if (star.cy > 0 && Math.random() < 0.33) {\r\n            var other = stars[getArrayIndex(cols, star.cx, star.cy - 1)];\r\n            if (other.connections.length < 3)\r\n                connectStars(elem, star, other);\r\n        }\r\n    }\r\n    for (var i = 0; i < stars.length; i++) {\r\n        var star = stars[i];\r\n        if (star.connections.length == 0) {\r\n            //console.log(\"unconnected star: \"+star)\r\n        }\r\n        if (star == alera) {\r\n            connectStars(elem, star, stars[getArrayIndex(cols, star.cx - 1, star.cy)]);\r\n            connectStars(elem, star, stars[getArrayIndex(cols, star.cx + 1, star.cy)]);\r\n            connectStars(elem, star, stars[getArrayIndex(cols, star.cx, star.cy - 1)]);\r\n            connectStars(elem, star, stars[getArrayIndex(cols, star.cx, star.cy + 1)]);\r\n            star.meiza = star.connections[getRandomBetween(0, 3)];\r\n            star.reylana = star.meiza;\r\n            while (star.reylana == star.meiza)\r\n                star.reylana = star.connections[getRandomBetween(0, 3)];\r\n            star.freyskol = star.meiza;\r\n            while (star.freyskol == star.meiza || star.freyskol == star.reylana)\r\n                star.freyskol = star.connections[getRandomBetween(0, 3)];\r\n            star.lanka = star.meiza;\r\n            while (star.lanka == star.meiza || star.lanka == star.reylana || star.lanka == star.freyskol)\r\n                star.lanka = star.connections[getRandomBetween(0, 3)];\r\n        }\r\n        if (star.cx > 0) {\r\n            var other = stars[getArrayIndex(cols, star.cx - 1, star.cy)];\r\n            connectStars(elem, star, other);\r\n        }\r\n        else if (star.cy > 0) {\r\n            var other = stars[getArrayIndex(cols, star.cx, star.cy - 1)];\r\n            connectStars(elem, star, other);\r\n        }\r\n        else if (Math.random() < 0.33) {\r\n            var other = stars[getArrayIndex(cols, star.cx + 1, star.cy)];\r\n            connectStars(elem, star, other);\r\n        }\r\n        else {\r\n            var other = stars[getArrayIndex(cols, star.cx, star.cy + 1)];\r\n            connectStars(elem, star, other);\r\n        }\r\n    }\r\n    alera.meiza.image = \"pulsar\";\r\n    alera.reylana.image = \"star1\";\r\n    alera.freyskol.image = \"star6\";\r\n    alera.lanka.image = \"star4\";\r\n    alera.image = \"star0\";\r\n    generateTerritory(elem, rw, rh, stars, alera);\r\n    let tag = \"background-content\";\r\n    let container = document.getElementById(tag);\r\n    if (container == null) {\r\n        container = document.createElement(\"div\");\r\n        container.id = tag;\r\n        console.log(\"Injecting background element.\");\r\n        document.body.prepend(container);\r\n    }\r\n    while (container.firstChild) {\r\n        container.removeChild(container.firstChild);\r\n    }\r\n    //console.log(elem);\r\n    container.appendChild(elem);\r\n    elem = document.createElement(\"div\");\r\n    elem.id = \"bcg-stars\";\r\n    elem.style.position = \"absolute\";\r\n    elem.style.width = rw.toString() + \"px\";\r\n    elem.style.height = rh.toString() + \"px\";\r\n    for (var i = 0; i < stars.length; i++) {\r\n        var star = stars[i];\r\n        addImage(elem, star.image, star.x, star.y, STAR_SIZE, STAR_SIZE, true);\r\n    }\r\n    container.appendChild(elem);\r\n    container.style.width = rw.toString() + \"px\";\r\n    container.style.height = rh.toString() + \"px\";\r\n}\r\nwindow.addEventListener('resize', debounce(setPageBackground, 100));\r\n"],"sourceRoot":""}