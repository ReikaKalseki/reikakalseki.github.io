{"version":3,"sources":["webpack://sitecore/./node_modules/ts-debounce/dist/src/index.esm.js","webpack://sitecore/./p2/backgroundgen.ts"],"names":["r","e","n","i","t","o","a","isImmediate","u","callback","c","maxWait","v","Date","now","l","f","d","slice","call","arguments","this","Promise","clearTimeout","setTimeout","apply","forEach","resolve","push","reject","cancel","addImageToRow","elem","img","tile","document","createElement","className","appendChild","addImageToTile","x","y","w","h","added","style","position","top","toString","left","width","height","modifyImageLocational","rows","cols","terrain","idx","placePortalSurface","blocks","blue","orange","x2","Math","min","y2","k","tex","random","addBlock","generateBeam","type","dx","dy","length","setPageBackground","body","html","documentElement","rh","max","offsetHeight","clientHeight","window","innerHeight","rw","innerWidth","clientWidth","ceil","console","log","Array","ret","placeTestElements","tag","container","getElementById","id","prepend","firstChild","removeChild","display","lasers","row","imgs","add","startsWith","element","flakes","m","buildImage","addEventListener"],"mappings":"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","file":"647.bundle.js","sourcesContent":["function r(r,e,n){var i,t,o;void 0===e&&(e=50),void 0===n&&(n={});var a=null!=(i=n.isImmediate)&&i,u=null!=(t=n.callback)&&t,c=n.maxWait,v=Date.now(),l=[];function f(){if(void 0!==c){var r=Date.now()-v;if(r+e>=c)return c-r}return e}var d=function(){var e=[].slice.call(arguments),n=this;return new Promise(function(i,t){var c=a&&void 0===o;if(void 0!==o&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,v=Date.now(),!a){var i=r.apply(n,e);u&&u(i),l.forEach(function(r){return(0,r.resolve)(i)}),l=[]}},f()),c){var d=r.apply(n,e);return u&&u(d),i(d)}l.push({resolve:i,reject:t})})};return d.cancel=function(r){void 0!==o&&clearTimeout(o),l.forEach(function(e){return(0,e.reject)(r)}),l=[]},d}export{r as debounce};\n//# sourceMappingURL=index.esm.js.map\n","const SCALE = 1;\r\nimport { debounce } from \"ts-debounce\";\r\nimport { xmas, getRandomBetween, getArrayIndex, fitBCG, isDarkModeEnabled } from '../library';\r\nimport { isPhone } from '../browser';\r\nfunction addImageToRow(elem, img) {\r\n    let tile = document.createElement('div');\r\n    tile.className = \"tile-p2-\" + img;\r\n    elem.appendChild(tile);\r\n    return tile;\r\n}\r\nfunction addImageToTile(elem, img, x, y, w, h) {\r\n    let added = addImageToRow(elem, img);\r\n    added.style.position = \"absolute\";\r\n    added.style.top = y.toString() + \"px\";\r\n    added.style.left = x.toString() + \"px\";\r\n    added.style.width = w.toString() + \"px\";\r\n    added.style.height = h.toString() + \"px\";\r\n}\r\nfunction buildImage(elem, rows, cols, terrain, blocks) {\r\n    var w = 128 * SCALE;\r\n    var h = 128 * SCALE;\r\n    var x = 0;\r\n    var y = 0;\r\n    var lasers = [];\r\n    for (var k = 0; k < rows; k++) {\r\n        x = 0;\r\n        let row = document.createElement(\"div\");\r\n        for (var i = 0; i < cols; i++) {\r\n            let idx = getArrayIndex(cols, i, k);\r\n            let imgs = blocks[idx];\r\n            let add = row;\r\n            add = addImageToRow(add, terrain[idx]);\r\n            if (isDarkModeEnabled()) {\r\n                add = addImageToRow(add, \"dark\");\r\n            }\r\n            if (imgs.length != 1 || imgs[0] != \"air\") {\r\n                //console.log(\"Got \"+img+\" @ \"+i+\", \"+k);\r\n                for (var n = 0; n < imgs.length; n++) {\r\n                    var img = imgs[n];\r\n                    if (img != \"air\") {\r\n                        img = modifyImageLocational(rows, cols, terrain, i, k, idx, img);\r\n                        add = addImageToRow(add, img);\r\n                        if (xmas && img.startsWith(\"laser\")) {\r\n                            lasers.push({ element: add, x: x, y: y });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            x += w;\r\n        }\r\n        elem.appendChild(row);\r\n        y += h;\r\n    }\r\n    for (var i = 0; i < lasers.length; i++) {\r\n        let tile = lasers[i];\r\n        var flakes = getRandomBetween(4, 9);\r\n        for (var m = 0; m < flakes; m++) {\r\n            addImageToTile(tile.element, \"laser_snow\", getRandomBetween(tile.x - 36, tile.x + w - 12), getRandomBetween(tile.y - 36, tile.y + h - 12), 48 * SCALE, 48 * SCALE);\r\n        }\r\n    }\r\n    fitBCG(elem, SCALE);\r\n}\r\nfunction getRandomTileAt(x, y, rows) {\r\n    return \"black\" + getRandomBetween(0, 15);\r\n}\r\nfunction modifyImageLocational(rows, cols, terrain, x, y, idx, img) {\r\n    return img;\r\n}\r\nfunction placePortalSurface(terrain, blocks, rows, cols, blue, orange) {\r\n    var w = getRandomBetween(1, 6);\r\n    var h = getRandomBetween(1, 3);\r\n    var x = getRandomBetween(0, cols - 1);\r\n    var y = getRandomBetween(0, rows - 1);\r\n    var x2 = Math.min(x + w, cols);\r\n    var y2 = Math.min(y + h, rows);\r\n    for (var i = x; i < x2; i++) {\r\n        for (var k = y; k < y2; k++) {\r\n            var tex = \"white\" + getRandomBetween(0, 3);\r\n            var idx = getArrayIndex(cols, i, k);\r\n            terrain[idx] = tex;\r\n            if (blue && Math.random() < 0.1) {\r\n                addBlock(blocks, idx, \"portal_b\");\r\n                blue = false;\r\n            }\r\n            else if (orange && Math.random() < 0.1) {\r\n                addBlock(blocks, idx, \"portal_o\");\r\n                orange = false;\r\n            }\r\n        }\r\n    }\r\n    return [blue, orange];\r\n}\r\nfunction placeTestElements(blocks, rows, cols) {\r\n    for (var i = 1; i < rows - 1; i++) {\r\n        if (Math.random() < 0.1) {\r\n            generateBeam(blocks, rows, cols, 0, i);\r\n        }\r\n    }\r\n    for (var i = 1; i < cols - 1; i++) {\r\n        if (Math.random() < 0.1) {\r\n            generateBeam(blocks, rows, cols, i, 0);\r\n        }\r\n    }\r\n}\r\nfunction generateBeam(blocks, rows, cols, x, y) {\r\n    var type = Math.random() < 0.5 ? (Math.random() < 0.5 ? \"lightbridge\" : \"laser\") : (xmas ? \"funnel_xmas\" : (Math.random() < 0.35 ? \"funnel_o\" : \"funnel\"));\r\n    var dx = (x == 0 ? 1 : 0);\r\n    var dy = 1 - dx;\r\n    type = type + (dx == 0 ? \"_v\" : \"_h\");\r\n    while (x < cols && y < rows) {\r\n        addBlock(blocks, getArrayIndex(cols, x, y), type);\r\n        x += dx;\r\n        y += dy;\r\n    }\r\n}\r\nfunction addBlock(blocks, idx, img) {\r\n    if (blocks[idx].length == 1 && blocks[idx][0] == \"air\") {\r\n        blocks[idx] = [];\r\n    }\r\n    blocks[idx].push(img);\r\n}\r\nexport default function setPageBackground() {\r\n    if (isPhone)\r\n        return;\r\n    let w = 128 * SCALE;\r\n    let h = 128 * SCALE;\r\n    let x = 0;\r\n    let y = 0;\r\n    //var height = findHighestNode(0, document.documentElement.childNodes);\r\n    let body = document.body;\r\n    let html = document.documentElement;\r\n    var rh = Math.max(body.offsetHeight, html.clientHeight, html.offsetHeight, window.innerHeight, document.body.clientHeight);\r\n    var rw = Math.max(window.innerWidth, document.body.clientWidth);\r\n    //console.log(rw+\" x \"+rh);\r\n    let rows = Math.ceil(rh / h);\r\n    let cols = Math.ceil(rw / w);\r\n    let tw = cols * w;\r\n    let th = rows * h;\r\n    console.log(\"Generating portal tileset with \" + cols + \" columns and \" + rows + \" rows\");\r\n    let terrain = new Array(cols * rows);\r\n    let blocks = new Array(cols * rows);\r\n    for (var i = 0; i < cols; i++) {\r\n        for (var k = 0; k < rows; k++) {\r\n            var img = getRandomTileAt(i, k, rows);\r\n            var idx = getArrayIndex(cols, i, k);\r\n            terrain[idx] = img;\r\n            blocks[idx] = [\"air\"];\r\n        }\r\n    }\r\n    let blue = true;\r\n    let orange = true;\r\n    for (var i = 0; i < rows / 4; i++) {\r\n        var ret = placePortalSurface(terrain, blocks, rows, cols, blue, orange);\r\n        blue = ret[0];\r\n        orange = ret[1];\r\n    }\r\n    placeTestElements(blocks, rows, cols);\r\n    let tag = \"background-content\";\r\n    let container = document.getElementById(tag);\r\n    if (container == null) {\r\n        container = document.createElement(\"div\");\r\n        container.id = tag;\r\n        console.log(\"Injecting background element.\");\r\n        document.body.prepend(container);\r\n    }\r\n    while (container.firstChild) {\r\n        container.removeChild(container.firstChild);\r\n    }\r\n    let elem = document.createElement(\"div\");\r\n    container.appendChild(elem);\r\n    elem.className = \"tile-layer\";\r\n    container.style.width = rw.toString() + \"px\";\r\n    container.style.height = rh.toString() + \"px\";\r\n    container.style.display = \"block\";\r\n    //console.log(elem);\r\n    buildImage(elem, rows, cols, terrain, blocks);\r\n}\r\nwindow.addEventListener('resize', debounce(setPageBackground, 100));\r\n"],"sourceRoot":""}