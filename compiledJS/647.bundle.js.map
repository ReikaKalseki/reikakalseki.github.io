{"version":3,"sources":["webpack://sitecore/./browser.ts","webpack://sitecore/./library.ts","webpack://sitecore/./p2/backgroundgen.ts"],"names":["isPhone","document","addEventListener","imgs","getElementsByClassName","length","img","par","parentNode","tagName","put","createElement","innerHTML","src","replaceChild","className","url","replace","console","log","text","i","style","width","header","navbar","getElementById","insertBefore","nextSibling","toc","removeChild","collapseOnPhone","root","date","Date","time","getSeconds","month","getMonth","day","getDate","xmas","hallow","viskey","visval","xkey","ykey","hkey","wkey","tileWidth","tileHeight","tileWidthNum","tileHeightNum","imagePaths","getRandomBetween","min","max","Math","floor","random","getRandomDecimalBetween","getOrCreateImgPath","folder","folderName","ret","window","location","href","idx","indexOf","levels","substring","split","getImageRoot","getTileWidth","iw","toString","getTileHeight","ih","getArrayIndex","cols","x","y","addImage","elem","ix","iy","svgimg","createElementNS","setAttributeNS","startsWith","appendChild","modifyImageLocational","rows","terrain","placePortalSurface","blocks","blue","orange","w","h","x2","y2","k","tex","addBlock","generateBeam","type","dx","dy","push","setPageBackground","body","html","documentElement","height","scrollHeight","offsetHeight","clientHeight","titleImg","rh","innerHeight","rw","innerWidth","clientWidth","ceil","tw","th","Array","placeTestElements","lasers","n","tile","flakes","m","buildImage","tag","container","id","prepend","firstChild"],"mappings":"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","file":"647.bundle.js","sourcesContent":["export const isPhone = checkMobile();\r\nfunction checkMobile() {\r\n    return false;\r\n}\r\nfunction collapseOnPhone() {\r\n    if (isPhone) {\r\n        var imgs = document.getElementsByClassName(\"deembed-media\");\r\n        while (imgs.length > 0) {\r\n            let img = imgs[0];\r\n            let par = img.parentNode;\r\n            //console.log(img.src+\" @ \"+par.tagName);\r\n            if (par.tagName == \"VIDEO\") {\r\n                let put = document.createElement(\"div\");\r\n                put.innerHTML = '<a href = \"' + img.src + '\">' + img.src + \"</a>\";\r\n                par.parentNode.replaceChild(put, par);\r\n            }\r\n            else {\r\n                //par.replaceChild(put, img);\r\n                if (par.className == \"video\") {\r\n                    var url = img.src.replace(\"embed/\", \"watch?v=\");\r\n                    par.innerHTML = '<a href = \"' + url + '\">' + url + \"</a>\";\r\n                }\r\n                else if (par.className != \"header-image\")\r\n                    par.innerHTML = img.src + \"<br>\";\r\n                else\r\n                    par.innerHTML = \"\";\r\n            }\r\n            console.log(\"Hiding media '\" + img.src + \"'\");\r\n        }\r\n        var text = document.getElementsByClassName(\"textarea\");\r\n        for (var i = 0; i < text.length; i++) {\r\n            text[i].style.width = \"33%\";\r\n        }\r\n        let header = document.createElement(\"div\");\r\n        header.innerHTML = \"<div style = 'text-align: center; width: 33%; margin: auto; border: 3px solid red;'><h2 style = 'color: red; margin: 12px;'>This site is not designed for use on phones and other handheld devices, nor is any of its content relevant on such platforms. You may continue to browse it this way if you wish, but it is recommended that you visit the site with a proper computer.</h2></div>\";\r\n        let navbar = document.getElementById(\"navbar\");\r\n        navbar.parentNode.insertBefore(header, navbar.nextSibling);\r\n        let toc = document.getElementById(\"toc_container\");\r\n        toc.parentNode.removeChild(toc);\r\n    }\r\n}\r\nfunction interceptDOM() {\r\n    collapseOnPhone();\r\n}\r\ndocument.addEventListener(\"DOMContentLoaded\", interceptDOM);\r\n","let root = {};\r\nexport const date = new Date(); //new Date(\"December 16, 2016 11:13:00\");//\r\nexport const time = date.getSeconds();\r\nexport const month = date.getMonth();\r\nexport const day = date.getDate();\r\nexport const xmas = month == 11 || (month == 0 && day <= 10); //between dec 1 and jan 10\r\nexport const hallow = month == 9 && day >= 10; //between oct 10 and oct 31\t\r\nexport const viskey = 'visibility';\r\nexport const visval = 'visible';\r\nexport const xkey = 'x';\r\nexport const ykey = 'y';\r\nexport const hkey = 'height';\r\nexport const wkey = 'width';\r\nlet tileWidthNum = -1;\r\nlet tileHeightNum = -1;\r\nlet tileWidth;\r\nlet tileHeight;\r\nlet imagePaths = {};\r\nexport function absDiff(a, b) {\r\n    return Math.abs(Math.abs(a) - Math.abs(b));\r\n}\r\nexport function getImageRoot(folderName) {\r\n    if (root[folderName] == null || typeof (root[folderName]) == \"undefined\") {\r\n        var ret = \"images/\" + folderName + \"/\";\r\n        var url = window.location.href;\r\n        //console.log(url);\r\n        var idx = url.indexOf(\"sitecore\");\r\n        url = url.substring(idx + 9);\r\n        //console.log(url);\r\n        var levels = url.split(\"/\").length - 1;\r\n        for (var i = 0; i < levels; i++)\r\n            ret = \"../\" + ret;\r\n        root[folderName] = ret;\r\n        //console.log(\"Calculated root \"+root[folderName]);\r\n    }\r\n    return root[folderName];\r\n}\r\nexport function getRandomBetween(min, max) {\r\n    return Math.floor(Math.random() * (max - min + 1) + min);\r\n}\r\nexport function getRandomDecimalBetween(min, max) {\r\n    return Math.random() * (max - min) + min;\r\n}\r\nexport function getOrCreateImgPath(img, folder) {\r\n    if (imagePaths[img] == null) {\r\n        imagePaths[img] = getImageRoot(folder) + img + \".png\";\r\n        //console.log(\"Computed image path '\"+imagePaths[img]+\"' for image '\"+img+\"'\");\r\n    }\r\n    return imagePaths[img];\r\n}\r\nexport function getTileWidth(iw) {\r\n    if (tileWidthNum != iw) {\r\n        tileWidthNum = iw;\r\n        tileWidth = tileWidthNum.toString();\r\n    }\r\n    return tileWidth;\r\n}\r\nexport function getTileHeight(ih) {\r\n    if (tileHeightNum != ih) {\r\n        tileHeightNum = ih;\r\n        tileHeight = tileHeightNum.toString();\r\n    }\r\n    return tileHeight;\r\n}\r\nexport function getArrayIndex(cols, x, y) {\r\n    return x + y * cols;\r\n}\r\n","const SCALE = 1;\r\nimport { xmas, viskey, visval, xkey, ykey, hkey, wkey, getRandomBetween, getOrCreateImgPath, getTileWidth, getTileHeight, getArrayIndex } from '../library';\r\nimport { isPhone } from '../browser';\r\nfunction addImage(elem, img, ix, iy, iw, ih) {\r\n    //var pre = '<image x=\"'+ix+'\" y=\"'+iy+'\" width=\"'+iw+'\" height=\"'+ih+'\" xlink:href=\"'+getImageRoot();\r\n    //var post = '.png\" />';\r\n    //return pre+img+post;\r\n    var svgimg = document.createElementNS('http://www.w3.org/2000/svg', 'image');\r\n    svgimg.setAttributeNS(null, wkey, getTileWidth(iw));\r\n    svgimg.setAttributeNS(null, hkey, getTileHeight(ih));\r\n    svgimg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', getOrCreateImgPath(img, \"portal/tiles\"));\r\n    svgimg.setAttributeNS(null, xkey, ix.toString());\r\n    svgimg.setAttributeNS(null, ykey, iy.toString());\r\n    svgimg.setAttributeNS(null, viskey, visval);\r\n    if (img.startsWith(\"lightbridge\") || img == \"laser_snow\")\r\n        svgimg.setAttributeNS(null, \"style\", \"mix-blend-mode: screen;\");\r\n    elem.appendChild(svgimg);\r\n}\r\nfunction buildImage(elem, rows, cols, terrain, blocks) {\r\n    var w = 128 * SCALE;\r\n    var h = 128 * SCALE;\r\n    var x = 0;\r\n    var y = 0;\r\n    var lasers = [];\r\n    for (var k = 0; k < rows; k++) {\r\n        x = 0;\r\n        for (var i = 0; i < cols; i++) {\r\n            let idx = getArrayIndex(cols, i, k);\r\n            let imgs = blocks[idx];\r\n            addImage(elem, terrain[idx], x, y, w, h);\r\n            if (imgs.length != 1 || imgs[0] != \"air\") {\r\n                //console.log(\"Got \"+img+\" @ \"+i+\", \"+k);\r\n                for (var n = 0; n < imgs.length; n++) {\r\n                    var img = imgs[n];\r\n                    if (img != \"air\") {\r\n                        img = modifyImageLocational(rows, cols, terrain, i, k, idx, img);\r\n                        addImage(elem, img, x, y, w, h);\r\n                        if (xmas && img.startsWith(\"laser\")) {\r\n                            lasers.push({ x: x, y: y });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            x += w;\r\n        }\r\n        y += h;\r\n    }\r\n    for (var i = 0; i < lasers.length; i++) {\r\n        var tile = lasers[i];\r\n        var flakes = getRandomBetween(4, 9);\r\n        for (var m = 0; m < flakes; m++) {\r\n            addImage(elem, \"laser_snow\", getRandomBetween(tile.x - 36, tile.x + w - 12), getRandomBetween(tile.y - 36, tile.y + h - 12), 48 * SCALE, 48 * SCALE);\r\n        }\r\n    }\r\n}\r\nfunction getRandomTileAt(x, y, rows) {\r\n    return \"black\" + getRandomBetween(0, 15);\r\n}\r\nfunction modifyImageLocational(rows, cols, terrain, x, y, idx, img) {\r\n    return img;\r\n}\r\nfunction placePortalSurface(terrain, blocks, rows, cols, blue, orange) {\r\n    var w = getRandomBetween(1, 6);\r\n    var h = getRandomBetween(1, 3);\r\n    var x = getRandomBetween(0, cols - 1);\r\n    var y = getRandomBetween(0, rows - 1);\r\n    var x2 = Math.min(x + w, cols);\r\n    var y2 = Math.min(y + h, rows);\r\n    for (var i = x; i < x2; i++) {\r\n        for (var k = y; k < y2; k++) {\r\n            var tex = \"white\" + getRandomBetween(0, 3);\r\n            var idx = getArrayIndex(cols, i, k);\r\n            terrain[idx] = tex;\r\n            if (blue && Math.random() < 0.1) {\r\n                addBlock(blocks, idx, \"portal_b\");\r\n                blue = false;\r\n            }\r\n            else if (orange && Math.random() < 0.1) {\r\n                addBlock(blocks, idx, \"portal_o\");\r\n                orange = false;\r\n            }\r\n        }\r\n    }\r\n    return [blue, orange];\r\n}\r\nfunction placeTestElements(blocks, rows, cols) {\r\n    for (var i = 1; i < rows - 1; i++) {\r\n        if (Math.random() < 0.1) {\r\n            generateBeam(blocks, rows, cols, 0, i);\r\n        }\r\n    }\r\n    for (var i = 1; i < cols - 1; i++) {\r\n        if (Math.random() < 0.1) {\r\n            generateBeam(blocks, rows, cols, i, 0);\r\n        }\r\n    }\r\n}\r\nfunction generateBeam(blocks, rows, cols, x, y) {\r\n    var type = Math.random() < 0.5 ? (Math.random() < 0.5 ? \"lightbridge\" : \"laser\") : (xmas ? \"funnel_xmas\" : (Math.random() < 0.35 ? \"funnel_o\" : \"funnel\"));\r\n    var dx = (x == 0 ? 1 : 0);\r\n    var dy = 1 - dx;\r\n    type = type + (dx == 0 ? \"_v\" : \"_h\");\r\n    while (x < cols && y < rows) {\r\n        addBlock(blocks, getArrayIndex(cols, x, y), type);\r\n        x += dx;\r\n        y += dy;\r\n    }\r\n}\r\nfunction addBlock(blocks, idx, img) {\r\n    if (blocks[idx].length == 1 && blocks[idx][0] == \"air\") {\r\n        blocks[idx] = [];\r\n    }\r\n    blocks[idx].push(img);\r\n}\r\nexport default function setPageBackground() {\r\n    if (isPhone)\r\n        return;\r\n    let tail = '</svg>';\r\n    let w = 128 * SCALE;\r\n    let h = 128 * SCALE;\r\n    let x = 0;\r\n    let y = 0;\r\n    //var height = findHighestNode(0, document.documentElement.childNodes);\r\n    let body = document.body;\r\n    let html = document.documentElement;\r\n    let height = Math.max(body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight) - 64;\r\n    let titleImg = document.getElementsByClassName(\"title-image\")[0];\r\n    if (titleImg == null || titleImg.src == null || titleImg.src == \"\" || titleImg.src == window.location.href) {\r\n        height += 72;\r\n    }\r\n    else {\r\n        height += 48;\r\n    }\r\n    //console.log(\"Total height is \"+height+\", document content is: \"+document.documentElement.innerHTML);\r\n    let rh = Math.max(height, window.innerHeight, document.body.clientHeight);\r\n    let rw = Math.max(window.innerWidth, document.body.clientWidth);\r\n    //console.log(rw+\" x \"+rh);\r\n    let rows = Math.ceil(rh / h);\r\n    let cols = Math.ceil(rw / w);\r\n    let tw = cols * w;\r\n    let th = rows * h;\r\n    console.log(\"Generating portal tileset with \" + cols + \" columns and \" + rows + \" rows\");\r\n    let xmlns = \"http://www.w3.org/2000/svg\";\r\n    let elem = document.createElementNS(xmlns, \"svg\");\r\n    elem.setAttributeNS(null, \"width\", tw.toString());\r\n    elem.setAttributeNS(null, \"height\", th.toString());\r\n    let terrain = new Array(cols * rows);\r\n    let blocks = new Array(cols * rows);\r\n    for (var i = 0; i < cols; i++) {\r\n        for (var k = 0; k < rows; k++) {\r\n            var img = getRandomTileAt(i, k, rows);\r\n            var idx = getArrayIndex(cols, i, k);\r\n            terrain[idx] = img;\r\n            blocks[idx] = [\"air\"];\r\n        }\r\n    }\r\n    let blue = true;\r\n    let orange = true;\r\n    for (var i = 0; i < rows / 4; i++) {\r\n        var ret = placePortalSurface(terrain, blocks, rows, cols, blue, orange);\r\n        blue = ret[0];\r\n        orange = ret[1];\r\n    }\r\n    placeTestElements(blocks, rows, cols);\r\n    buildImage(elem, rows, cols, terrain, blocks);\r\n    let tag = \"background-content\";\r\n    let container = document.getElementById(tag);\r\n    if (container == null) {\r\n        container = document.createElement(\"div\");\r\n        container.id = tag;\r\n        console.log(\"Injecting background element.\");\r\n        document.body.prepend(container);\r\n    }\r\n    while (container.firstChild) {\r\n        container.removeChild(container.firstChild);\r\n    }\r\n    //console.log(elem);\r\n    container.appendChild(elem);\r\n}\r\n"],"sourceRoot":""}