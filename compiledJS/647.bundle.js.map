{"version":3,"sources":["webpack://sitecore/./node_modules/ts-debounce/dist/src/index.esm.js","webpack://sitecore/./browser.ts","webpack://sitecore/./library.ts","webpack://sitecore/./p2/backgroundgen.ts"],"names":["r","e","n","i","t","o","a","isImmediate","u","callback","c","maxWait","v","Date","now","l","f","d","slice","call","arguments","this","Promise","clearTimeout","setTimeout","apply","forEach","resolve","push","reject","cancel","isPhone","document","addEventListener","console","log","imgs","getElementsByClassName","length","img","par","parentNode","tagName","put","createElement","innerHTML","src","replaceChild","className","url","replace","text","style","width","header","navbar","getElementById","insertBefore","nextSibling","toc","removeChild","collapseOnPhone","root","date","time","getSeconds","month","getMonth","day","getDate","xmas","hallow","viskey","visval","xkey","ykey","hkey","wkey","tileWidth","tileHeight","tileWidthNum","tileHeightNum","imagePaths","getRandomBetween","min","max","Math","floor","random","getRandomDecimalBetween","getOrCreateImgPath","folder","folderName","ret","window","location","href","idx","indexOf","levels","substring","split","getImageRoot","getTileWidth","iw","toString","getTileHeight","ih","getArrayIndex","cols","x","y","addImage","elem","ix","iy","svgimg","createElementNS","setAttributeNS","startsWith","appendChild","modifyImageLocational","rows","terrain","placePortalSurface","blocks","blue","orange","w","h","x2","y2","k","tex","addBlock","generateBeam","type","dx","dy","setPageBackground","body","html","documentElement","height","scrollHeight","offsetHeight","clientHeight","titleImg","rh","innerHeight","rw","innerWidth","clientWidth","ceil","tw","th","Array","placeTestElements","lasers","tile","flakes","m","buildImage","tag","container","id","prepend","firstChild"],"mappings":"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","file":"647.bundle.js","sourcesContent":["function r(r,e,n){var i,t,o;void 0===e&&(e=50),void 0===n&&(n={});var a=null!=(i=n.isImmediate)&&i,u=null!=(t=n.callback)&&t,c=n.maxWait,v=Date.now(),l=[];function f(){if(void 0!==c){var r=Date.now()-v;if(r+e>=c)return c-r}return e}var d=function(){var e=[].slice.call(arguments),n=this;return new Promise(function(i,t){var c=a&&void 0===o;if(void 0!==o&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,v=Date.now(),!a){var i=r.apply(n,e);u&&u(i),l.forEach(function(r){return(0,r.resolve)(i)}),l=[]}},f()),c){var d=r.apply(n,e);return u&&u(d),i(d)}l.push({resolve:i,reject:t})})};return d.cancel=function(r){void 0!==o&&clearTimeout(o),l.forEach(function(e){return(0,e.reject)(r)}),l=[]},d}export{r as debounce};\n//# sourceMappingURL=index.esm.js.map\n","export const isPhone = checkMobile();\r\nfunction checkMobile() {\r\n    return false;\r\n}\r\nfunction collapseOnPhone() {\r\n    if (isPhone) {\r\n        var imgs = document.getElementsByClassName(\"deembed-media\");\r\n        while (imgs.length > 0) {\r\n            let img = imgs[0];\r\n            let par = img.parentNode;\r\n            //console.log(img.src+\" @ \"+par.tagName);\r\n            if (par.tagName == \"VIDEO\") {\r\n                let put = document.createElement(\"div\");\r\n                put.innerHTML = '<a href = \"' + img.src + '\">' + img.src + \"</a>\";\r\n                par.parentNode.replaceChild(put, par);\r\n            }\r\n            else {\r\n                //par.replaceChild(put, img);\r\n                if (par.className == \"video\") {\r\n                    var url = img.src.replace(\"embed/\", \"watch?v=\");\r\n                    par.innerHTML = '<a href = \"' + url + '\">' + url + \"</a>\";\r\n                }\r\n                else if (par.className != \"header-image\")\r\n                    par.innerHTML = img.src + \"<br>\";\r\n                else\r\n                    par.innerHTML = \"\";\r\n            }\r\n            console.log(\"Hiding media '\" + img.src + \"'\");\r\n        }\r\n        var text = document.getElementsByClassName(\"textarea\");\r\n        for (var i = 0; i < text.length; i++) {\r\n            text[i].style.width = \"33%\";\r\n        }\r\n        let header = document.createElement(\"div\");\r\n        header.innerHTML = \"<div style = 'text-align: center; width: 33%; margin: auto; border: 3px solid red;'><h2 style = 'color: red; margin: 12px;'>This site is not designed for use on phones and other handheld devices, nor is any of its content relevant on such platforms. You may continue to browse it this way if you wish, but it is recommended that you visit the site with a proper computer.</h2></div>\";\r\n        let navbar = document.getElementById(\"navbar\");\r\n        navbar.parentNode.insertBefore(header, navbar.nextSibling);\r\n        let toc = document.getElementById(\"toc_container\");\r\n        toc.parentNode.removeChild(toc);\r\n    }\r\n}\r\nfunction interceptDOM() {\r\n    console.log(\"Detected phone browser: \" + isPhone);\r\n    collapseOnPhone();\r\n}\r\ndocument.addEventListener(\"DOMContentLoaded\", interceptDOM);\r\n","let root = {};\r\nexport const date = new Date(); //new Date(\"December 16, 2016 11:13:00\");//\r\nexport const time = date.getSeconds();\r\nexport const month = date.getMonth();\r\nexport const day = date.getDate();\r\nexport const xmas = month == 11 || (month == 0 && day <= 10); //between dec 1 and jan 10\r\nexport const hallow = month == 9 && day >= 10; //between oct 10 and oct 31\t\r\nexport const viskey = 'visibility';\r\nexport const visval = 'visible';\r\nexport const xkey = 'x';\r\nexport const ykey = 'y';\r\nexport const hkey = 'height';\r\nexport const wkey = 'width';\r\nlet tileWidthNum = -1;\r\nlet tileHeightNum = -1;\r\nlet tileWidth;\r\nlet tileHeight;\r\nlet imagePaths = {};\r\nexport function absDiff(a, b) {\r\n    return Math.abs(Math.abs(a) - Math.abs(b));\r\n}\r\nexport function getImageRoot(folderName) {\r\n    if (root[folderName] == null || typeof (root[folderName]) == \"undefined\") {\r\n        var ret = \"images/\" + folderName + \"/\";\r\n        var url = window.location.href;\r\n        //console.log(url);\r\n        var idx = url.indexOf(\"sitecore\");\r\n        url = url.substring(idx + 9);\r\n        //console.log(url);\r\n        var levels = url.split(\"/\").length - 1;\r\n        for (var i = 0; i < levels; i++)\r\n            ret = \"../\" + ret;\r\n        root[folderName] = ret;\r\n        //console.log(\"Calculated root \"+root[folderName]);\r\n    }\r\n    return root[folderName];\r\n}\r\nexport function getRandomBetween(min, max) {\r\n    return Math.floor(Math.random() * (max - min + 1) + min);\r\n}\r\nexport function getRandomDecimalBetween(min, max) {\r\n    return Math.random() * (max - min) + min;\r\n}\r\nexport function getOrCreateImgPath(img, folder) {\r\n    if (imagePaths[img] == null) {\r\n        imagePaths[img] = getImageRoot(folder) + img + \".png\";\r\n        //console.log(\"Computed image path '\"+imagePaths[img]+\"' for image '\"+img+\"'\");\r\n    }\r\n    return imagePaths[img];\r\n}\r\nexport function getTileWidth(iw) {\r\n    if (tileWidthNum != iw) {\r\n        tileWidthNum = iw;\r\n        tileWidth = tileWidthNum.toString();\r\n    }\r\n    return tileWidth;\r\n}\r\nexport function getTileHeight(ih) {\r\n    if (tileHeightNum != ih) {\r\n        tileHeightNum = ih;\r\n        tileHeight = tileHeightNum.toString();\r\n    }\r\n    return tileHeight;\r\n}\r\nexport function getArrayIndex(cols, x, y) {\r\n    return x + y * cols;\r\n}\r\n","const SCALE = 1;\r\nimport { debounce } from \"ts-debounce\";\r\nimport { xmas, viskey, visval, xkey, ykey, hkey, wkey, getRandomBetween, getOrCreateImgPath, getTileWidth, getTileHeight, getArrayIndex } from '../library';\r\nimport { isPhone } from '../browser';\r\nfunction addImage(elem, img, ix, iy, iw, ih) {\r\n    //var pre = '<image x=\"'+ix+'\" y=\"'+iy+'\" width=\"'+iw+'\" height=\"'+ih+'\" xlink:href=\"'+getImageRoot();\r\n    //var post = '.png\" />';\r\n    //return pre+img+post;\r\n    var svgimg = document.createElementNS('http://www.w3.org/2000/svg', 'image');\r\n    svgimg.setAttributeNS(null, wkey, getTileWidth(iw));\r\n    svgimg.setAttributeNS(null, hkey, getTileHeight(ih));\r\n    svgimg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', getOrCreateImgPath(img, \"portal/tiles\"));\r\n    svgimg.setAttributeNS(null, xkey, ix.toString());\r\n    svgimg.setAttributeNS(null, ykey, iy.toString());\r\n    svgimg.setAttributeNS(null, viskey, visval);\r\n    if (img.startsWith(\"lightbridge\") || img == \"laser_snow\")\r\n        svgimg.setAttributeNS(null, \"style\", \"mix-blend-mode: screen;\");\r\n    elem.appendChild(svgimg);\r\n}\r\nfunction buildImage(elem, rows, cols, terrain, blocks) {\r\n    var w = 128 * SCALE;\r\n    var h = 128 * SCALE;\r\n    var x = 0;\r\n    var y = 0;\r\n    var lasers = [];\r\n    for (var k = 0; k < rows; k++) {\r\n        x = 0;\r\n        for (var i = 0; i < cols; i++) {\r\n            let idx = getArrayIndex(cols, i, k);\r\n            let imgs = blocks[idx];\r\n            addImage(elem, terrain[idx], x, y, w, h);\r\n            if (imgs.length != 1 || imgs[0] != \"air\") {\r\n                //console.log(\"Got \"+img+\" @ \"+i+\", \"+k);\r\n                for (var n = 0; n < imgs.length; n++) {\r\n                    var img = imgs[n];\r\n                    if (img != \"air\") {\r\n                        img = modifyImageLocational(rows, cols, terrain, i, k, idx, img);\r\n                        addImage(elem, img, x, y, w, h);\r\n                        if (xmas && img.startsWith(\"laser\")) {\r\n                            lasers.push({ x: x, y: y });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            x += w;\r\n        }\r\n        y += h;\r\n    }\r\n    for (var i = 0; i < lasers.length; i++) {\r\n        var tile = lasers[i];\r\n        var flakes = getRandomBetween(4, 9);\r\n        for (var m = 0; m < flakes; m++) {\r\n            addImage(elem, \"laser_snow\", getRandomBetween(tile.x - 36, tile.x + w - 12), getRandomBetween(tile.y - 36, tile.y + h - 12), 48 * SCALE, 48 * SCALE);\r\n        }\r\n    }\r\n}\r\nfunction getRandomTileAt(x, y, rows) {\r\n    return \"black\" + getRandomBetween(0, 15);\r\n}\r\nfunction modifyImageLocational(rows, cols, terrain, x, y, idx, img) {\r\n    return img;\r\n}\r\nfunction placePortalSurface(terrain, blocks, rows, cols, blue, orange) {\r\n    var w = getRandomBetween(1, 6);\r\n    var h = getRandomBetween(1, 3);\r\n    var x = getRandomBetween(0, cols - 1);\r\n    var y = getRandomBetween(0, rows - 1);\r\n    var x2 = Math.min(x + w, cols);\r\n    var y2 = Math.min(y + h, rows);\r\n    for (var i = x; i < x2; i++) {\r\n        for (var k = y; k < y2; k++) {\r\n            var tex = \"white\" + getRandomBetween(0, 3);\r\n            var idx = getArrayIndex(cols, i, k);\r\n            terrain[idx] = tex;\r\n            if (blue && Math.random() < 0.1) {\r\n                addBlock(blocks, idx, \"portal_b\");\r\n                blue = false;\r\n            }\r\n            else if (orange && Math.random() < 0.1) {\r\n                addBlock(blocks, idx, \"portal_o\");\r\n                orange = false;\r\n            }\r\n        }\r\n    }\r\n    return [blue, orange];\r\n}\r\nfunction placeTestElements(blocks, rows, cols) {\r\n    for (var i = 1; i < rows - 1; i++) {\r\n        if (Math.random() < 0.1) {\r\n            generateBeam(blocks, rows, cols, 0, i);\r\n        }\r\n    }\r\n    for (var i = 1; i < cols - 1; i++) {\r\n        if (Math.random() < 0.1) {\r\n            generateBeam(blocks, rows, cols, i, 0);\r\n        }\r\n    }\r\n}\r\nfunction generateBeam(blocks, rows, cols, x, y) {\r\n    var type = Math.random() < 0.5 ? (Math.random() < 0.5 ? \"lightbridge\" : \"laser\") : (xmas ? \"funnel_xmas\" : (Math.random() < 0.35 ? \"funnel_o\" : \"funnel\"));\r\n    var dx = (x == 0 ? 1 : 0);\r\n    var dy = 1 - dx;\r\n    type = type + (dx == 0 ? \"_v\" : \"_h\");\r\n    while (x < cols && y < rows) {\r\n        addBlock(blocks, getArrayIndex(cols, x, y), type);\r\n        x += dx;\r\n        y += dy;\r\n    }\r\n}\r\nfunction addBlock(blocks, idx, img) {\r\n    if (blocks[idx].length == 1 && blocks[idx][0] == \"air\") {\r\n        blocks[idx] = [];\r\n    }\r\n    blocks[idx].push(img);\r\n}\r\nexport default function setPageBackground() {\r\n    if (isPhone)\r\n        return;\r\n    let tail = '</svg>';\r\n    let w = 128 * SCALE;\r\n    let h = 128 * SCALE;\r\n    let x = 0;\r\n    let y = 0;\r\n    //var height = findHighestNode(0, document.documentElement.childNodes);\r\n    let body = document.body;\r\n    let html = document.documentElement;\r\n    let height = Math.max(body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight) - 64;\r\n    let titleImg = document.getElementsByClassName(\"title-image\")[0];\r\n    if (titleImg == null || titleImg.src == null || titleImg.src == \"\" || titleImg.src == window.location.href) {\r\n        height += 72;\r\n    }\r\n    else {\r\n        height += 48;\r\n    }\r\n    //console.log(\"Total height is \"+height+\", document content is: \"+document.documentElement.innerHTML);\r\n    let rh = Math.max(height, window.innerHeight, document.body.clientHeight);\r\n    let rw = Math.max(window.innerWidth, document.body.clientWidth);\r\n    //console.log(rw+\" x \"+rh);\r\n    let rows = Math.ceil(rh / h);\r\n    let cols = Math.ceil(rw / w);\r\n    let tw = cols * w;\r\n    let th = rows * h;\r\n    console.log(\"Generating portal tileset with \" + cols + \" columns and \" + rows + \" rows\");\r\n    let xmlns = \"http://www.w3.org/2000/svg\";\r\n    let elem = document.createElementNS(xmlns, \"svg\");\r\n    elem.setAttributeNS(null, \"width\", tw.toString());\r\n    elem.setAttributeNS(null, \"height\", th.toString());\r\n    let terrain = new Array(cols * rows);\r\n    let blocks = new Array(cols * rows);\r\n    for (var i = 0; i < cols; i++) {\r\n        for (var k = 0; k < rows; k++) {\r\n            var img = getRandomTileAt(i, k, rows);\r\n            var idx = getArrayIndex(cols, i, k);\r\n            terrain[idx] = img;\r\n            blocks[idx] = [\"air\"];\r\n        }\r\n    }\r\n    let blue = true;\r\n    let orange = true;\r\n    for (var i = 0; i < rows / 4; i++) {\r\n        var ret = placePortalSurface(terrain, blocks, rows, cols, blue, orange);\r\n        blue = ret[0];\r\n        orange = ret[1];\r\n    }\r\n    placeTestElements(blocks, rows, cols);\r\n    buildImage(elem, rows, cols, terrain, blocks);\r\n    let tag = \"background-content\";\r\n    let container = document.getElementById(tag);\r\n    if (container == null) {\r\n        container = document.createElement(\"div\");\r\n        container.id = tag;\r\n        console.log(\"Injecting background element.\");\r\n        document.body.prepend(container);\r\n    }\r\n    while (container.firstChild) {\r\n        container.removeChild(container.firstChild);\r\n    }\r\n    //console.log(elem);\r\n    container.appendChild(elem);\r\n}\r\nwindow.addEventListener('resize', debounce(setPageBackground, 250, { isImmediate: true }));\r\n"],"sourceRoot":""}