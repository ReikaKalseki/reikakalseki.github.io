(self.webpackChunksitecore=self.webpackChunksitecore||[]).push([[570],{938:(e,t,a)=>{"use strict";function r(e,t,a){var r,n,o;void 0===t&&(t=50),void 0===a&&(a={});var l=null!=(r=a.isImmediate)&&r,i=null!=(n=a.callback)&&n,h=a.maxWait,c=Date.now(),s=[];function u(){if(void 0!==h){var e=Date.now()-c;if(e+t>=h)return h-e}return t}var d=function(){var t=[].slice.call(arguments),a=this;return new Promise((function(r,n){var h=l&&void 0===o;if(void 0!==o&&clearTimeout(o),o=setTimeout((function(){if(o=void 0,c=Date.now(),!l){var r=e.apply(a,t);i&&i(r),s.forEach((function(e){return(0,e.resolve)(r)})),s=[]}}),u()),h){var d=e.apply(a,t);return i&&i(d),r(d)}s.push({resolve:r,reject:n})}))};return d.cancel=function(e){void 0!==o&&clearTimeout(o),s.forEach((function(t){return(0,t.reject)(e)})),s=[]},d}a.d(t,{D:()=>r})},570:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var r=a(621),n=a(938),o=a(212);let l=999,i=0;const h={diamond:w("diamond"),emerald:w("emerald"),ruby:w("ruby"),sapphire:w("sapphire"),topaz:w("topaz"),sugalite:w("sugalite")};function c(e,t){let a=document.createElement("div");return a.className="tile-fce-"+t,e.appendChild(a),a}function s(e,t,a){"cave"==a&&console.log("ERROR: ADDED CAVE ON NULL"),e[t]=[],e[t].push(a)}function u(e,t,a){null==e[t]||0==e[t].length?s(e,t,a):e[t][0]=a}function d(e,t,a){e[t].push(a)}function f(e,t){var a=e[t];return null==a||0==a.length?null:a[a.length-1]}function m(e,t){var a=e[t];return 0==a.length?null:a[0]}function M(e,t,a,r,n,o){var l=t/a;let i=r[e];var h=n[e],c=(o[e],"rock"),s=l-(i-.1);s>=0&&Math.random()*Math.random()*Math.random()*.8<s&&(c="bedrock");var u=l-(h-.1);return u>=0&&Math.random()*Math.random()*Math.random()*.8<u&&(c="deepstone"),c}function v(e,t,a,r,n,o,l){return l}function p(e,t,a,n,o,l,i,h,c){for(var M=function(e,t,a){var r=t/a,n=r<.2?1:1+.75*(r-.2);switch(e){case"hardresin":return[5,5];case"cave":return[2*n,4*n];case"biomass":return[1*n,1.5*n];case"coal":return[1.5*n,2*n];default:return[1.5*n,3*n]}}(l,o,e),v=.675*(0,r.sT)(M[0],M[1]),p=Math.max(0,Math.floor(n-v)),y=Math.max(0,Math.floor(o-v)),b=Math.min(t-1,Math.floor(n+v)),x=Math.min(e-1,Math.floor(o+v)),w=.75,k=(0,r.sT)(-w,w),Y=(0,r.sT)(-w,w),E="hardresin"==l?0:"cave"==l?3.5*v:2*v,_=0;_<=E;_++)for(var C=p;C<=b;C++)for(var R=y;R<=x;R++){var S=C-n,T=R-o;if(S*S+T*T<=v*v+.25){var D=Math.floor(C+_*k),A=Math.floor(R+_*Y);let e=(0,r.Yy)(t,D,A);if("hardresin"==l)s(a,e,l);else if("cave"==l){if(null!=a[e]&&a[e].length>0){var z=f(a,e);if("cave"!=z&&"lava"!=z&&"crystal"!=z&&"magmarock"!=z&&"hardresin"!=z){var H=0==A?-1:(0,r.Yy)(t,D,A-1);(H<0||null!=a[H]&&a[H].length>0&&"lava"!=f(a,H))&&d(a,e,l)}}}else(null==a[e]||g(l,m(a,e)))&&u(a,e,l)}}}function g(e,t){return"hardresin"==e||("biomass"==e?null!=t&&t.startsWith("deepstone_g"):"deepstone"==t||"bedrock"==t||"rock"==t)}function y(e,t,a,r,n,o){var l=a/e,i=["coal","copper","tin"];return l>r[t]-.12&&i.push("iron"),l>r[t]-.06&&i.push("lithium"),l>r[t]+.05&&(i.push("gold"),i.push("nickel"),i.push("titanium")),Math.abs(l-n[t])<=.1&&i.push("biomass"),l>n[t]+.05&&i.push("chromium"),i[Math.floor(Math.random()*i.length)]}function b(e,t,a,r,n){var o=e/t,l=[];return o<a/2&&l.push("diamond"),o>a/2&&o<a-.04&&l.push("emerald"),o>a+.02&&o<(a+r)/2&&l.push("ruby"),o>(a+r)/2&&o<r-.04&&l.push("sapphire"),Math.abs(o-r)<.05&&l.push("topaz"),o>r+.07&&l.push("sugalite"),0==l.length?null:l[Math.floor(Math.random()*l.length)]}function x(){if(o.M)return;let e=document.body,t=document.documentElement;var a=Math.max(e.offsetHeight,t.clientHeight,t.offsetHeight,window.innerHeight,document.body.clientHeight),n=Math.max(window.innerWidth,document.body.clientWidth);let u=Math.ceil(a/32)+1,m=Math.ceil(n/32);console.log("Generating FCE chunk slice tileset with "+m+" columns and "+u+" rows");let g=new Array(m*u),x=new Array(m),w=new Array(m),k=new Array(m);for(var Y=0;Y<m;Y++)x[Y]=(0,r.sT)(.22,.28),w[Y]=(0,r.sT)(.45,.55),k[Y]=(0,r.sT)(.87,.95),Y>0&&(x[Y]=Math.max(Math.min(x[Y],x[Y-1]+1),x[Y-1]-1),w[Y]=Math.max(Math.min(w[Y],w[Y-1]+2),w[Y-1]-2),k[Y]=Math.max(Math.min(k[Y],k[Y-1]+1),k[Y-1]-1));for(Y=0;Y<m;Y++)for(var E=0;E<u;E++){let e=M(Y,E,u,x,w,k),t=(0,r.Yy)(m,Y,E);g[t]=null,s(g,t,e)}!function(e,t,a,n,o,h){for(var c=-1,u=-1,m=-1,M=-1,v=-1,p=-1,g=(0,r.sc)(-3,4),y=(0,r.sc)(-3,4),b=Math.max(1,e/100),x=0;x<t;x++){var w=Math.floor(n[x]*e)-(0,r.sc)(1,4)*b,k=Math.floor(n[x]*e)+(0,r.sc)(0,1)*b,Y=Math.floor(o[x]*e)-(0,r.sc)(2,4)*b,E=Math.floor(o[x]*e)+(0,r.sc)(2,4)*b,_=Math.floor(h[x]*e)-(0,r.sc)(2,4)*b,C=Math.floor(h[x]*e)+(0,r.sc)(1,3)*b;x>0&&(w=Math.max(Math.min(w,c+.5),c-.5),k=Math.max(Math.min(k,u+.25),u-.25),Y=Math.max(Math.min(Y,M+1),M-1),E=Math.max(Math.min(E,m+.5),m-.5),_=Math.max(Math.min(_,p+1),p-1),C=Math.max(Math.min(C,v+.25),v-.25)),l=Math.min(l,Math.floor(_)),i=Math.max(i,Math.ceil(C));for(var R=0;R<e;R++){var S=(0,r.Yy)(t,x,R);R>=w&&R<=k&&(s(a,S,"deepstone_b1"),R!=Math.ceil(w)&&R!=Math.floor(k)&&d(a,S,"cave")),R>=Y&&R<=E&&(s(a,S,"deepstone_g1"),R!=Math.ceil(Y)&&R!=Math.floor(E)&&d(a,S,"cave")),R>=_&&R<=C&&(R!=Math.floor(C)&&R>=Math.floor(.95*e)-1*b?s(a,S,"lava"):(s(a,S,"deepstone_o1"),R!=Math.ceil(_)&&R!=Math.floor(C)&&d(a,S,"cave")))}for(var T=Y-k,D=_-E,A=Math.min(6,Math.max(1,Math.floor(Math.min(T,D)/4))),z=Math.min(6,6/A),H=-A;H<0;H++){var W=6==z?3:Math.floor((1-H)*z);W<=6&&(s(a,(0,r.Yy)(t,x,H+Math.ceil(w)),"deepstone_b"+W),s(a,(0,r.Yy)(t,x,-H+Math.floor(k)),"deepstone_b"+W),s(a,(0,r.Yy)(t,x,H+Math.ceil(Y)),"deepstone_g"+W),s(a,(0,r.Yy)(t,x,-H+Math.floor(E)),"deepstone_g"+W),s(a,(0,r.Yy)(t,x,H+Math.ceil(_)),"deepstone_o"+W),s(a,(0,r.Yy)(t,x,-H+Math.floor(C)),"deepstone_o"+W))}u=k,c=w,m=E,M=Y,v=C,p=_;var j=!1;if(g<=-4&&(g=(0,r.sc)(2,4),j=!0),g>0){var N=w+1,I=k-1;for((j||1==g)&&(N=(0,r.sc)(N,N+1),I=Math.max(N,(0,r.sc)(I-3,I))),R=N;R<=I;R++)s(a,S=(0,r.Yy)(t,x,R),"crystal")}if(g--,y<=-4&&(y=(0,r.sc)(1,4)),y>0)for(N=_+1,I=C-1,R=N=(0,r.sc)(N,N+3);R<=I;R++)"cave"==f(a,S=(0,r.Yy)(t,x,R))&&s(a,S,"magmarock");y--}}(u,m,g,x,w,k),function(e,t,a,r,n,o){for(var l=e*t/32,i=0;i<l;i++){var h=Math.floor(Math.random()*t),c=Math.floor(Math.random()*e);p(e,t,a,h,c,y(e,h,c,r,n))}}(u,m,g,x,w),function(e,t,a,n,o,l){for(var i=0;i<e/2.5;i++)p(e,t,a,(0,r.sc)(0,t),(0,r.sc)(0,e),"cave")}(u,m,g),function(e,t,a,n,o,l){for(var i=0;i<e/40;i++){var h=(0,r.sc)(6,t-6);p(e,t,a,h,(0,r.sc)(Math.floor(n[h]*e/2),Math.floor(l[h]*e-12)),"hardresin")}}(u,m,g,x,0,k),function(e,t,a){for(var n=(0,r.sc)(0,4),o=0;o<t;o++){for(var l=Math.max(n-1,Math.min(n+1,(0,r.sc)(0,4))),i=0;i<l;i++)s(a,(0,r.Yy)(t,o,i),"resin");n=l}}(0,m,g),function(e,t,a,n,o,l){for(var i=[],h=0;h<3*e;h++){var c=(0,r.sc)(2,t-2),s=(0,r.sc)(6,e-2),u=b(s,e,n[c],o[c],l[c]);if(null!=u){var m=(0,r.Yy)(t,c,s),M=f(a,m),v=f(a,(0,r.Yy)(t,c,s+1));"cave"!=M||"cave"==v||"lava"==v||null!=v&&v.includes("gem")||(d(a,m,"gem_"+u),i.push({x:64*c,y:64*s,type:u}))}}}(u,m,g,x,w,k);let _="background-content",C=document.getElementById(_);for(null==C&&(C=document.createElement("div"),C.id=_,console.log("Injecting background element."),document.body.prepend(C));C.firstChild;)C.removeChild(C.firstChild);C.className="tile-layer",C.style.width=n.toString()+"px",C.style.height=a.toString()+"px",function(e,t,a,n){try{for(let[e,t]of Object.entries(h)){let a=".tile-fce-gem_"+e+"::after",r=1024,n=-r/2+32;document.styleSheets[0].addRule(a,"width: "+r+"px;"),document.styleSheets[0].addRule(a,"height: "+r+"px;"),document.styleSheets[0].addRule(a,"top: "+n+"px;"),document.styleSheets[0].addRule(a,"left: "+n+"px;"),document.styleSheets[0].addRule(a,"background: radial-gradient(rgba("+t.r+","+t.g+","+t.b+",255) 0%, rgba("+t.r+","+t.g+","+t.b+",0) 70%);"),document.styleSheets[0].addRule(a,"mix-blend-mode: color-dodge;")}}catch(e){console.log("Could not access ruleset: "+e)}for(var o=0;o<t;o++){let t=document.createElement("div");for(var s=0;s<a;s++){let e=n[(0,r.Yy)(a,s,o)];if(r.hm&&e.length>0&&"cave"!=e[e.length-1]&&!e[e.length-1].startsWith("gem")&&"lava"!=e[e.length-1]&&(o<l||o>i)){var u=0==o?["cave"]:n[(0,r.Yy)(a,s,o-1)];u.length>0&&"cave"==u[u.length-1]&&e.push("snow")}let h=t;for(var d=0;d<e.length;d++){let t=e[d];t=v(0,0,0,0,0,0,t),h=c(h,t),t.includes("gem")&&window.getComputedStyle(h,"::after")}}e.appendChild(t)}(0,r.xE)(e,1)}(C,u,m,g)}function w(e){let t=0,a=0,r=0;switch(e){case"diamond":t=224,a=234,r=240;break;case"emerald":t=78,a=221;break;case"ruby":t=229,a=19;break;case"sapphire":t=36,a=87,r=242;break;case"topaz":t=245,a=195,r=67;break;case"sugalite":t=195,a=22,r=229}return{r:t,g:a,b:r}}window.addEventListener("resize",(0,n.D)(x,100))}}]);
//# sourceMappingURL=570.bundle.js.map