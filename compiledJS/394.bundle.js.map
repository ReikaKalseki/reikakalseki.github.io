{"version":3,"sources":["webpack://sitecore/./node_modules/simplex-noise/simplex-noise.js","webpack://sitecore/./subnautica/backgroundgen.ts"],"names":["F2","Math","sqrt","G2","G3","F4","G4","SimplexNoise","randomOrSeed","random","s0","s1","s2","c","mash","masher","i","arguments","length","t","alea","this","p","buildPermutationTable","perm","Uint8Array","permMod12","r","aux","n","data","toString","h","charCodeAt","prototype","grad3","Float32Array","grad4","noise2D","xin","yin","i1","j1","n0","n1","n2","s","floor","j","x0","y0","x1","y1","x2","y2","ii","jj","t0","gi0","t1","gi1","t2","gi2","noise3D","zin","n3","k1","i2","j2","k2","k","z0","z1","z2","x3","y3","z3","kk","t3","gi3","noise4D","x","y","z","w","n4","l1","l2","i3","j3","k3","l3","l","w0","rankx","ranky","rankz","rankw","w1","w2","w3","x4","y4","z4","w4","ll","t4","gi4","_buildPermutationTable","exports","module","SCALE","biomes","createBiome","name","rows","d","ff","minF","varCAmt","varCRate","varFAmt","varFRate","tex","vars","water","ores","plants","height","rowsRequired","floorFraction","minFloorRows","variationCeil","rate","range","variationFloor","depth","baseTerrainTexture","terrainVariants","waterColor","oreSpawnRate","plantSpawnRate","simplex","allocateBiomes","cols","available","rowRem","totalMin","idx","biome","push","index","Array","highest","lowest","fac","slot","amt","baseF","floorVarFromOther","maxs","min","maxr","getSurface","col","topRow","bottomRow","rowsAllocated","airCeiling","airFloor","solidFloor","max","pop","console","log","getBiomeAtRow","row","addPositionedImage","elem","img","modifyImageLocational","added","tile","document","createElement","className","appendChild","addLooseImage","style","position","left","top","transformOrigin","addImageToRow","zIndex","getRandomBiomeTerrain","f","bottom","noise","variant","includes","endsWith","genBlob","tiles","type","exclude","store","rx","ry","mx","my","px","py","ms","slopeX","slopeY","di","dk","dx","dy","backgroundWater","isAir","maxslope","ret","lastY","diff","abs","sign","generateBiomeFloor","minfrac","middle","tileOverlay","addObject","objects","illum","obj","addObjectOfSizeAt","mainTexture","illumTexture","generateTallPlant","rootY","topY","baseTex","topTex","rootTex","arr","generateDoubleWidePlant","middleTex","spr","str","charAt","num","parseInt","substring","isr","indexOf","yy","createTextureWithSuffix","basename","baseillum","suffix","createDualTexture","createFullGlowTexture","getRandomOre","li","getRandomPlant","getRandomSmallFish","addCreatureAtRandomizedPosition","creature","f1","f2","lowestY","wT","ceil","hT","getInterpolatedBiomeHeight","elems","flipWithChance","chance","setPageBackground","body","documentElement","rh","offsetHeight","rw","window","innerWidth","clientWidth","tag","container","getElementById","id","prepend","firstChild","removeChild","grid","width","classList","add","baseTexture","caveCeil","caveFloor","ceilAdd","floorAdd","groundObjects","generateJellyshroomCave","towers","set","foreground","slots","xx","centerX","baseY","gridSlots","highestY","generateGrassTowers","generateRedGrass","kelpcaves","root","generateCreepvine","caves","func","idxu","generateKelpCaves","generateKoosh","generateReefPods","generateBloodKelp","lrdata","leftShaft","divisions","shaft","boneX","round","amt1","amt2","riverFloor","lake","dd","boneY","treeX","cl","coveFloor","pillar1","pillar2","pillar3","dPl","dTr","solid","treeY","lsh","lxc","shaftLocation","skullX","skullY","middleLakeXCenter","middleLakeLevel","generateLostRiverCave","cfloor","rsq","generateILZCave","nPlant","nOre","gen","varX","generateGroundDeco","ang","flip","generateSmallCreatures","ns","prY","generateLargeCreatures","waterOverlay","tilerow","waterrow","addTile","addWater","tileTex","flag","buildImage"],"mappings":"oFAAA,OA6BA,WACE,aAEA,IAAIA,EAAK,IAAOC,KAAKC,KAAK,GAAO,GAC7BC,GAAM,EAAMF,KAAKC,KAAK,IAAQ,EAE9BE,EAAK,EAAM,EACXC,GAAMJ,KAAKC,KAAK,GAAO,GAAO,EAC9BI,GAAM,EAAML,KAAKC,KAAK,IAAQ,GAElC,SAASK,EAAaC,GACpB,IAAIC,EAEFA,EADyB,mBAAhBD,EACAA,EAEFA,EA6WX,WAEE,IAAIE,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAI,EAEJC,EAAOC,IACXL,EAAKI,EAAK,KACVH,EAAKG,EAAK,KACVF,EAAKE,EAAK,KAEV,IAAK,IAAIE,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,KACpCN,GAAMI,EAAKG,UAAUD,KACZ,IACPN,GAAM,IAERC,GAAMG,EAAKG,UAAUD,KACZ,IACPL,GAAM,IAERC,GAAME,EAAKG,UAAUD,KACZ,IACPJ,GAAM,GAIV,OADAE,EAAO,KACA,WACL,IAAIK,EAAI,QAAUT,EAAS,uBAAJG,EAGvB,OAFAH,EAAKC,EACLA,EAAKC,EACEA,EAAKO,GAAKN,EAAQ,EAAJM,IA3YZC,CAAKZ,GAELP,KAAKQ,OAEhBY,KAAKC,EAAIC,EAAsBd,GAC/BY,KAAKG,KAAO,IAAIC,WAAW,KAC3BJ,KAAKK,UAAY,IAAID,WAAW,KAChC,IAAK,IAAIT,EAAI,EAAGA,EAAI,IAAKA,IACvBK,KAAKG,KAAKR,GAAKK,KAAKC,EAAM,IAAJN,GACtBK,KAAKK,UAAUV,GAAKK,KAAKG,KAAKR,GAAK,GAmVvC,SAASO,EAAsBd,GAC7B,IAAIO,EACAM,EAAI,IAAIG,WAAW,KACvB,IAAKT,EAAI,EAAGA,EAAI,IAAKA,IACnBM,EAAEN,GAAKA,EAET,IAAKA,EAAI,EAAGA,EAAI,IAAKA,IAAK,CACxB,IAAIW,EAAIX,KAAOP,KAAY,IAAMO,IAC7BY,EAAMN,EAAEN,GACZM,EAAEN,GAAKM,EAAEK,GACTL,EAAEK,GAAKC,EAET,OAAON,EAsCT,SAASP,IACP,IAAIc,EAAI,WACR,OAAO,SAASC,GACdA,EAAOA,EAAKC,WACZ,IAAK,IAAIf,EAAI,EAAGA,EAAIc,EAAKZ,OAAQF,IAAK,CAEpC,IAAIgB,EAAI,oBADRH,GAAKC,EAAKG,WAAWjB,IAGrBgB,GADAH,EAAIG,IAAM,EAGVH,GADAG,GAAKH,KACK,EAEVA,GAAS,YADTG,GAAKH,GAGP,OAAmB,wBAAXA,IAAM,IA/YlBtB,EAAa2B,UAAY,CACvBC,MAAO,IAAIC,aAAa,CAAC,EAAG,EAAG,GAC5B,EAAG,EAAG,EACP,GAAI,EAAG,GAEN,GAAI,EAAG,EACR,EAAG,EAAG,GACL,EAAG,EAAG,EAEP,EAAG,GAAI,GACN,EAAG,GAAI,EACR,EAAG,EAAG,EAEN,GAAI,EAAG,EACP,EAAG,GAAI,EACP,GAAI,GAAI,IACVC,MAAO,IAAID,aAAa,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,GAAI,EACxE,GAAI,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,EACrD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,GAAI,GAChD,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,EACrD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,GAChD,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,GAAI,EACrD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,GAAI,EAAG,GAChD,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,EAAG,IACvDE,QAAS,SAASC,EAAKC,GACrB,IAiBIC,EAAIC,EAjBJhB,EAAYL,KAAKK,UACjBF,EAAOH,KAAKG,KACZW,EAAQd,KAAKc,MACbQ,EAAK,EACLC,EAAK,EACLC,EAAK,EAELC,GAAKP,EAAMC,GAAOxC,EAClBgB,EAAIf,KAAK8C,MAAMR,EAAMO,GACrBE,EAAI/C,KAAK8C,MAAMP,EAAMM,GACrB3B,GAAKH,EAAIgC,GAAK7C,EAGd8C,EAAKV,GAFAvB,EAAIG,GAGT+B,EAAKV,GAFAQ,EAAI7B,GAMT8B,EAAKC,GACPT,EAAK,EACLC,EAAK,IAGLD,EAAK,EACLC,EAAK,GAKP,IAAIS,EAAKF,EAAKR,EAAKtC,EACfiD,EAAKF,EAAKR,EAAKvC,EACfkD,EAAKJ,EAAK,EAAM,EAAM9C,EACtBmD,EAAKJ,EAAK,EAAM,EAAM/C,EAEtBoD,EAAS,IAAJvC,EACLwC,EAAS,IAAJR,EAELS,EAAK,GAAMR,EAAKA,EAAKC,EAAKA,EAC9B,GAAIO,GAAM,EAAG,CACX,IAAIC,EAAiC,EAA3BhC,EAAU6B,EAAK/B,EAAKgC,IAE9Bb,GADAc,GAAMA,GACIA,GAAMtB,EAAMuB,GAAOT,EAAKd,EAAMuB,EAAM,GAAKR,GAErD,IAAIS,EAAK,GAAMR,EAAKA,EAAKC,EAAKA,EAC9B,GAAIO,GAAM,EAAG,CACX,IAAIC,EAA2C,EAArClC,EAAU6B,EAAKd,EAAKjB,EAAKgC,EAAKd,IAExCE,GADAe,GAAMA,GACIA,GAAMxB,EAAMyB,GAAOT,EAAKhB,EAAMyB,EAAM,GAAKR,GAErD,IAAIS,EAAK,GAAMR,EAAKA,EAAKC,EAAKA,EAC9B,GAAIO,GAAM,EAAG,CACX,IAAIC,EAAyC,EAAnCpC,EAAU6B,EAAK,EAAI/B,EAAKgC,EAAK,IAEvCX,GADAgB,GAAMA,GACIA,GAAM1B,EAAM2B,GAAOT,EAAKlB,EAAM2B,EAAM,GAAKR,GAIrD,OAAO,IAAQX,EAAKC,EAAKC,IAG3BkB,QAAS,SAASxB,EAAKC,EAAKwB,GAC1B,IAGIrB,EAAIC,EAAIC,EAAIoB,EAeZxB,EAAIC,EAAIwB,EACRC,EAAIC,EAAIC,EAnBR3C,EAAYL,KAAKK,UACjBF,EAAOH,KAAKG,KACZW,EAAQd,KAAKc,MAGbW,EAnHC,mBAmHIP,EAAMC,EAAMwB,GACjBhD,EAAIf,KAAK8C,MAAMR,EAAMO,GACrBE,EAAI/C,KAAK8C,MAAMP,EAAMM,GACrBwB,EAAIrE,KAAK8C,MAAMiB,EAAMlB,GACrB3B,GAAKH,EAAIgC,EAAIsB,GAAKlE,EAIlB6C,EAAKV,GAHAvB,EAAIG,GAIT+B,EAAKV,GAHAQ,EAAI7B,GAIToD,EAAKP,GAHAM,EAAInD,GAQT8B,GAAMC,EACJA,GAAMqB,GACR9B,EAAK,EACLC,EAAK,EACLwB,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,GAEEpB,GAAMsB,GACb9B,EAAK,EACLC,EAAK,EACLwB,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,IAGL5B,EAAK,EACLC,EAAK,EACLwB,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,GAIHnB,EAAKqB,GACP9B,EAAK,EACLC,EAAK,EACLwB,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,GAEEpB,EAAKsB,GACZ9B,EAAK,EACLC,EAAK,EACLwB,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,IAGL5B,EAAK,EACLC,EAAK,EACLwB,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,GAOT,IAAIlB,EAAKF,EAAKR,EAAKrC,EACfgD,EAAKF,EAAKR,EAAKtC,EACfoE,EAAKD,EAAKL,EAAK9D,EACfiD,EAAKJ,EAAKkB,EAAK,EAAM/D,EACrBkD,EAAKJ,EAAKkB,EAAK,EAAMhE,EACrBqE,EAAKF,EAAKF,EAAK,EAAMjE,EACrBsE,EAAKzB,EAAK,EAAM,GAChB0B,EAAKzB,EAAK,EAAM,GAChB0B,EAAKL,EAAK,EAAM,GAEhBhB,EAAS,IAAJvC,EACLwC,EAAS,IAAJR,EACL6B,EAAS,IAAJP,EAELb,EAAK,GAAMR,EAAKA,EAAKC,EAAKA,EAAKqB,EAAKA,EACxC,GAAId,EAAK,EAAGd,EAAK,MACZ,CACH,IAAIe,EAA4C,EAAtChC,EAAU6B,EAAK/B,EAAKgC,EAAKhC,EAAKqD,KAExClC,GADAc,GAAMA,GACIA,GAAMtB,EAAMuB,GAAOT,EAAKd,EAAMuB,EAAM,GAAKR,EAAKf,EAAMuB,EAAM,GAAKa,GAE3E,IAAIZ,EAAK,GAAMR,EAAKA,EAAKC,EAAKA,EAAKoB,EAAKA,EACxC,GAAIb,EAAK,EAAGf,EAAK,MACZ,CACH,IAAIgB,EAA2D,EAArDlC,EAAU6B,EAAKd,EAAKjB,EAAKgC,EAAKd,EAAKlB,EAAKqD,EAAKX,KAEvDtB,GADAe,GAAMA,GACIA,GAAMxB,EAAMyB,GAAOT,EAAKhB,EAAMyB,EAAM,GAAKR,EAAKjB,EAAMyB,EAAM,GAAKY,GAE3E,IAAIX,EAAK,GAAMR,EAAKA,EAAKC,EAAKA,EAAKmB,EAAKA,EACxC,GAAIZ,EAAK,EAAGhB,EAAK,MACZ,CACH,IAAIiB,EAA2D,EAArDpC,EAAU6B,EAAKY,EAAK3C,EAAKgC,EAAKY,EAAK5C,EAAKqD,EAAKR,KAEvDxB,GADAgB,GAAMA,GACIA,GAAM1B,EAAM2B,GAAOT,EAAKlB,EAAM2B,EAAM,GAAKR,EAAKnB,EAAM2B,EAAM,GAAKW,GAE3E,IAAIK,EAAK,GAAMJ,EAAKA,EAAKC,EAAKA,EAAKC,EAAKA,EACxC,GAAIE,EAAK,EAAGb,EAAK,MACZ,CACH,IAAIc,EAAwD,EAAlDrD,EAAU6B,EAAK,EAAI/B,EAAKgC,EAAK,EAAIhC,EAAKqD,EAAK,KAErDZ,GADAa,GAAMA,GACIA,GAAM3C,EAAM4C,GAAOL,EAAKvC,EAAM4C,EAAM,GAAKJ,EAAKxC,EAAM4C,EAAM,GAAKH,GAI3E,OAAO,IAAQjC,EAAKC,EAAKC,EAAKoB,IAGhCe,QAAS,SAASC,EAAGC,EAAGC,EAAGC,GACzB,IAGIzC,EAAIC,EAAIC,EAAIoB,EAAIoB,EAqChB5C,EAAIC,EAAIwB,EAAIoB,EACZnB,EAAIC,EAAIC,EAAIkB,EACZC,EAAIC,EAAIC,EAAIC,EA1CZnE,EAAOH,KAAKG,KACZa,EAAQhB,KAAKgB,MAIbS,GAAKmC,EAAIC,EAAIC,EAAIC,GAAK/E,EACtBW,EAAIf,KAAK8C,MAAMkC,EAAInC,GACnBE,EAAI/C,KAAK8C,MAAMmC,EAAIpC,GACnBwB,EAAIrE,KAAK8C,MAAMoC,EAAIrC,GACnB8C,EAAI3F,KAAK8C,MAAMqC,EAAItC,GACnB3B,GAAKH,EAAIgC,EAAIsB,EAAIsB,GAAKtF,EAKtB2C,EAAKgC,GAJAjE,EAAIG,GAKT+B,EAAKgC,GAJAlC,EAAI7B,GAKToD,EAAKY,GAJAb,EAAInD,GAKT0E,EAAKT,GAJAQ,EAAIzE,GAUT2E,EAAQ,EACRC,EAAQ,EACRC,EAAQ,EACRC,EAAQ,EACRhD,EAAKC,EAAI4C,IACRC,IACD9C,EAAKsB,EAAIuB,IACRE,IACD/C,EAAK4C,EAAIC,IACRG,IACD/C,EAAKqB,EAAIwB,IACRC,IACD9C,EAAK2C,EAAIE,IACRE,IACD1B,EAAKsB,EAAIG,IACRC,IAwBL,IAAI9C,EAAKF,GAfTR,EAAKqD,GAAS,EAAI,EAAI,GAeHxF,EACf8C,EAAKF,GAfTR,EAAKqD,GAAS,EAAI,EAAI,GAeHzF,EACfkE,EAAKD,GAfTL,EAAK8B,GAAS,EAAI,EAAI,GAeH1F,EACf4F,EAAKL,GAfTP,EAAKW,GAAS,EAAI,EAAI,GAeH3F,EACf+C,EAAKJ,GAdTkB,EAAK2B,GAAS,EAAI,EAAI,GAcH,EAAMxF,EACrBgD,EAAKJ,GAdTkB,EAAK2B,GAAS,EAAI,EAAI,GAcH,EAAMzF,EACrBmE,EAAKF,GAdTF,EAAK2B,GAAS,EAAI,EAAI,GAcH,EAAM1F,EACrB6F,EAAKN,GAdTN,EAAKU,GAAS,EAAI,EAAI,GAcH,EAAM3F,EACrBoE,EAAKzB,GAbTuC,EAAKM,GAAS,EAAI,EAAI,GAaH,EAAMxF,EACrBqE,EAAKzB,GAbTuC,EAAKM,GAAS,EAAI,EAAI,GAaH,EAAMzF,EACrBsE,EAAKL,GAbTmB,EAAKM,GAAS,EAAI,EAAI,GAaH,EAAM1F,EACrB8F,EAAKP,GAbTF,EAAKM,GAAS,EAAI,EAAI,GAaH,EAAM3F,EACrB+F,EAAKpD,EAAK,EAAM,EAAM3C,EACtBgG,EAAKpD,EAAK,EAAM,EAAM5C,EACtBiG,EAAKhC,EAAK,EAAM,EAAMjE,EACtBkG,GAAKX,EAAK,EAAM,EAAMvF,EAEtBiD,GAAS,IAAJvC,EACLwC,GAAS,IAAJR,EACL6B,GAAS,IAAJP,EACLmC,GAAS,IAAJb,EAELnC,GAAK,GAAMR,EAAKA,EAAKC,EAAKA,EAAKqB,EAAKA,EAAKsB,EAAKA,EAClD,GAAIpC,GAAK,EAAGd,EAAK,MACZ,CACH,IAAIe,GAAOlC,EAAK+B,GAAK/B,EAAKgC,GAAKhC,EAAKqD,GAAKrD,EAAKiF,OAAS,GAAM,EAE7D9D,GADAc,IAAMA,IACIA,IAAMpB,EAAMqB,IAAOT,EAAKZ,EAAMqB,GAAM,GAAKR,EAAKb,EAAMqB,GAAM,GAAKa,EAAKlC,EAAMqB,GAAM,GAAKmC,GAEjG,IAAIlC,GAAK,GAAMR,EAAKA,EAAKC,EAAKA,EAAKoB,EAAKA,EAAK0B,EAAKA,EAClD,GAAIvC,GAAK,EAAGf,EAAK,MACZ,CACH,IAAIgB,GAAOpC,EAAK+B,GAAKd,EAAKjB,EAAKgC,GAAKd,EAAKlB,EAAKqD,GAAKX,EAAK1C,EAAKiF,GAAKnB,MAAS,GAAM,EAEjF1C,GADAe,IAAMA,IACIA,IAAMtB,EAAMuB,IAAOT,EAAKd,EAAMuB,GAAM,GAAKR,EAAKf,EAAMuB,GAAM,GAAKY,EAAKnC,EAAMuB,GAAM,GAAKsC,GAEjG,IAAIrC,GAAK,GAAMR,EAAKA,EAAKC,EAAKA,EAAKmB,EAAKA,EAAK0B,EAAKA,EAClD,GAAItC,GAAK,EAAGhB,EAAK,MACZ,CACH,IAAIiB,GAAOtC,EAAK+B,GAAKY,EAAK3C,EAAKgC,GAAKY,EAAK5C,EAAKqD,GAAKR,EAAK7C,EAAKiF,GAAKlB,MAAS,GAAM,EAEjF1C,GADAgB,IAAMA,IACIA,IAAMxB,EAAMyB,IAAOT,EAAKhB,EAAMyB,GAAM,GAAKR,EAAKjB,EAAMyB,GAAM,GAAKW,EAAKpC,EAAMyB,GAAM,GAAKqC,GAEjG,IAAIrB,GAAK,GAAMJ,EAAKA,EAAKC,EAAKA,EAAKC,EAAKA,EAAKwB,EAAKA,EAClD,GAAItB,GAAK,EAAGb,EAAK,MACZ,CACH,IAAIc,GAAOvD,EAAK+B,GAAKiC,EAAKhE,EAAKgC,GAAKiC,EAAKjE,EAAKqD,GAAKa,EAAKlE,EAAKiF,GAAKd,MAAS,GAAM,EAEjF1B,GADAa,IAAMA,IACIA,IAAMzC,EAAM0C,IAAOL,EAAKrC,EAAM0C,GAAM,GAAKJ,EAAKtC,EAAM0C,GAAM,GAAKH,EAAKvC,EAAM0C,GAAM,GAAKqB,GAEjG,IAAIM,GAAK,GAAML,EAAKA,EAAKC,EAAKA,EAAKC,EAAKA,EAAKC,GAAKA,GAClD,GAAIE,GAAK,EAAGrB,EAAK,MACZ,CACH,IAAIsB,GAAOnF,EAAK+B,GAAK,EAAI/B,EAAKgC,GAAK,EAAIhC,EAAKqD,GAAK,EAAIrD,EAAKiF,GAAK,MAAQ,GAAM,EAE7EpB,GADAqB,IAAMA,IACIA,IAAMrE,EAAMsE,IAAON,EAAKhE,EAAMsE,GAAM,GAAKL,EAAKjE,EAAMsE,GAAM,GAAKJ,EAAKlE,EAAMsE,GAAM,GAAKH,IAGjG,OAAO,IAAQ7D,EAAKC,EAAKC,EAAKoB,EAAKoB,KAkBvC9E,EAAaqG,uBAAyBrF,OAuDmD,KAAxC,aAAmB,OAAOhB,GAAc,8BAErDsG,EAAQtG,aAAeA,EAKzDuG,EAAOD,QAAUtG,EAxbrB,I,4GC7BA,MAAMwG,EAAQ,GACRC,EAAS,CACXC,EAAY,UAAW,EAAG,EAAG,GAAK,EAAG,EAAG,EAAG,EAAG,EAAG,eAAgB,EAAG,aAAc,GAAK,GACvFA,EAAY,OAAQ,EAAG,GAAI,IAAM,EAAG,EAAG,EAAG,EAAG,EAAG,YAAa,EAAG,aAAc,GAAK,IACnFA,EAAY,WAAY,EAAG,GAAI,IAAM,EAAG,EAAG,EAAG,EAAG,GAAK,cAAe,EAAG,iBAAkB,IAAM,GAChGA,EAAY,QAAS,EAAG,IAAK,GAAK,EAAG,EAAG,EAAG,EAAG,EAAG,YAAa,EAAG,cAAe,EAAG,GACnFA,EAAY,cAAe,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,aAAc,EAAG,cAAe,IAAK,GAC1FA,EAAY,YAAa,GAAI,IAAK,GAAK,EAAG,EAAG,EAAG,EAAG,EAAG,YAAa,EAAG,cAAe,EAAG,KACxFA,EAAY,YAAa,EAAG,IAAK,IAAM,EAAG,EAAG,EAAG,EAAG,EAAG,aAAc,EAAG,cAAe,IAAK,MAC3FA,EAAY,YAAa,GAAI,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,UAAW,EAAG,WAAY,EAAG,GAEjFA,EAAY,OAAQ,GAAI,IAAM,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,OAAQ,EAAG,YAAa,EAAG,KAC3EA,EAAY,OAAQ,EAAG,KAAM,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,OAAQ,EAAG,OAAQ,EAAG,IAEzE,SAASA,EAAYC,EAAMC,EAAMC,EAAGC,EAAIC,EAAMC,EAASC,EAAUC,EAASC,EAAUC,EAAKC,EAAMC,EAAOC,EAAMC,GAIxG,MAAO,CAAEb,KAAMA,EAAMc,OAHX,CAAEC,aAAcd,EAAMe,cAAeb,EAAIc,aAAcb,GAGjCc,cAFrB,CAAEC,KAAMb,EAAUc,MAAOf,GAEegB,eADxC,CAAEF,KAAMX,EAAUY,MAAOb,GACmCe,MAAOpB,EAAGqB,mBAAoBd,EAAKe,gBAAiBd,EAAMe,WAAYd,EAAOe,aAAcd,EAAMe,eAAgBd,GAK5L,MAAMe,EAAU,IAAI,EACpB,SAASC,EAAe5B,EAAM6B,GAC1B,MAAMC,EAAY,GAClB,IAAIC,EAAS/B,EACTgC,EAAW,EACXC,EAAM,EACV,IAAK,MAAMC,KAASrC,EAOhB,GANIqC,EAAMrB,OAAOC,cAAgBiB,IAC7BD,EAAUK,KAAK,CAAED,MAAOA,EAAOE,MAAOH,EAAKpB,OAAQ,IAAIwB,MAAMR,GAAOS,QAAS,KAAMC,QAAS,IAC5FR,GAAUG,EAAMrB,OAAOC,aACvBkB,GAAYE,EAAMrB,OAAOC,aACzBmB,KAEAF,GAAU,EACV,MAKR,MAAMS,EAAMxC,EAAOgC,EACnB,IAAK,MAAMS,KAAQX,EAAW,CAC1B,MAAMY,EAAM5J,KAAK8C,MAAM4G,EAAMC,EAAKP,MAAMrB,OAAOC,cAEzC6B,GAD0B,GAAdF,EAAKL,MAAa,EAAIN,EAAUW,EAAKL,MAAQ,GAAGG,OAAS,GACjDG,EACpBE,EAAoBH,EAAKL,OAASN,EAAU/H,OAAS,EAAI,CAAEmH,KAAM,EAAGC,MAAO,GAAMW,EAAUW,EAAKL,MAAQ,GAAGF,MAAMjB,cACjH4B,EAAO/J,KAAKgK,IAAI,EAAGL,EAAKP,MAAMd,eAAeF,KAAM0B,EAAkB1B,MACrE6B,EAAOjK,KAAKgK,IAAI,GAAU,GAANJ,GAAa,EAAID,EAAKP,MAAMrB,OAAOE,eAAgB0B,EAAKP,MAAMd,eAAeD,MAAOyB,EAAkBzB,OAC1HvF,EAAQoH,EAAWnB,EAAMgB,EAAMF,EAAQI,EAAMJ,EAAQI,GAC3D,IAAK,IAAIjF,EAAI,EAAGA,EAAI+D,EAAM/D,IAAK,CAC3B,MAAMmF,EAAM,CAAEf,MAAOO,EAAMS,OAAQ,EAAGC,UAAW,EAAGC,cAAe,EAAGC,WAAY,EAAGC,SAAU,EAAGC,WAAY,EAAGzF,EAAG,GACpH2E,EAAK5B,OAAO/C,GAAKmF,EAEjBA,EAAIC,OAAuB,GAAdT,EAAKL,MAAa,EAAIN,EAAUW,EAAKL,MAAQ,GAAGvB,OAAO/C,GAAGqF,UAAY,EACnFF,EAAII,WAAaJ,EAAIC,OACrBD,EAAIK,SAAWL,EAAIE,UACnBF,EAAIM,WAAaN,EAAIE,UACrBF,EAAIE,UAAYvH,EAAMkC,GACtBmF,EAAIG,cAAgBH,EAAIE,UAAYF,EAAIC,OAAS,EACjDT,EAAKH,QAAUxJ,KAAKgK,IAAIL,EAAKH,QAASW,EAAIC,QAC1CT,EAAKF,OAASzJ,KAAK0K,IAAIf,EAAKF,OAAQU,EAAIE,YAGhD,KAAOrB,EAAUA,EAAU/H,OAAS,GAAGuI,SAAWtC,GAC9C8B,EAAU2B,MAEd3B,EAAUA,EAAU/H,OAAS,GAAGwI,OAASvC,EAAO,EAChD,IAAK,IAAIlC,EAAI,EAAGA,EAAI+D,EAAM/D,IACtBgE,EAAUA,EAAU/H,OAAS,GAAG8G,OAAO/C,GAAGqF,UAAYnD,EAAO,EAIjE,OAFA0D,QAAQC,IAAI,8BACZD,QAAQC,IAAI7B,GACLA,EAEX,SAAS8B,EAAcC,EAAKhE,EAAQ/B,GAChC,GAAqB,GAAjB+B,EAAO9F,QAAe8J,EAAMhE,EAAO,GAAGgB,OAAO/C,GAAGoF,OAChD,OAAOrD,EAAO,GAClB,GAAIgE,GAAOhE,EAAOA,EAAO9F,OAAS,GAAG8G,OAAO/C,GAAGoF,OAC3C,OAAOrD,EAAOA,EAAO9F,OAAS,GAClC,IAAK,MAAMmI,KAASrC,EAChB,GAAIgE,GAAO3B,EAAMrB,OAAO/C,GAAGoF,QAAUW,GAAO3B,EAAMrB,OAAO/C,GAAGqF,UACxD,OAAOjB,EAGf,OADAwB,QAAQC,IAAI,6BAA+BE,EAAM,OAAShE,EAAS,MAAQ/B,GACpE,KAYX,SAASgG,EAAmBC,EAAMC,EAAKlG,EAAGC,EAAGE,EAAGpD,GAE5C,KADAmJ,EAAMC,EAAsBD,KACT,OAAPA,GAAuB,SAAPA,EACxB,OAAO,KACX,IAAIE,EAdR,SAAuBH,EAAMC,EAAK/F,EAAGpD,GACjC,IAAIsJ,EAAOC,SAASC,cAAc,OAOlC,OAFAF,EAAKG,UAAY,mBAAqBN,EACtCD,EAAKQ,YAAYJ,GACVA,EAMKK,CAAcT,EAAMC,GAUhC,OATAE,EAAMO,MAAMC,SAAW,WACvBR,EAAMO,MAAME,KAAO7G,EAAElD,WAAa,KAClCsJ,EAAMO,MAAMG,IAAM7G,EAAEnD,WAAa,KAGjCsJ,EAAMO,MAAMI,gBAAkB,WAIvBX,EAEX,SAASY,EAAcf,EAAMC,EAAKhG,GAC9B,IAAImG,EAAOC,SAASC,cAAc,OAelC,OAdAF,EAAKG,UAAY,mBAAqBN,EAYtCG,EAAKM,MAAMM,OAAS/G,EAAEpD,WACtBmJ,EAAKQ,YAAYJ,GACVA,EAwDX,SAASa,EAAsBlH,EAAGC,EAAGmE,GACjC,MAAM+C,GAAKlH,EAAImE,EAAMrB,OAAO/C,GAAGoF,QAAUhB,EAAMrB,OAAO/C,GAAGsF,cACnD8B,EAASnH,GAAKmE,EAAMrB,OAAO/C,GAAGqF,UAAY,EAAI,EACpD,GAAwB,aAApBjB,EAAMA,MAAMnC,MAAuBmF,EACnC,MAAO,cACX,IAAI1E,EAAM0B,EAAMA,MAAMZ,mBACtB,MAAM6D,GAAU,EAAIxD,EAAQxG,QAAY,GAAJ2C,EAAa,GAAJC,IAAY,EACzD,IAAIqH,EAAU,EAAItM,KAAK8C,MAAMuJ,EAAQjD,EAAMA,MAAMX,iBA2BjD,MA1BwB,aAApBW,EAAMA,MAAMnC,KACRkF,EAAI,IACJzE,EAAM,KACN4E,EAAU,GAELH,EAAI,KACTzE,EAAM,KACN4E,EAAU,GAGW,QAApBlD,EAAMA,MAAMnC,OACjBS,EAAM,KAMF4E,EADAH,EAAI,IACM,EAELA,EAAI,MACC,EAGA,GAGXzE,EAAM4E,EAEjB,SAASnB,EAAsBD,GAS3B,OARI,YACIA,IAAQA,EAAIqB,SAAS,WAAarB,EAAIqB,SAAS,UAAYrB,EAAIqB,SAAS,WACxErB,EAAM,QAAUA,EAEXA,GAAOA,EAAIsB,SAAS,kBACzBtB,EAAM,OAGPA,EAmBX,SAASuB,EAAQvF,EAAM6B,EAAM2D,EAAO1H,EAAGC,EAAG0H,EAAM9J,EAAG+J,EAASC,GACxD,MAAMC,GAAK,QAAwBjK,EAAE,GAAIA,EAAE,IACrCkK,GAAK,QAAwBlK,EAAE,GAAIA,EAAE,IACrCmK,EAAKhN,KAAK0K,IAAI,EAAG1K,KAAK8C,MAAMkC,EAAI8H,IAChCG,EAAKjN,KAAK0K,IAAI,EAAG1K,KAAK8C,MAAMmC,EAAI8H,IAChCG,EAAKlN,KAAKgK,IAAIjB,EAAO,EAAG/I,KAAK8C,MAAMkC,EAAI8H,IACvCK,EAAKnN,KAAKgK,IAAI9C,EAAO,EAAGlH,KAAK8C,MAAMmC,EAAI8H,IACvCK,EAAK,IACLC,GAAS,SAAyBD,EAAIA,GACtCE,GAAS,SAAyBF,EAAIA,GAC5C,IAAK,IAAIrM,EAAIiM,EAAIjM,GAAKmM,EAAInM,IACtB,IAAK,IAAIsD,EAAI4I,EAAI5I,GAAK8I,EAAI9I,IAAK,CAC3B,MAAMkJ,EAAKxM,EAAIiE,EACTwI,EAAKnJ,EAAIY,EACf,GAAIsI,EAAKA,EAAKC,EAAKA,GAAMV,EAAKC,EAAK,GAAK,CACpC,MAAMU,EAAK1M,EAAIf,KAAK8C,MAAMuK,EAASG,GAC7BE,EAAKrJ,EAAIrE,KAAK8C,MAAMwK,EAASC,GACnC,GAAIE,EAAK,GAAKC,EAAK,GAAKD,GAAM1E,GAAQ2E,GAAMxG,EACxC,SACJ,MAAMiC,GAAM,QAAcJ,EAAM0E,EAAIC,KAChCvE,GAAO,GAAKA,EAAMuD,EAAMzL,SAAY2L,GAAWA,EAAQzD,IAAU0D,EAAMN,SAASpD,KAChFuD,EAAMvD,GAAKwE,gBAAkBhB,EAC7BE,EAAMxD,KAAKF,IACPwD,EAAKJ,SAAS,UAAYI,EAAKJ,SAAS,WACxCG,EAAMvD,GAAKyE,OAAQ,MAM3C,SAAS1D,EAAWnB,EAAM8E,EAAU/B,EAAKM,GACrC,MAAM0B,EAAM,IAAIvE,MAAMR,GACtB,IAAIgF,GAAS,EACb,IAAK,IAAI/I,EAAI,EAAGA,EAAI+D,EAAM/D,IAAK,CAC3B,IAAIC,GAAI,QAAiB6G,EAAKM,GAC9B,MAAM4B,EAAO/I,EAAI8I,EACbA,GAAS,GAAK/N,KAAKiO,IAAID,GAAQH,IAC/B5I,EAAI8I,EAAQ/N,KAAKkO,KAAKF,IAC1BD,EAAQ9I,EACR6I,EAAI9I,GAAKC,EAEb,OAAO6I,EAEX,SAASK,EAAmBpF,EAAM2D,EAAOtD,EAAOyE,EAAUO,EAASlG,GAC/D,MAAMmG,EAASnE,EAAWnB,EAAMK,EAAMA,MAAMd,eAAeF,KAAMgB,EAAMI,SAAWJ,EAAMK,OAASL,EAAMI,SAAW4E,EAAShF,EAAMK,OAAS,EAAIvB,GAC9I,IAAK,IAAIlD,EAAI,EAAGA,EAAI+D,EAAM/D,IAAK,CAC3B,MAAMmF,EAAMf,EAAMrB,OAAO/C,GAIzB,GAFAmF,EAAIK,SAAWxK,KAAKgK,IAAIqE,EAAOrJ,GAAImF,EAAIE,UAAY,GACnDF,EAAIM,WAAaN,EAAIK,SACjBpB,EAAME,OAAS,GAAoB,GAAfF,EAAME,MAC1B,IAAK,IAAIrE,EAAIkF,EAAIC,OAAQnF,GAAKkF,EAAIE,UAAWpF,IAAK,CAC9C,MAAMkE,GAAM,QAAcJ,EAAM/D,EAAGC,GACnCyH,EAAMvD,GAAKmF,YAAclF,EAAMA,MAAMV,WACjCzD,GAAKkF,EAAIK,WACTkC,EAAMvD,GAAKwE,gBAAkBvE,EAAMA,MAAMV,WACzCgE,EAAMvD,GAAKyE,OAAQ,KAMvC,SAASW,EAAUC,EAASC,EAAOC,EAAK1J,EAAGC,EAAGwI,EAAIC,GAC9C,OAAOiB,EAAkBH,EAASC,EAAOC,EAAK1J,EAAGC,EAAG,EAAK,EAAKwI,EAAIC,GAEtE,SAASiB,EAAkBH,EAASC,EAAOC,EAAK1J,EAAGC,EAAGE,EAAGpD,EAAG0L,EAAIC,GAC5D1I,GAAK,IACLC,GAAK,IACDwI,IACAzI,GAAKyI,GACLC,IACAzI,GAAKyI,GACT,IAAII,EAAM,GAKV,OAJIY,EAAIE,aACJd,EAAIzE,KAAK2B,EAAmBwD,EAASE,EAAIE,YAAa5J,EAAGC,IACzDyJ,EAAIG,cACJf,EAAIzE,KAAK2B,EAAmByD,EAAOC,EAAIG,aAAc7J,EAAGC,IACrD6I,EAEX,SAASgB,EAAkB/F,EAAMyF,EAASC,EAAOzJ,EAAG+J,EAAOC,EAAMC,EAASC,EAAQC,GAC9E,MAAM1B,GAAK,SAAkB,GAAI,IACjC,IAAK,IAAIxI,EAAI+J,EAAM/J,GAAK8J,EAAO9J,IAAK,CAChC,MACMmH,EAASnH,GAAK8J,EAEdK,EAHMnK,GAAK+J,EAGCE,EAAU9C,GAAU+C,EAAUA,EAAUF,EAG1DV,EAAUC,EAASC,EAFPW,GAAI,QAAiB,EAAGA,EAAInO,OAAS,IAElB+D,EAAGC,EAAGwI,IAI7C,SAAS4B,EAAwBtG,EAAMyF,EAASC,EAAOzJ,EAAG+J,EAAOC,EAAMC,EAASK,EAAWJ,GACvF,MAAMzB,GAAK,SAAkB,GAAI,IACjC,IAAK,IAAIxI,EAAI8J,EAAO9J,GAAK+J,EAAM/J,IAAK,CAChC,MACMmH,EAASnH,GAAK8J,EACdQ,EAFMtK,GAAK+J,EAECE,EAAU9C,IAAWkD,EAAYL,EAAUK,EAC7D,IAAIE,EAAMD,EAAIX,YAAcW,EAAIX,YAAcW,EAAIV,aAClD,GAAIW,GAAqC,KAA9BA,EAAIC,OAAOD,EAAIvO,OAAS,GAAW,CAC1C,MAAMyO,EAAMC,SAASH,EAAIC,OAAOD,EAAIvO,OAAS,IAC7CuO,EAAMA,EAAII,UAAU,EAAGJ,EAAIvO,OAAS,GACpC,MAAM4O,EAAMN,EAAIV,aAAeU,EAAIV,aAAae,UAAU,EAAGL,EAAIV,aAAaiB,QAAQ,MAAQP,EAAIV,aAAae,UAAUL,EAAIV,aAAaiB,QAAQ,KAAO,GAAK,KAE9J,IAAK,IAAI/O,EAAI,EAAGA,EAAI2O,EAAK3O,IAAK,CAC1B,IAAIgP,EAAK9K,EAAIlE,EAKbwN,EAAUC,EAASC,EAAOuB,EAAwBT,EAAKC,EAAKK,GAAM9O,EAAI,GAAGe,WAAa,SAAUkD,EAAG+K,EAAItC,GACvGc,EAAUC,EAASC,EAAOuB,EAAwBT,EAAKC,EAAKK,GAAM9O,EAAI,GAAGe,WAAa,UAAWkD,EAAI,EAAG+K,EAAItC,GAEhHxI,GAAKyK,EAAM,OAOXnB,EAAUC,EAASC,EAAOuB,EAAwBT,EAAKC,EAAK,KAAM,SAAUxK,EAAGC,EAAGwI,GAClFc,EAAUC,EAASC,EAAOuB,EAAwBT,EAAKC,EAAK,KAAM,UAAWxK,EAAI,EAAGC,EAAGwI,IA0EnG,SAASuC,EAAwBtI,EAAKuI,EAAUC,EAAWC,GAIvD,MADU,CAAEvB,aAFEqB,GAAsBvI,EAAIkH,aAEPuB,EAAQtB,aAD7BnH,EAAImH,cAAgBqB,GAAwBxI,EAAImH,cAAgBsB,EAAS,MAIzF,SAASC,EAAkB1I,GAEvB,MADU,CAAEkH,YAAalH,EAAKmH,aAAcnH,EAAM,SAGtD,SAAS2I,EAAsB3I,GAE3B,MADU,CAAEkH,YAAa,KAAMC,aAAcnH,GAgEjD,SAAS4I,EAAalH,GAClB,IAAImH,EAAK,CAAC,CAAE3B,YAAa,WA4BzB,OA3BIxF,EAAME,OAAS,GAAKF,EAAME,OAAS,GACnCiH,EAAGlH,KAAK,CAAEuF,YAAa,YAEvBxF,EAAME,OAAS,GAAoB,GAAfF,EAAME,OAAcF,EAAME,OAAS,GACvDiH,EAAGlH,KAAK+G,EAAkB,YAE1BhH,EAAME,OAAS,GAAKF,EAAME,OAAS,GACnCiH,EAAGlH,KAAK,CAAEuF,YAAa,cAEvBxF,EAAME,OAAS,GAAKF,EAAME,OAAS,GACnCiH,EAAGlH,KAAK+G,EAAkB,SAE1BhH,EAAME,OAAS,GAAKF,EAAME,OAAS,GACnCiH,EAAGlH,KAAK+G,EAAkB,YAEX,GAAfhH,EAAME,OACNiH,EAAGlH,KAAKgH,EAAsB,WAEf,GAAfjH,EAAME,OACNiH,EAAGlH,KAAK,CAAEuF,YAAa,WAEvBxF,EAAME,OAAS,GACfiH,EAAGlH,KAAK,CAAEuF,YAAa,WAEvBxF,EAAME,OAAS,GACfiH,EAAGlH,KAAKgH,EAAsB,YAEd,GAAbE,EAAGtP,OAAc,KAAOsP,GAAG,QAAiB,EAAGA,EAAGtP,OAAS,IAEtE,SAASuP,EAAepH,GACpB,IAAImH,EAAK,GA2BT,OA1BmB,GAAfnH,EAAME,QACNiH,EAAGlH,KAAK+G,EAAkB,gBAC1BG,EAAGlH,KAAK+G,EAAkB,kBAE1BhH,EAAME,OAAS,GAAKF,EAAME,OAAS,GACnCiH,EAAGlH,KAAK,CAAEuF,YAAa,YAEvBxF,EAAME,OAAS,GAAKF,EAAME,OAAS,GAAoB,GAAfF,EAAME,OAC9CiH,EAAGlH,KAAK+G,EAAkB,iBAEzBhH,EAAME,OAAS,GAAKF,EAAME,OAAS,GAAqB,GAAfF,EAAME,QAChDiH,EAAGlH,KAAKgH,EAAsB,eAE9BjH,EAAME,OAAS,GAAKF,EAAME,OAAS,GACnCiH,EAAGlH,KAAK+G,EAAkB,gBAEX,GAAfhH,EAAME,OACNiH,EAAGlH,KAAK+G,EAAkB,aAE1BhH,EAAME,OAAS,GACfiH,EAAGlH,KAAK,CAAEuF,YAAa,kBAER,GAAfxF,EAAME,QACNiH,EAAGlH,KAAK+G,EAAkB,cAC1BG,EAAGlH,KAAK+G,EAAkB,cAEV,GAAbG,EAAGtP,OAAc,KAAOsP,GAAG,QAAiB,EAAGA,EAAGtP,OAAS,IAEtE,SAASwP,EAAmBrH,GACxB,IAAImH,EAAK,GAuCT,OAtCInH,EAAME,OAAS,GAAoB,GAAfF,EAAME,QAC1BiH,EAAGlH,KAAK+G,EAAkB,WAC1BG,EAAGlH,KAAK,CAAEuF,YAAa,iBAER,GAAfxF,EAAME,OACNiH,EAAGlH,KAAK+G,EAAkB,cAEX,GAAfhH,EAAME,OAA6B,GAAfF,EAAME,OAC1BiH,EAAGlH,KAAK+G,EAAkB,cAEX,GAAfhH,EAAME,OAA6B,GAAfF,EAAME,QAC1BiH,EAAGlH,KAAK+G,EAAkB,YAC1BG,EAAGlH,KAAK+G,EAAkB,aAEX,GAAfhH,EAAME,OACNiH,EAAGlH,KAAK+G,EAAkB,aAEX,GAAfhH,EAAME,OAA6B,GAAfF,EAAME,OAC1BiH,EAAGlH,KAAK+G,EAAkB,UAEX,GAAfhH,EAAME,OAA6B,GAAfF,EAAME,OAA6B,GAAfF,EAAME,OAC9CiH,EAAGlH,KAAK+G,EAAkB,aAEX,GAAfhH,EAAME,OACNiH,EAAGlH,KAAK+G,EAAkB,WAEX,GAAfhH,EAAME,OAA6B,GAAfF,EAAME,OAC1BiH,EAAGlH,KAAK,CAAEuF,YAAa,UAER,GAAfxF,EAAME,OACNiH,EAAGlH,KAAK+G,EAAkB,aAEX,GAAfhH,EAAME,OAA6B,GAAfF,EAAME,OAC1BiH,EAAGlH,KAAK+G,EAAkB,cAE1BhH,EAAME,OAAS,GACfiH,EAAGlH,KAAK+G,EAAkB,cAEV,GAAbG,EAAGtP,OAAc,KAAOsP,GAAG,QAAiB,EAAGA,EAAGtP,OAAS,IAqZtE,SAASyP,EAAgC3H,EAAMyF,EAASC,EAAOkC,EAAUvH,EAAOjE,EAAGpD,EAAG6O,EAAIC,EAAIC,GAC1F,MAAMC,EAAK/Q,KAAKgR,KAAK7L,EAAI,KACnB8L,EAAKjR,KAAKgR,KAAKjP,EAAI,KACnBiD,GAAI,QAAiB+L,EAAIhI,EAAOgI,GACtC,IAAI9L,EAAI2L,EAbZ,SAAoCxH,EAAOwH,EAAIC,GAC3C,MAAM1E,EAAI0E,GAAK,QAAwBD,EAAIC,GAAMD,EACjD,IAAI9C,EAAM9N,KAAK8C,MAAMsG,EAAMI,SAAWJ,EAAMK,OAASL,EAAMI,SAAW2C,GACtE,OAAI2B,EAAM1E,EAAMI,QACLJ,EAAMI,QACbsE,EAAM1E,EAAMK,OACLL,EAAMK,OACVqE,EAMMoD,CAA2B9H,EAAOwH,EAAIC,IAAM,QAAiBzH,EAAMI,QAASJ,EAAMK,QAC/F,IAAK,IAAIgE,EAAKzN,KAAK0K,IAAI,EAAG1F,EAAI+L,GAAKtD,GAAMzN,KAAKgK,IAAIhF,EAAI+L,EAAIhI,EAAO,GAAI0E,IACjExI,EAAIjF,KAAK0K,IAAItB,EAAMrB,OAAO0F,GAAIlD,WAAa,EAAGvK,KAAKgK,IAAIZ,EAAMrB,OAAO0F,GAAIhD,WAAawG,EAAK,EAAGhM,IAE7F6L,IACA7L,EAAIjF,KAAKgK,IAAI8G,EAAS7L,IAC1B,IAAIkM,EAAQxC,EAAkBH,EAASC,EAAOkC,EAAU3L,EAAGC,IAC3D,QAAmBkM,EAAO,GAC1BC,EAAeD,EAAO,IAEnB,SAASC,EAAeD,EAAOE,GAC9BrR,KAAKQ,SAAW6Q,IAChB,QAASF,GA2FF,SAASG,IACpB,GAAI,IACA,OAMOhG,SAASiG,KACTjG,SAASkG,gBACpB,IAAIC,EAAKnG,SAASiG,KAAKG,aACnBC,EAAK3R,KAAK0K,IAAIkH,OAAOC,WAAYvG,SAASiG,KAAKO,aAEnD,IAAI5K,EAAOlH,KAAKgR,KAAKS,EATb,IAUJ1I,EAAO/I,KAAKgR,KAAKW,EAXb,IAcR/G,QAAQC,IAAI,sCAAwC9B,EAAO,gBAAkB7B,EAAO,SACpF,IAAI6K,EAAM,qBACNC,EAAY1G,SAAS2G,eAAeF,GAOxC,IANiB,MAAbC,IACAA,EAAY1G,SAASC,cAAc,OACnCyG,EAAUE,GAAKH,EACfnH,QAAQC,IAAI,iCACZS,SAASiG,KAAKY,QAAQH,IAEnBA,EAAUI,YACbJ,EAAUK,YAAYL,EAAUI,YAEpC,MAAMrL,EAAS+B,EAAe5B,EAAM6B,GACpC,IAAI2D,EAAQ,IAAInD,MAAMR,EAAO7B,GACzBoL,EAAOhH,SAASC,cAAc,OAClCyG,EAAUvG,YAAY6G,GACtBA,EAAK9G,UAAY,aACjB8G,EAAK3G,MAAM4G,MAAQZ,EAAG7P,WAAa,KACnCwQ,EAAK3G,MAAM5D,OAAS0J,EAAG3P,WAAa,KACpCwQ,EAAKE,UAAUC,IAAI,cACnB,IAAIjE,EAAUlD,SAASC,cAAc,OACrCiD,EAAQ7C,MAAM4G,MAAQZ,EAAG7P,WAAa,KACtC0M,EAAQ7C,MAAM5D,OAAS0J,EAAG3P,WAAa,KACvC0M,EAAQ7C,MAAMC,SAAW,WACzB4C,EAAQ7C,MAAME,KAAO,MACrB2C,EAAQ7C,MAAMG,IAAM,MACpB0C,EAAQgE,UAAUC,IAAI,gBACtBT,EAAUvG,YAAY+C,GACtB,IAAI5G,EAAQ0D,SAASC,cAAc,OACnC3D,EAAM+D,MAAM4G,MAAQZ,EAAG7P,WAAa,KACpC8F,EAAM+D,MAAM5D,OAAS0J,EAAG3P,WAAa,KACrC8F,EAAM+D,MAAMC,SAAW,WACvBhE,EAAM+D,MAAME,KAAO,MACnBjE,EAAM+D,MAAMG,IAAM,MAClBlE,EAAM4K,UAAUC,IAAI,cACpBT,EAAUvG,YAAY7D,GACtB,IAAI6G,EAAQnD,SAASC,cAAc,OACnCkD,EAAM9C,MAAM4G,MAAQZ,EAAG7P,WAAa,KACpC2M,EAAM9C,MAAM5D,OAAS0J,EAAG3P,WAAa,KACrC2M,EAAM9C,MAAMC,SAAW,WACvB6C,EAAM9C,MAAME,KAAO,MACnB4C,EAAM9C,MAAMG,IAAM,MAClB2C,EAAM+D,UAAUC,IAAI,gBAEpBT,EAAUvG,YAAYgD,GACtB,IAAK,IAAI1N,EAAI,EAAGA,EAAIgI,EAAMhI,IACtB,IAAK,IAAIsD,EAAI,EAAGA,EAAI6C,EAAM7C,IAAK,CAC3B,MAAM8E,GAAM,QAAcJ,EAAMhI,EAAGsD,GAC7BgH,EAAO,GACbA,EAAKrG,EAAIjE,EACTsK,EAAKpG,EAAIZ,EACTgH,EAAKjC,MAAQ0B,EAAczG,EAAG0C,EAAQhG,GACtCsK,EAAKqH,YAAcxG,EAAsBnL,EAAGsD,EAAGgH,EAAKjC,OACpDsD,EAAMvD,GAAOkC,EAGrB,IAAK,MAAMjC,KAASrC,EAChBoH,EAAmBpF,EAAM2D,EAAOtD,EAAO,EAAGA,EAAMA,MAAMrB,OAAOE,cAAemB,EAAMA,MAAMrB,OAAOG,cAE/FnB,EAAO9F,OAAS,GAjgBxB,SAAiCiG,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,GACjE,IAAIrF,EAAQrC,EAAO,GACnB,MAAM4L,EAAWzI,EAAWnB,EAAM,IAAK,EAAG/I,KAAKgK,IAAI,EAAoC,KAAhCZ,EAAMK,OAASL,EAAMI,WACtEoJ,EAAY1I,EAAWnB,EAAM,GAAK,EAAG/I,KAAKgK,IAAI,EAAoC,KAAhCZ,EAAMK,OAASL,EAAMI,WACvEqJ,EAAU7S,KAAKgK,IAAqC,KAAhCZ,EAAMK,OAASL,EAAMI,SAAiB,GAC1DsJ,EAAW9S,KAAKgK,IAAqC,KAAhCZ,EAAMK,OAASL,EAAMI,SAAiB,GACjE,IAAK,IAAIxE,EAAI,EAAGA,EAAI+D,EAAM/D,IAAK,CAC3B,MAAMmF,EAAMf,EAAMrB,OAAO/C,GACnB7B,EAAKgH,EAAIC,OAASyI,EAAUF,EAAS3N,GACrC3B,EAAK8G,EAAIE,UAAYyI,EAAWF,EAAU5N,GAChDmF,EAAII,WAAavK,KAAK8C,MAAMK,GAC5BgH,EAAIK,SAAWxK,KAAK8C,MAAMO,GAC1B8G,EAAIM,WAAazK,KAAK8C,MAAMO,GAE5B,IAAK,IAAI4B,EAAI9B,EAAI8B,GAAK5B,EAAI4B,IAAK,CAC3B,MAAMkE,GAAM,QAAcJ,EAAM/D,EAAGC,GAC/ByH,EAAMvD,GAAKC,OAASA,IACpBsD,EAAMvD,GAAKwE,gBAAkB,kBAC7BjB,EAAMvD,GAAKyE,OAAQ,GAW3B,IAAK,IAAI3I,EAAI9B,EAAK,EAAG8B,GAAK5B,EAAK,EAAG4B,IAE9ByH,GADY,QAAc3D,EAAM/D,EAAGC,IACxBqJ,YAAc,kBAGjC,IAAK,IAAItJ,EAAI,EAAGA,EAAI+D,EAAO,EAAG/D,IAC1B,GAA8B,IAA1B,QAAiB,EAAG,IAChBhF,KAAKiO,IAAI7E,EAAMrB,OAAO/C,GAAGwF,SAAWpB,EAAMrB,OAAO/C,EAAI,GAAGwF,WAAa,EAAG,CACxE,IAAIvF,EAAIjF,KAAK0K,IAAItB,EAAMrB,OAAO/C,GAAGwF,SAAUpB,EAAMrB,OAAO/C,EAAI,GAAGwF,UACjC,IAA1B,QAAiB,EAAG,GACpB6E,EAAwBtG,EAAMyF,EAASC,EAAOzJ,EAAGC,EAAGA,EAAI,EAAGmL,EAAkB,sBAAuB,KAAMC,EAAsB,oBAEhIhB,EAAwBtG,EAAMyF,EAASC,EAAOzJ,EAAGC,EAAGA,EAAI,EAAGmL,EAAkB,uBAAwB,KAAMC,EAAsB,qBACrI3D,GAAM,QAAc3D,EAAM/D,EAAGC,IAAI8N,cAAgB,EACjDrG,GAAM,QAAc3D,EAAM/D,EAAI,EAAGC,IAAI8N,cAAgB,EACrDrG,GAAM,QAAc3D,EAAM/D,EAAGC,EAAI,IAAI8N,cAAgB,EACrDrG,GAAM,QAAc3D,EAAM/D,EAAI,EAAGC,EAAI,IAAI8N,cAAgB,EACzD/N,GAAK,GAodbgO,CAAwB9L,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,GAChE,IAAIwE,EAAS,KACTlM,EAAO9F,OAAS,IAChBgS,EAnkBR,SAA6B/L,EAAM6B,EAAM2D,EAAO3F,GAC5C,IAAIqC,EAAQrC,EAAO,GACfmM,EAAM,GACNxI,EAAM,IACV,IAAK,IAAI1F,GAAI,QAAiB,EAAG,GAAIA,EAAI+D,EAAO,EAAG/D,IAAK,CACpD,IAAI/B,EAAKmG,EAAMrB,OAAO/C,GAAGwF,SACrBvF,EAAIjF,KAAK0K,IAAItB,EAAMrB,OAAO/C,GAAGoF,OAAS,GAAIhB,EAAMrB,OAAO/C,GAAGoF,OAAShB,EAAMrB,OAAO/C,GAAGqF,WAAa,EAAGpH,EAAKjD,KAAKgR,MAAK,QAAwBhR,KAAK0K,IAAoC,IAAhCtB,EAAMrB,OAAO/C,GAAGsF,cAAsB,GAAItK,KAAK0K,IAAoC,IAAhCtB,EAAMrB,OAAO/C,GAAGsF,cAAsB,MAChP,GAAIrH,EAAKgC,GAAK,EAAG,CACb,MAAMkO,EAAuC,IAA1B,QAAiB,EAAG,GACvC,IAAIC,EAAQ,GACZ1I,EAAM1K,KAAKgK,IAAIU,EAAKzF,GACpB,IAAK,IAAI8K,EAAK9K,EAAG8K,GAAM9M,EAAI8M,IAAM,CAC7B,MAAM5K,EAAI4K,GAAM9K,EAAI,EAAIjF,KAAKgK,IAAI,GAAG,QAAiB,EAAG,IACxD,IAAK,IAAIqJ,EAAKrO,EAAIG,EAAGkO,GAAMrO,EAAIG,EAAGkO,IAAM,CACpC,MAAMlK,GAAM,QAAcJ,EAAMsK,EAAItD,GACpCrD,EAAMvD,GAAKmF,YAAc,KACrB6E,IACAzG,EAAMvD,GAAKwE,gBAAkB,MACjCvE,EAAMrB,OAAOsL,GAAI7I,SAAWxK,KAAKgK,IAAIZ,EAAMrB,OAAOsL,GAAI7I,SAAUuF,EAAK,GACjEoD,IACA/J,EAAMrB,OAAOsL,GAAI5I,WAAazK,KAAKgK,IAAIZ,EAAMrB,OAAOsL,GAAI5I,WAAYsF,EAAK,IAC7ErD,EAAMvD,GAAKyE,OAAQ,EACnBwF,EAAM/J,KAAKF,IAGnB+J,EAAI7J,KAAK,CAAEiK,QAAStO,EAAGuO,MAAOtQ,EAAI6I,IAAK7G,EAAGuO,UAAWJ,EAAOD,YAAY,IACxEnO,IAAK,QAAiB,EAAG,IAGjC,MAAO,CAAEiO,OAAQC,EAAKO,SAAU/I,GAsiBnBgJ,CAAoBxM,EAAM6B,EAAM2D,EAAO3F,GA9kBxD,SAA0BG,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,GAC1D,IAAIrF,EAAQrC,EAAO,GACnB,IAAK,IAAI/B,EAAI,EAAGA,EAAI+D,EAAM/D,IACtB,IAAI,QAAiB,EAAG,GAAK,EAAG,CAC5B,IAAIC,EAAImE,EAAMrB,OAAO/C,GAAGwF,SAEpBkC,GADQ,QAAc3D,EAAM/D,EAAGC,IACpB2I,OACXW,EAAUC,EAASC,EAAO,CAAEG,YAAa,aAAe5J,EAAGC,IAwkBnE0O,CAAiBzM,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,IAEzD,IAAImF,EAAY,KACZ7M,EAAO9F,OAAS,IA10BxB,SAA2BiG,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,GAC3D,IAAIrF,EAAQrC,EAAO,GACnB,IAAK,IAAI/B,EAAI,EAAGA,EAAI+D,EAAM/D,IACtB,IAAI,QAAiB,EAAG,GAAK,EAAG,CAC5B,MAAMmF,EAAMf,EAAMrB,OAAO/C,GACnBpD,GAAI,QAAiB,EAAG,GAC9B,IAAIiS,GAAQ,EACR/H,GAAO,EACX,OAAQlK,GACJ,KAAK,EACL,KAAK,EACL,KAAK,EACDiS,EAAO1J,EAAIM,WACXqB,EAAM9L,KAAK0K,IAAIP,EAAIC,OAAQyJ,GAAO,QAAiB,EAAG,IACtD/E,EAAkB/F,EAAMyF,EAASC,EAAOzJ,EAAG6O,EAAM/H,EAAK,CAAC,CAAE8C,YAAa,eAAiB,CAAEA,YAAa,eAAiB,CAAEA,YAAa,eAAiB,CAAEA,YAAa,eAAiB,CAAEA,YAAa,gBAAkB,CAAC,CAAEA,YAAa,mBAAqB,MAC7P,MACJ,KAAK,EACL,KAAK,EACL,KAAK,EACG5J,EAAI+D,EAAO,GAAK/I,KAAKiO,IAAI7E,EAAMrB,OAAO/C,GAAGyF,WAAarB,EAAMrB,OAAO/C,EAAI,GAAGyF,aAAe,IACzFoJ,EAAO7T,KAAK0K,IAAItB,EAAMrB,OAAO/C,GAAGyF,WAAYrB,EAAMrB,OAAO/C,EAAI,GAAGyF,YAChEqB,EAAM9L,KAAK0K,IAAIP,EAAIC,OAAQyJ,EAAO,GAClCxE,EAAwBtG,EAAMyF,EAASC,EAAOzJ,EAAG6O,EAAM/H,EAAK,CAAE8C,YAAa,4BAAmC,GAALhN,EAASwO,EAAkB,kBAAoB,CAAExB,YAAa,0BAA4B,CAAEA,YAAa,0BAClN5J,GAAK,KAozBrB8O,CAAkB5M,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,GACtDmF,EA1iBR,SAA2B1M,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,EAAOwE,GAClE,IAAI7J,EAAQrC,EAAO,GACfgN,EAAQ,GACZ,MAAMC,EAAOf,EAAS,SAAU9J,GAC5B,IAAK,IAAItH,KAAQoR,EAAOA,OACpB,GAAIpR,EAAK2R,UAAUjH,SAASpD,GACxB,OAAO,EAEf,OAAO,GACP,KACJ,IAAK,IAAIpI,EAAI,EAAGA,EAAI,EAAGA,IAKnB0L,EAAQvF,EAAM6B,EAAM2D,GAJZ,QAAiB,EAAG3D,EAAO,IAC3B,QAAiBK,EAAMI,QAAU,EAAGJ,EAAMK,QAGjB,OAAQ,CAAC,EAAG,GAAIuK,EAAMD,GAE3D,IAAK,IAAIhT,EAAI,EAAGA,EAAI,IAAKA,IAAK,CAC1B,MACMsK,EAAOqB,EADDqH,GAAM,QAAiB,EAAGA,EAAM9S,OAAS,KAErD,GAAIoK,EAAKpG,EAAImE,EAAMrB,OAAOsD,EAAKrG,GAAGoF,OAC9B,SACJ,MAAM6J,GAAO,QAAclL,EAAMsC,EAAKrG,EAAGqG,EAAKpG,EAAI,GAClD,IAAK8O,EAAMxH,SAAS0H,GAAO,CACvB,MAAMrR,GAAK,QAAiB,EAAG,GAC/B,IAAK,IAAIhB,EAAI,EAAGA,EAAIgB,EAAIhB,IACpB2M,EAAUC,EAASC,EAAO4B,EAAsB,WAAYhF,EAAKrG,EAAGqG,EAAKpG,GAAG,SAAkB,GAAI,MAG9G,OAAO8O,EA6gBSG,CAAkBhN,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,EAAOwE,IAEzElM,EAAO9F,OAAS,GAxxBxB,SAAuBiG,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,GACvD,IAAIrF,EAAQrC,EAAO,GACnB,IAAK,IAAI/B,EAAI,EAAGA,EAAI+D,EAAO,EAAG/D,IAC1B,IAAI,QAAiB,EAAG,GAAK,GACrBhF,KAAKiO,IAAI7E,EAAMrB,OAAO/C,GAAGyF,WAAarB,EAAMrB,OAAO/C,EAAI,GAAGyF,aAAe,EAAG,CAC5E,IAAIoJ,EAAO7T,KAAK0K,IAAItB,EAAMrB,OAAO/C,GAAGyF,WAAYrB,EAAMrB,OAAO/C,EAAI,GAAGyF,YACpE4E,EAAwBtG,EAAMyF,EAASC,EAAOzJ,EAAG6O,EAAMA,EAAO,EAAGzD,EAAkB,gBAAiB,KAAMA,EAAkB,cAC5H1D,GAAM,QAAc3D,EAAM/D,EAAG6O,IAAOd,cAAgB,EACpDrG,GAAM,QAAc3D,EAAM/D,EAAI,EAAG6O,IAAOd,cAAgB,EACxDrG,GAAM,QAAc3D,EAAM/D,EAAG6O,EAAO,IAAId,cAAgB,EACxDrG,GAAM,QAAc3D,EAAM/D,EAAI,EAAG6O,EAAO,IAAId,cAAgB,EAC5D/N,GAAK,GA8wBbmP,CAAcjN,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,GAClD1H,EAAO9F,OAAS,GAlzBxB,SAA0BiG,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,GAC1D,IAAIrF,EAAQrC,EAAO,GACnB,IAAK,IAAI/B,EAAI,EAAGA,EAAI+D,EAAO,EAAG/D,IAC1B,IAAI,QAAiB,EAAG,GAAK,GACrBhF,KAAKiO,IAAI7E,EAAMrB,OAAO/C,GAAGyF,WAAarB,EAAMrB,OAAO/C,EAAI,GAAGyF,aAAe,EAAG,CAC5E,IAAIoJ,EAAO7T,KAAK0K,IAAItB,EAAMrB,OAAO/C,GAAGyF,WAAYrB,EAAMrB,OAAO/C,EAAI,GAAGyF,YAGpE4E,EAAwBtG,EAAMyF,EAASC,EAAOzJ,EAAG6O,EAFvC7T,KAAK0K,IAAItB,EAAMrB,OAAO/C,GAAGoF,OAAS,EAAGhB,EAAMrB,OAAO/C,EAAI,GAAGoF,OAAS,EAAGyJ,GAAO,QAAiB,EAAG,IAE9C,CAAEjF,YAAa,qBAAuB,CAAEA,YAAa,mBAAqBwB,EAAkB,mBACxJpL,GAAK,GA0yBboP,CAAiBlN,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,GACrD1H,EAAO9F,OAAS,GAtyBxB,SAA2BiG,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,GAC3D,IAAIrF,EAAQrC,EAAO,GACnB,IAAK,IAAI/B,EAAI,EAAGA,EAAI+D,EAAM/D,IACtB,IAAI,QAAiB,EAAG,GAAK,EAAG,CAC5B,IAAI6O,EAAOzK,EAAMrB,OAAO/C,GAAGyF,WAE3BqE,EAAkB/F,EAAMyF,EAASC,EAAOzJ,EAAG6O,EADjC7T,KAAK0K,IAAItB,EAAMrB,OAAO/C,GAAGoF,OAAQyJ,GAAO,QAAiB,EAAG,KAChB,CAAC,CAAEjF,YAAa,iBAAmB,CAAEA,YAAa,iBAAmB,CAAEA,YAAa,kBAAoB,CAAC,CAAEA,YAAa,cAAgB,CAAEA,YAAa,eAAiB,CAACwB,EAAkB,iBAAkBA,EAAkB,oBAiyBzRiE,CAAkBnN,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,GAC1D,IAAI6F,EAAS,KACTvN,EAAO9F,OAAS,IAChBqT,EAleR,SAA+BpN,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,GAC/D,MAAM8F,EAAYvU,KAAKQ,SAAW,GAC5BgU,EAAY,EAAC,QAAiB,EAAGzL,EAAO,IAAI,QAAiBA,EAAO,EAAGA,EAAO,IACpF,IAAI0L,EAAQF,EAAY,EAAIxL,EAAO,EAC/B2L,EAAQ1U,KAAK2U,OAAOJ,GAAaC,EAAU,GAAKzL,GAAQ,EAAIyL,EAAU,GAAK,GAAK,GAEhFpL,EAAQrC,EAAO,GACnB,MAAM4L,EAAWzI,EAAWnB,EAAM,GAAK,EAAG/I,KAAKgK,IAAI,EAAoC,KAAhCZ,EAAMK,OAASL,EAAMI,WAEtE4C,EAASlC,EAAWnB,EAAM,GAAK,EAAG/I,KAAKgK,IAAI,EAAoC,KAAhCZ,EAAMK,OAASL,EAAMI,WACpEqJ,EAAU7S,KAAKgK,IAAqC,KAAhCZ,EAAMK,OAASL,EAAMI,SAAiB,GAC1DsJ,EAAW9S,KAAKgK,IAAqC,KAAhCZ,EAAMK,OAASL,EAAMI,SAAiB,GAC3DoL,GAAO,QAAiB,EAAG,GAC3BC,GAAO,QAAiB,EAAG,GAC3BC,EAAa,IAAIvL,MAAMR,GAC7B,IAAK,IAAI/D,EAAI,EAAGA,EAAI+D,EAAM/D,IAAK,CAC3B,MAAMmF,EAAMf,EAAMrB,OAAO/C,GACzB,IAAI7B,EAAKgH,EAAIC,OAASyI,EAAUF,EAAS3N,GACrChF,KAAKiO,IAAIjJ,EAAI0P,IAAU,IACvBtI,EAAOpH,GAAK,GAChB,IAAI3B,EAAK8G,EAAIE,UAAYyI,EAAW1G,EAAOpH,GACvC+P,EAAO3L,EAAMI,QAA2C,IAAhCJ,EAAMK,OAASL,EAAMI,SACjD,MAAMwL,EAAKhV,KAAKiO,IAAIwG,EAAQzP,GACxBgQ,GAAM,GACN3R,EAAK8G,EAAIE,UACL2K,GAAM,IACND,EAAO5K,EAAIE,UAAY,IAEtB2K,GAAM,IACX3R,GAAM,EAAI2R,GAGVT,GACIvP,GAAKwP,EAAU,KACfnR,GAAMuR,EACNG,GAAQ/P,EAAIwP,EAAU,GAAKI,EAAOA,EAAO,GAEzC5P,GAAKwP,EAAU,KACfnR,GAAMwR,EACNE,GAAQ/P,EAAIwP,EAAU,GAAKK,EAAOA,EAAO,KAIzC7P,GAAKwP,EAAU,KACfnR,GAAMuR,EACNG,GAAQ/P,EAAIwP,EAAU,GAAKI,EAAOA,EAAO,GAEzC5P,GAAKwP,EAAU,KACfnR,GAAMwR,EACNE,GAAQ/P,EAAIwP,EAAU,GAAKK,EAAOA,EAAO,IAG7CxR,EAAK8G,EAAIE,YACThH,EAAK8G,EAAIE,WAEbF,EAAII,WAAavK,KAAK8C,MAAMK,GAC5BgH,EAAIK,SAAWxK,KAAK8C,MAAMiS,EAAO,GACjC5K,EAAIM,WAAazK,KAAK8C,MAAMO,GAC5ByR,EAAW9P,GAAKhF,KAAK8C,MAAMiS,GAAQ,EACnC,IAAK,IAAI9P,EAAI9B,EAAI8B,GAAK5B,EAAI4B,IAAK,CAC3B,MAAMkE,GAAM,QAAcJ,EAAM/D,EAAGC,GACnCyH,EAAMvD,GAAKwE,gBAAkBvE,EAAMA,MAAMV,WAErCgE,EAAMvD,GAAKmF,YADXrJ,GAAK8P,EACoB,QAEA3L,EAAMA,MAAMV,WAAa,SAClD1I,KAAKiO,IAAIhJ,EAAI8P,IAAS,GAAKC,EAAK,IAChCtI,EAAMvD,GAAKuJ,YAAc1S,KAAKQ,SAAW,GAAM,MAAQ,QAenE,IAAIyU,EAAQH,EAAWJ,GAAS,EAChC/F,EAAkBH,EAASC,EAAO2B,EAAkB,WAAYsE,EAAOO,EAAQ,IAE/E,IAAIC,EAAQnM,EAAO0L,EACnB,MAAMU,EAAK/L,EAAMK,OAAS,EACpB2L,EAAY,IAAI7L,MAAMR,GAC5B,IAAIsM,GAAU,QAAiB,EAAGtM,GAC9BuM,GAAU,QAAiB,EAAGvM,GAC9BwM,GAAU,QAAiB,EAAGxM,GAClC,IAAK,IAAI/D,EAAI,EAAGA,EAAI+D,EAAM/D,IAAK,CAC3B,GAAKuP,GAAavP,EAAIyP,IAAYF,GAAavP,EAAIyP,EAAQ,CACvDW,EAAUpQ,IAAM,EAChB,SAEJ,MAAMwQ,EAAMxV,KAAKgK,IAAIhK,KAAKiO,IAAIjJ,EAAIqQ,GAAUrV,KAAKiO,IAAIjJ,EAAIsQ,GAAUtV,KAAKiO,IAAIjJ,EAAIuQ,IAC1EE,EAAMzV,KAAKiO,IAAIjJ,EAAIkQ,GACnB/K,EAAMf,EAAMrB,OAAO/C,GACzB,IAAI7B,EAAKnD,KAAK0K,IAAIoK,EAAW9P,GAAImF,EAAIM,aAAegL,EAAM,EAAI,EAAI,GAC9DpS,EAAK+F,EAAMK,OAAS,EACxB,MAAMiM,EAAQD,GAAO,GAAY,GAAPD,EAC1BJ,EAAUpQ,GAAK0Q,EAAQP,EAAK,EAAY,GAAPK,EAAWnS,EAAK,EAAIA,EACrD,IAAK,IAAI4B,EAAI9B,EAAI8B,GAAK5B,EAAI4B,IAAK,CAC3B,MAAMkE,GAAM,QAAcJ,EAAM/D,EAAGC,GACnCyH,EAAMvD,GAAKmF,YAAc,aACrBrJ,GAAKkQ,GAAK,QAAiB,EAAG,GAC9BzI,EAAMvD,GAAKuJ,YAAc,MAEzBhG,EAAMvD,GAAKuJ,YADNzN,GAAU,GAAL9B,EAAgB,GAALgS,EACI,MAEA,MACzBlQ,GAAKkQ,IACDO,IAAkB,GAAPD,GAAmB,GAAPD,IAAavQ,GAAK5B,EACzCqJ,EAAMvD,GAAKmF,YAAc,MAGzB5B,EAAMvD,GAAKmF,YAAc,aACzB5B,EAAMvD,GAAKuJ,YAAc,QAG7BzN,GAAKkQ,IACLzI,EAAMvD,GAAKuJ,YAAczN,GAAKkQ,EAAMnV,KAAKQ,SAAW,GAAM,MAAQ,MAAS,eAIvF,IAAImV,EAAQP,EAAUF,GAAS,EAC/B,MAAMU,EAAgC,IAA1B,QAAiB,EAAG,GAChCjH,EAAkBH,EAASC,EAAO2B,EAAkB,aAAcwF,EAAMV,EAAQ,EAAIA,EAAQ,EAAGS,EAAQ,MAwDvG,MAAME,EAAM7V,KAAK8C,OAAO0R,EAAU,GAAKA,EAAU,IAAM,GAEvD,MADU,CAAEsB,cAAerB,EAAOW,UAAWA,EAAWF,MAAOA,EAAOS,MAAOA,EAAOI,OAAQrB,EAAOsB,OAAQf,EAAOgB,kBAAmBJ,EAAKK,gBAAiBpB,EAAWe,GAAO,GAyShKM,CAAsBjP,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,GAC/D1H,EAAO9F,OAAS,GAvS5B,SAAyBiG,EAAM6B,EAAM2D,EAAO3F,EAAQ0N,EAAOjG,EAASC,GAChE,IAAIrF,EAAQrC,EAAO,GACnB,MAAMgN,EAAQ,GACRqC,EAAS,GACTtT,EAAQoH,EAAWnB,EAAM,EAAG,EAAG,GACrC,IAAK,IAAI/D,EAAI,EAAGA,EAAI+D,EAAM/D,IAAK,CAC3B,MAAMmF,EAAMf,EAAMrB,OAAO/C,GACnB0I,GAAK,QAAiB,EAAG,GAC/B0I,EAAOpR,GAAKhF,KAAKgK,IAAI9C,EAAO,EAAGiD,EAAIE,UAAY,GAAKvH,EAAMkC,GAAK,EAC/DmF,EAAIM,WAAazK,KAAK8C,MAAMsT,EAAOpR,IACnCmF,EAAII,WAAaJ,EAAIC,OAAS,EAC9B,IAAK,IAAInH,EAAKkH,EAAII,WAAYtH,GAAMmT,EAAOpR,GAAI/B,IAAM,CACjD,MAAMkG,GAAM,QAAcJ,EAAM/D,EAAG/B,GACnCyJ,EAAMvD,GAAKmF,YAAclF,EAAMA,MAAMV,WACrC,IAAIzD,EAAIhC,EACH+B,EAAI+D,EAAO,EAAK,IACjB9D,GAAKyI,GAET,MAAM2I,GAAOrR,EAAI+D,EAAO,IAAM/D,EAAI+D,EAAO,IAAM9D,EAAImR,EAAOpR,KAAOC,EAAImR,EAAOpR,IAAM,KAE9EqR,GAAO,KAAOA,GAAO,IACrBtC,EAAM1K,KAAKF,GACXuD,EAAMvD,GAAKwE,gBAAkBvE,EAAMA,MAAMV,WACzCgE,EAAMvD,GAAKyE,OAAQ,GAGnBzD,EAAIM,WAAazK,KAAK0K,IAAIP,EAAIM,WAAYxH,EAAK,IAI3D,MACMG,EADOqR,EAAQ,EACH1L,EAAO,EAAI,EAC7B,IAAK,IAAI/D,EAAI5B,EAAK,EAAG4B,GAAK5B,EAAK,EAAG4B,IAAK,CACnC,MAAMmF,EAAMf,EAAMrB,OAAO/C,GACnBoR,EAASpW,KAAKgK,IAAI9C,EAAO,EAAGiD,EAAIE,UAAY,GAClD,IAAK,IAAIpF,EAAIkF,EAAIC,OAAQnF,GAAKmR,EAAQnR,IAAK,CACvC,MAAMkE,GAAM,QAAcJ,EAAM/D,EAAGC,GAC9B8O,EAAMxH,SAASpD,KAChB4K,EAAM1K,KAAKF,GACXuD,EAAMvD,GAAKwE,gBAAkBvE,EAAMA,MAAMV,WACzCgE,EAAMvD,GAAKyE,OAAQ,IAI/B,IAAK,IAAI5I,EAAIyP,EAAQ,EAAGzP,GAAKyP,EAAQ,EAAGzP,IAEpC,IAAK,IAAIC,EADGmE,EAAMrB,OAAO/C,GACRoF,OAAQnF,GAAKmR,EAAOpR,GAAIC,IAAK,CAC1C,MAAMkE,GAAM,QAAcJ,EAAM/D,EAAGC,GACnC,IAAIyC,EAAM1H,KAAKiO,IAAIjJ,EAAIyP,GAAS,EAAIrL,EAAMA,MAAMV,WAAa,QAClD,SAAPhB,GAAmBqM,EAAMxH,SAASpD,KAClC4K,EAAM1K,KAAKF,GACXuD,EAAMvD,GAAKmF,YAAc5G,EACzBgF,EAAMvD,GAAKyE,OAAQ,GAI/B,IAAK,IAAI5I,EAAI,EAAGA,EAAI+D,EAAM/D,IACN,GAAZlC,EAAMkC,KAEN0H,GADY,QAAc3D,EAAM/D,EAAGoR,EAAOpR,KAC/BsJ,YAAc,QACzBlF,EAAMrB,OAAO/C,GAAGyF,cAKxB,IAAK,IAAIzF,EAAI,EAAGA,EAAI+D,EAAO,EAAG/D,IAC1B,GAA8B,IAA1B,QAAiB,EAAG,IAChBhF,KAAKiO,IAAI7E,EAAMrB,OAAO/C,GAAGyF,WAAarB,EAAMrB,OAAO/C,EAAI,GAAGyF,aAAe,EAAG,CAC5E,IAAIxF,EAAIjF,KAAKgK,IAAI9C,EAAO,EAAGlH,KAAK2U,MAAM3U,KAAK0K,IAAItB,EAAMrB,OAAO/C,GAAGyF,WAAYrB,EAAMrB,OAAO/C,EAAI,GAAGyF,cACjE,IAA1B,QAAiB,EAAG,GACpB4E,EAAwBtG,EAAMyF,EAASC,EAAOzJ,EAAGC,EAAGA,EAAI,EAAGmL,EAAkB,qBAAsB,KAAMC,EAAsB,mBAE/HhB,EAAwBtG,EAAMyF,EAASC,EAAOzJ,EAAGC,EAAGA,EAAI,EAAGmL,EAAkB,sBAAuB,KAAMC,EAAsB,oBACpI3D,GAAM,QAAc3D,EAAM/D,EAAGC,IAAI8N,cAAgB,EACjDrG,GAAM,QAAc3D,EAAM/D,EAAI,EAAGC,IAAI8N,cAAgB,EACrDrG,GAAM,QAAc3D,EAAM/D,EAAGC,EAAI,IAAI8N,cAAgB,EACrDrG,GAAM,QAAc3D,EAAM/D,EAAI,EAAGC,EAAI,IAAI8N,cAAgB,EACzD/N,GAAK,GA2NTsR,CAAgBpP,EAAM6B,EAAM2D,EAAO3F,EAAQuN,EAAOwB,cAAetH,EAASC,IApwBtF,SAA4BvH,EAAM6B,EAAM2D,EAAO3F,EAAQuN,EAAQ9F,EAASC,GACpE,IAAK,MAAMrF,KAASrC,EAAQ,CACxB,MAAMwP,EAAS,GAAKnN,EAAMA,MAAMR,eAC1B4N,EAAO,EAAIpN,EAAMA,MAAMT,aAC7B,IAAK,IAAI5H,EAAI,EAAGA,EAAIwV,EAAQxV,IAAK,CAC7B,MAAM0V,EAAMjG,EAAepH,GAC3B,GAAIqN,EAAK,CACL,IAAIzR,GAAI,QAAiB,EAAG+D,EAAO,GACnC,GAAIuL,GAAyB,GAAflL,EAAME,OAActJ,KAAKiO,IAAIjJ,EAAIsP,EAAOwB,gBAAkB,EACpE,SACJ,IAAI7Q,EAAIjF,KAAKgK,IAAIZ,EAAMrB,OAAO/C,GAAGyF,WAAYvD,EAAO,GACpD,MAAMiC,GAAM,QAAcJ,EAAM/D,EAAGC,GACnC,GAAIyH,EAAMvD,GAAK4J,eAAiB,EAC5B,SACJ,GAAuB,eAAnB0D,EAAI7H,aAAmD,gBAAnB6H,EAAI7H,aAAoD,iBAAnB6H,EAAI7H,YAAgC,CAC7G,MAAMhN,GAAI,QAAiB,EAAG,GAC9B,IAAK,IAAIyC,EAAI,EAAGA,EAAIzC,EAAGyC,IACnBkK,EAAUC,EAASC,EAAOgI,EAAKzR,EAAGC,GAAG,SAAkB,GAAI,SAE9D,CACD,MAAMyR,EAA0B,YAAnBD,EAAI7H,YAA4B,GAAK,GAElDL,EAAUC,EAASC,EAAOgI,EAAKzR,EAAGC,GAAG,SAAkByR,EAAMA,IAEjEhK,EAAMvD,GAAK4J,iBAGnB,IAAK,IAAIhS,EAAI,EAAGA,EAAIyV,EAAMzV,IAAK,CAC3B,MAAM0V,EAAMnG,EAAalH,GACzB,GAAIqN,EAAK,CACL,IAAIzR,GAAI,QAAiB,EAAG+D,EAAO,GACnC,GAAIuL,GAAyB,GAAflL,EAAME,OAActJ,KAAKiO,IAAIjJ,EAAIsP,EAAOwB,gBAAkB,EACpE,SACJ,IAAI7Q,EAAIjF,KAAKgK,IAAIZ,EAAMrB,OAAO/C,GAAGyF,WAAYvD,EAAO,GACpD,MAAMiC,GAAM,QAAcJ,EAAM/D,EAAGC,GACnC,GAAIyH,EAAMvD,GAAK4J,eAAiB,EAC5B,SACJ,MAAM2D,EAA2B,UAApBD,EAAI5H,cAA+C,WAAnB4H,EAAI7H,YAA2B,GAAK,GAEjFL,EAAUC,EAASC,EAAOgI,EAAKzR,EAAGC,GAAG,SAAkByR,EAAMA,IAC7DhK,EAAMvD,GAAK4J,kBAIvB,KAAIhM,EAAO9F,QAAU,IAAMqT,EAE3B,IAAK,IAAItP,EAAI,EAAGA,EAAI+D,EAAM/D,IACtB,GAAIsP,EAAOc,UAAUpQ,IAAM,GAA+B,IAA1B,QAAiB,EAAG,IAAWhF,KAAKiO,IAAIqG,EAAOY,MAAQlQ,GAAK,EAAG,CAC3F,MAAMyR,EAAMnG,EAAavJ,EAAO,IAChC,GAAI0P,EAAK,CACL,MAAMxR,EAAIqP,EAAOc,UAAUpQ,GACrBmE,GAAM,QAAcJ,EAAM/D,EAAGC,GACnC,GAAIyH,EAAMvD,GAAK4J,eAAiB,EAC5B,SACJ,MAAM2D,EAA2B,UAApBD,EAAI5H,cAA+C,WAAnB4H,EAAI7H,YAA2B,GAAK,GACjFL,EAAUC,EAASC,EAAOgI,EAAKzR,EAAGC,GAAG,SAAkByR,EAAMA,IAC7DhK,EAAMvD,GAAK4J,kBA8sBvB4D,CAAmBzP,EAAM6B,EAAM2D,EAAO3F,EAAQuN,EAAQ9F,EAASC,GApInE,SAAgCvH,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,EAAOmF,EAAWX,EAAQqB,GAC1F,IAAK,MAAMlL,KAASrC,EAAQ,CACxB,MAAMnF,EAAI5B,KAAK0K,IAAI,EAAoC,IAAhCtB,EAAMK,OAASL,EAAMI,UAC5C,IAAK,IAAIzI,EAAI,EAAGA,EAAIa,EAAGb,IAAK,CACxB,MAAM0V,EAAMhG,EAAmBrH,GAC/B,GAAIqN,EAAK,CACL,IAAIzR,GAAI,QAAiB,EAAG+D,EAAO,GAC/B9D,EAAIjF,KAAK2U,OAAM,QAAgC,GAAfvL,EAAME,MAAa,EAAIF,EAAMrB,OAAO/C,GAAGuF,WAAa,EAAGnB,EAAMrB,OAAO/C,GAAGyF,WAAa,IACxH,MAAMtB,GAAM,QAAcJ,EAAM/D,EAAGC,GACnC,GAAIkE,GAAOuD,EAAMzL,QAAUkI,EAAM,IAAMuD,EAAMvD,GAAKyE,MAC9C,SAEJ,MAAMhL,EAAwB,SAAnB6T,EAAI7H,aAA6C,YAAnB6H,EAAI7H,aAAgD,aAAnB6H,EAAI7H,aAAiD,WAAnB6H,EAAI7H,aAA2B,QAAiB,EAAG,GAAK,EAC9JgI,EAAM5W,KAAKQ,SAAW,KAAQoC,EAAK,GAAI,SAAkB,GAAI,KAAM,SAAkB,GAAI,IACzFiU,EAAO7W,KAAKQ,SAAW,GAC7B,IAAK,IAAI6D,EAAI,EAAGA,EAAIzB,EAAIyB,IAAK,CACzB,MAAM8M,EAAQ5C,EAAUC,EAASC,EAAOgI,EAAKzR,EAAGC,GAAG,SAAkB,GAAI,KAAK,SAAkB,GAAI,MACpG,QAAakM,EAAOyF,GAChBC,IACA,QAAS1F,MAK7B,GAAIyC,EACA,IAAK,IAAI7S,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,MACMsK,EAAOqB,EADDkH,GAAU,QAAiB,EAAGA,EAAU3S,OAAS,MAE7D,QAAmBsN,EAAUC,EAASC,EAAO2B,EAAkB,cAAe/E,EAAKrG,EAAGqG,EAAKpG,GAAG,SAAkB,GAAI,KAAK,SAAkB,GAAI,KAAM,MAyG7J6R,CAAuB5P,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,EAAOmF,GA9LtE,SAAgC1M,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,EAAOwE,EAAQqB,GAC/E,GAAIvN,EAAO9F,OAAS,EAChB,IAAK,IAAIF,EAAI,EAAGA,EAAI,EAAGA,IACnB2P,EAAgC3H,EAAMyF,EAASC,EAAO,CAAEG,YAAa,WAAa7H,EAAO,GAAI,IAAK,KAQ1G,GANIA,EAAO9F,OAAS,GAAKgS,GAAUA,EAAOQ,SAAW1M,EAAO,GAAGyC,QAAU,IACjExJ,KAAKQ,UAAY,KACjBkQ,EAAgC3H,EAAMyF,EAASC,EAAO2B,EAAkB,aAAcrJ,EAAO,GAAI,KAAM,IAAK,KAAO,GAAKkM,EAASA,EAAOQ,SAAW,EAAI,MACvJzT,KAAKQ,UAAY,KACjBkQ,EAAgC3H,EAAMyF,EAASC,EAAO2B,EAAkB,aAAcrJ,EAAO,GAAI,KAAM,IAAK,KAAO,GAAKkM,EAASA,EAAOQ,SAAW,EAAI,OAE3J1M,EAAO9F,OAAS,EAAG,CACfjB,KAAKQ,UAAY,KACjBkQ,EAAgC3H,EAAMyF,EAASC,EAAO2B,EAAkB,UAAWrJ,EAAO,GAAI,IAAK,KACvG,MAAMgQ,GAAK,QAAiB,EAAG,GAC/B,IAAK,IAAIhW,EAAI,EAAGA,EAAIgW,EAAIhW,IACpB2P,EAAgC3H,EAAMyF,EAASC,EAAO2B,EAAkB,aAAcrJ,EAAO,GAAI,IAAK,KAM9G,GAJIA,EAAO9F,OAAS,IAChByP,EAAgC3H,EAAMyF,EAASC,EAAO,CAAEG,YAAa,cAAgB7H,EAAO,GAAI,IAAK,IAAK,IAC1G2J,EAAgC3H,EAAMyF,EAASC,EAAO,CAAEG,YAAa,cAAgB7H,EAAO,GAAI,IAAK,GAAI,KAEzGA,EAAO9F,OAAS,EAAG,CACnByP,EAAgC3H,EAAMyF,EAASC,EAAO2B,EAAkB,aAAcrJ,EAAO,GAAI,KAAM,IAAK,GAAK,IACjH,IAAK,IAAIhG,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAMoI,GAAM,QAAiB,EAAG,GAChCuH,EAAgC3H,EAAMyF,EAASC,EAAO2B,EAAkB,cAAgBjH,GAAMpC,EAAO,GAAW,GAAPoC,EAAW,IAAM,IAAY,GAAPA,EAAW,IAAM,IAAK,GAAK,KAOlK,GAJIpC,EAAO9F,OAAS,IAChByP,EAAgC3H,EAAMyF,EAASC,EAAO2B,EAAkB,WAAYrJ,EAAO,GAAI,IAAK,KACpG2J,EAAgC3H,EAAMyF,EAASC,EAAO2B,EAAkB,UAAWrJ,EAAO,GAAI,IAAK,MAEnGA,EAAO9F,OAAS,GAAKqT,EAAQ,CAC7B,MAAM0C,EAAMjQ,EAAO,GAAGgB,OAAOuM,EAAOwB,eAAezL,WAAY,QAAiB,EAAG,GAAK,EACxF,IAAK,IAAItJ,EAAI,EAAGA,EAAI,EAAGA,IACnBqQ,EAAezC,EAAkBH,EAASC,EAAO2B,EAAkB,WAAYkE,EAAOwB,eAAgB,SAAkB,EAAG,GAAIkB,EAAMjW,GAAc,IACnJqQ,EAAezC,EAAkBH,EAASC,EAAO2B,EAAkB,WAAYkE,EAAO2B,mBAAoB,SAAkB,EAAG,GAAI3B,EAAO4B,gBAAkB,EAAInV,GAAc,IAC9KqQ,EAAezC,EAAkBH,EAASC,EAAO2B,EAAkB,WAAYkE,EAAOyB,QAAS,SAAkB,EAAG,GAAIzB,EAAO0B,QAAS,SAAkB,EAAG,GAAKjV,GAAc,IAEpL,MAAMa,GAAI,QAAiB,EAAG,GACrB,GAALA,GACA+M,EAAkBH,EAASC,EAAO4B,EAAsB,cAAeiE,EAAOY,MAAQ,IAAKZ,EAAOqB,MAAQ,GACrG,GAAL/T,GACA+M,EAAkBH,EAASC,EAAO4B,EAAsB,cAAeiE,EAAOY,MAAQ,IAAKZ,EAAOqB,MAAQ,GAE9G5O,EAAO9F,OAAS,IACZjB,KAAKQ,UAAY,IACjBkQ,EAAgC3H,EAAMyF,EAASC,EAAO2B,EAAkB,UAAWrJ,EAAO,GAAI,KAAM,IAAK,IACzG/G,KAAKQ,UAAY,KACjBkQ,EAAgC3H,EAAMyF,EAASC,EAAO,CAAEG,YAAa,eAAiB7H,EAAO,GAAI,IAAK,KACtG/G,KAAKQ,UAAY,KACjBkQ,EAAgC3H,EAAMyF,EAASC,EAAO,CAAEG,YAAa,eAAiB7H,EAAO,GAAI,IAAK,KACtG/G,KAAKQ,UAAY,IACjBkQ,EAAgC3H,EAAMyF,EAASC,EAAO2B,EAAkB,SAAUrJ,EAAO,GAAI,IAAK,KAyI1GkQ,CAAuB/P,EAAM6B,EAAM2D,EAAO3F,EAAQyH,EAASC,EAAOwE,EAAQqB,GAxkC9E,SAAoBhC,EAAM4E,EAAchQ,EAAM6B,EAAM2D,GAKhD,IAJA,IAISrI,EAAI,EAAGA,EAAI6C,EAAM7C,IAAK,CAE3B,IAAI8S,EAAU7L,SAASC,cAAc,OACjC6L,EAAW9L,SAASC,cAAc,OACtC,IAAK,IAAIxK,EAAI,EAAGA,EAAIgI,EAAMhI,IAAK,CAE3B,MAAMsK,EAAOqB,GADH,QAAc3D,EAAMhI,EAAGsD,IAEjC,IAAIgT,EAAUF,EACVG,EAAWF,EACXG,EAAUpM,EAAsBE,EAAKqH,aACpC6E,IACDA,EAAU,SACdF,EAAUrL,EAAcqL,EAASE,EAAS,IACtC,YAEMlM,EAAKsC,iBAA2C,SAAxBtC,EAAKsC,iBAAiCtC,EAAKiD,aAAmC,SAApBjD,EAAKiD,cACzFjD,EAAKiD,YAAc,SAEvBjD,EAAKsC,kBACLtC,EAAKsC,gBAAkBxC,EAAsBE,EAAKsC,iBAC9CtC,EAAKsC,kBACL0J,EAAUrL,EAAcqL,EAAShM,EAAKsC,gBAAiB,KAE/D,IAAI6J,GAAO,EACPnM,EAAKiD,cACLjD,EAAKiD,YAAcnD,EAAsBE,EAAKiD,aAC1CjD,EAAKiD,cACLgJ,EAAWtL,EAAcsL,EAAUjM,EAAKiD,YAAa,GACrDkJ,GAAO,IAGVA,IACDF,EAAWtL,EAAcsL,EAAU,QAAS,IAGpDhF,EAAK7G,YAAY0L,GACjBD,EAAazL,YAAY2L,IAG7B,QAAO9E,EAAMxL,IACb,QAAOoQ,EAAcpQ,GA4hCrB2Q,CAAWnF,EAAM1K,EAAOV,EAAM6B,EAAM2D,IACpC,QAAO8B,EAAS1H,IAChB,QAAO2H,EAAO3H","file":"394.bundle.js","sourcesContent":["/*\n * A fast javascript implementation of simplex noise by Jonas Wagner\n\nBased on a speed-improved simplex noise algorithm for 2D, 3D and 4D in Java.\nWhich is based on example code by Stefan Gustavson (stegu@itn.liu.se).\nWith Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\nBetter rank ordering method by Stefan Gustavson in 2012.\n\n\n Copyright (c) 2018 Jonas Wagner\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n */\n(function() {\n  'use strict';\n\n  var F2 = 0.5 * (Math.sqrt(3.0) - 1.0);\n  var G2 = (3.0 - Math.sqrt(3.0)) / 6.0;\n  var F3 = 1.0 / 3.0;\n  var G3 = 1.0 / 6.0;\n  var F4 = (Math.sqrt(5.0) - 1.0) / 4.0;\n  var G4 = (5.0 - Math.sqrt(5.0)) / 20.0;\n\n  function SimplexNoise(randomOrSeed) {\n    var random;\n    if (typeof randomOrSeed == 'function') {\n      random = randomOrSeed;\n    }\n    else if (randomOrSeed) {\n      random = alea(randomOrSeed);\n    } else {\n      random = Math.random;\n    }\n    this.p = buildPermutationTable(random);\n    this.perm = new Uint8Array(512);\n    this.permMod12 = new Uint8Array(512);\n    for (var i = 0; i < 512; i++) {\n      this.perm[i] = this.p[i & 255];\n      this.permMod12[i] = this.perm[i] % 12;\n    }\n\n  }\n  SimplexNoise.prototype = {\n    grad3: new Float32Array([1, 1, 0,\n      -1, 1, 0,\n      1, -1, 0,\n\n      -1, -1, 0,\n      1, 0, 1,\n      -1, 0, 1,\n\n      1, 0, -1,\n      -1, 0, -1,\n      0, 1, 1,\n\n      0, -1, 1,\n      0, 1, -1,\n      0, -1, -1]),\n    grad4: new Float32Array([0, 1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1,\n      0, -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1,\n      1, 0, 1, 1, 1, 0, 1, -1, 1, 0, -1, 1, 1, 0, -1, -1,\n      -1, 0, 1, 1, -1, 0, 1, -1, -1, 0, -1, 1, -1, 0, -1, -1,\n      1, 1, 0, 1, 1, 1, 0, -1, 1, -1, 0, 1, 1, -1, 0, -1,\n      -1, 1, 0, 1, -1, 1, 0, -1, -1, -1, 0, 1, -1, -1, 0, -1,\n      1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1, 0,\n      -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1, 0]),\n    noise2D: function(xin, yin) {\n      var permMod12 = this.permMod12;\n      var perm = this.perm;\n      var grad3 = this.grad3;\n      var n0 = 0; // Noise contributions from the three corners\n      var n1 = 0;\n      var n2 = 0;\n      // Skew the input space to determine which simplex cell we're in\n      var s = (xin + yin) * F2; // Hairy factor for 2D\n      var i = Math.floor(xin + s);\n      var j = Math.floor(yin + s);\n      var t = (i + j) * G2;\n      var X0 = i - t; // Unskew the cell origin back to (x,y) space\n      var Y0 = j - t;\n      var x0 = xin - X0; // The x,y distances from the cell origin\n      var y0 = yin - Y0;\n      // For the 2D case, the simplex shape is an equilateral triangle.\n      // Determine which simplex we are in.\n      var i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n      if (x0 > y0) {\n        i1 = 1;\n        j1 = 0;\n      } // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n      else {\n        i1 = 0;\n        j1 = 1;\n      } // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n      // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n      // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n      // c = (3-sqrt(3))/6\n      var x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n      var y1 = y0 - j1 + G2;\n      var x2 = x0 - 1.0 + 2.0 * G2; // Offsets for last corner in (x,y) unskewed coords\n      var y2 = y0 - 1.0 + 2.0 * G2;\n      // Work out the hashed gradient indices of the three simplex corners\n      var ii = i & 255;\n      var jj = j & 255;\n      // Calculate the contribution from the three corners\n      var t0 = 0.5 - x0 * x0 - y0 * y0;\n      if (t0 >= 0) {\n        var gi0 = permMod12[ii + perm[jj]] * 3;\n        t0 *= t0;\n        n0 = t0 * t0 * (grad3[gi0] * x0 + grad3[gi0 + 1] * y0); // (x,y) of grad3 used for 2D gradient\n      }\n      var t1 = 0.5 - x1 * x1 - y1 * y1;\n      if (t1 >= 0) {\n        var gi1 = permMod12[ii + i1 + perm[jj + j1]] * 3;\n        t1 *= t1;\n        n1 = t1 * t1 * (grad3[gi1] * x1 + grad3[gi1 + 1] * y1);\n      }\n      var t2 = 0.5 - x2 * x2 - y2 * y2;\n      if (t2 >= 0) {\n        var gi2 = permMod12[ii + 1 + perm[jj + 1]] * 3;\n        t2 *= t2;\n        n2 = t2 * t2 * (grad3[gi2] * x2 + grad3[gi2 + 1] * y2);\n      }\n      // Add contributions from each corner to get the final noise value.\n      // The result is scaled to return values in the interval [-1,1].\n      return 70.0 * (n0 + n1 + n2);\n    },\n    // 3D simplex noise\n    noise3D: function(xin, yin, zin) {\n      var permMod12 = this.permMod12;\n      var perm = this.perm;\n      var grad3 = this.grad3;\n      var n0, n1, n2, n3; // Noise contributions from the four corners\n      // Skew the input space to determine which simplex cell we're in\n      var s = (xin + yin + zin) * F3; // Very nice and simple skew factor for 3D\n      var i = Math.floor(xin + s);\n      var j = Math.floor(yin + s);\n      var k = Math.floor(zin + s);\n      var t = (i + j + k) * G3;\n      var X0 = i - t; // Unskew the cell origin back to (x,y,z) space\n      var Y0 = j - t;\n      var Z0 = k - t;\n      var x0 = xin - X0; // The x,y,z distances from the cell origin\n      var y0 = yin - Y0;\n      var z0 = zin - Z0;\n      // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n      // Determine which simplex we are in.\n      var i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\n      var i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\n      if (x0 >= y0) {\n        if (y0 >= z0) {\n          i1 = 1;\n          j1 = 0;\n          k1 = 0;\n          i2 = 1;\n          j2 = 1;\n          k2 = 0;\n        } // X Y Z order\n        else if (x0 >= z0) {\n          i1 = 1;\n          j1 = 0;\n          k1 = 0;\n          i2 = 1;\n          j2 = 0;\n          k2 = 1;\n        } // X Z Y order\n        else {\n          i1 = 0;\n          j1 = 0;\n          k1 = 1;\n          i2 = 1;\n          j2 = 0;\n          k2 = 1;\n        } // Z X Y order\n      }\n      else { // x0<y0\n        if (y0 < z0) {\n          i1 = 0;\n          j1 = 0;\n          k1 = 1;\n          i2 = 0;\n          j2 = 1;\n          k2 = 1;\n        } // Z Y X order\n        else if (x0 < z0) {\n          i1 = 0;\n          j1 = 1;\n          k1 = 0;\n          i2 = 0;\n          j2 = 1;\n          k2 = 1;\n        } // Y Z X order\n        else {\n          i1 = 0;\n          j1 = 1;\n          k1 = 0;\n          i2 = 1;\n          j2 = 1;\n          k2 = 0;\n        } // Y X Z order\n      }\n      // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n      // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n      // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n      // c = 1/6.\n      var x1 = x0 - i1 + G3; // Offsets for second corner in (x,y,z) coords\n      var y1 = y0 - j1 + G3;\n      var z1 = z0 - k1 + G3;\n      var x2 = x0 - i2 + 2.0 * G3; // Offsets for third corner in (x,y,z) coords\n      var y2 = y0 - j2 + 2.0 * G3;\n      var z2 = z0 - k2 + 2.0 * G3;\n      var x3 = x0 - 1.0 + 3.0 * G3; // Offsets for last corner in (x,y,z) coords\n      var y3 = y0 - 1.0 + 3.0 * G3;\n      var z3 = z0 - 1.0 + 3.0 * G3;\n      // Work out the hashed gradient indices of the four simplex corners\n      var ii = i & 255;\n      var jj = j & 255;\n      var kk = k & 255;\n      // Calculate the contribution from the four corners\n      var t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\n      if (t0 < 0) n0 = 0.0;\n      else {\n        var gi0 = permMod12[ii + perm[jj + perm[kk]]] * 3;\n        t0 *= t0;\n        n0 = t0 * t0 * (grad3[gi0] * x0 + grad3[gi0 + 1] * y0 + grad3[gi0 + 2] * z0);\n      }\n      var t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\n      if (t1 < 0) n1 = 0.0;\n      else {\n        var gi1 = permMod12[ii + i1 + perm[jj + j1 + perm[kk + k1]]] * 3;\n        t1 *= t1;\n        n1 = t1 * t1 * (grad3[gi1] * x1 + grad3[gi1 + 1] * y1 + grad3[gi1 + 2] * z1);\n      }\n      var t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\n      if (t2 < 0) n2 = 0.0;\n      else {\n        var gi2 = permMod12[ii + i2 + perm[jj + j2 + perm[kk + k2]]] * 3;\n        t2 *= t2;\n        n2 = t2 * t2 * (grad3[gi2] * x2 + grad3[gi2 + 1] * y2 + grad3[gi2 + 2] * z2);\n      }\n      var t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\n      if (t3 < 0) n3 = 0.0;\n      else {\n        var gi3 = permMod12[ii + 1 + perm[jj + 1 + perm[kk + 1]]] * 3;\n        t3 *= t3;\n        n3 = t3 * t3 * (grad3[gi3] * x3 + grad3[gi3 + 1] * y3 + grad3[gi3 + 2] * z3);\n      }\n      // Add contributions from each corner to get the final noise value.\n      // The result is scaled to stay just inside [-1,1]\n      return 32.0 * (n0 + n1 + n2 + n3);\n    },\n    // 4D simplex noise, better simplex rank ordering method 2012-03-09\n    noise4D: function(x, y, z, w) {\n      var perm = this.perm;\n      var grad4 = this.grad4;\n\n      var n0, n1, n2, n3, n4; // Noise contributions from the five corners\n      // Skew the (x,y,z,w) space to determine which cell of 24 simplices we're in\n      var s = (x + y + z + w) * F4; // Factor for 4D skewing\n      var i = Math.floor(x + s);\n      var j = Math.floor(y + s);\n      var k = Math.floor(z + s);\n      var l = Math.floor(w + s);\n      var t = (i + j + k + l) * G4; // Factor for 4D unskewing\n      var X0 = i - t; // Unskew the cell origin back to (x,y,z,w) space\n      var Y0 = j - t;\n      var Z0 = k - t;\n      var W0 = l - t;\n      var x0 = x - X0; // The x,y,z,w distances from the cell origin\n      var y0 = y - Y0;\n      var z0 = z - Z0;\n      var w0 = w - W0;\n      // For the 4D case, the simplex is a 4D shape I won't even try to describe.\n      // To find out which of the 24 possible simplices we're in, we need to\n      // determine the magnitude ordering of x0, y0, z0 and w0.\n      // Six pair-wise comparisons are performed between each possible pair\n      // of the four coordinates, and the results are used to rank the numbers.\n      var rankx = 0;\n      var ranky = 0;\n      var rankz = 0;\n      var rankw = 0;\n      if (x0 > y0) rankx++;\n      else ranky++;\n      if (x0 > z0) rankx++;\n      else rankz++;\n      if (x0 > w0) rankx++;\n      else rankw++;\n      if (y0 > z0) ranky++;\n      else rankz++;\n      if (y0 > w0) ranky++;\n      else rankw++;\n      if (z0 > w0) rankz++;\n      else rankw++;\n      var i1, j1, k1, l1; // The integer offsets for the second simplex corner\n      var i2, j2, k2, l2; // The integer offsets for the third simplex corner\n      var i3, j3, k3, l3; // The integer offsets for the fourth simplex corner\n      // simplex[c] is a 4-vector with the numbers 0, 1, 2 and 3 in some order.\n      // Many values of c will never occur, since e.g. x>y>z>w makes x<z, y<w and x<w\n      // impossible. Only the 24 indices which have non-zero entries make any sense.\n      // We use a thresholding to set the coordinates in turn from the largest magnitude.\n      // Rank 3 denotes the largest coordinate.\n      i1 = rankx >= 3 ? 1 : 0;\n      j1 = ranky >= 3 ? 1 : 0;\n      k1 = rankz >= 3 ? 1 : 0;\n      l1 = rankw >= 3 ? 1 : 0;\n      // Rank 2 denotes the second largest coordinate.\n      i2 = rankx >= 2 ? 1 : 0;\n      j2 = ranky >= 2 ? 1 : 0;\n      k2 = rankz >= 2 ? 1 : 0;\n      l2 = rankw >= 2 ? 1 : 0;\n      // Rank 1 denotes the second smallest coordinate.\n      i3 = rankx >= 1 ? 1 : 0;\n      j3 = ranky >= 1 ? 1 : 0;\n      k3 = rankz >= 1 ? 1 : 0;\n      l3 = rankw >= 1 ? 1 : 0;\n      // The fifth corner has all coordinate offsets = 1, so no need to compute that.\n      var x1 = x0 - i1 + G4; // Offsets for second corner in (x,y,z,w) coords\n      var y1 = y0 - j1 + G4;\n      var z1 = z0 - k1 + G4;\n      var w1 = w0 - l1 + G4;\n      var x2 = x0 - i2 + 2.0 * G4; // Offsets for third corner in (x,y,z,w) coords\n      var y2 = y0 - j2 + 2.0 * G4;\n      var z2 = z0 - k2 + 2.0 * G4;\n      var w2 = w0 - l2 + 2.0 * G4;\n      var x3 = x0 - i3 + 3.0 * G4; // Offsets for fourth corner in (x,y,z,w) coords\n      var y3 = y0 - j3 + 3.0 * G4;\n      var z3 = z0 - k3 + 3.0 * G4;\n      var w3 = w0 - l3 + 3.0 * G4;\n      var x4 = x0 - 1.0 + 4.0 * G4; // Offsets for last corner in (x,y,z,w) coords\n      var y4 = y0 - 1.0 + 4.0 * G4;\n      var z4 = z0 - 1.0 + 4.0 * G4;\n      var w4 = w0 - 1.0 + 4.0 * G4;\n      // Work out the hashed gradient indices of the five simplex corners\n      var ii = i & 255;\n      var jj = j & 255;\n      var kk = k & 255;\n      var ll = l & 255;\n      // Calculate the contribution from the five corners\n      var t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0 - w0 * w0;\n      if (t0 < 0) n0 = 0.0;\n      else {\n        var gi0 = (perm[ii + perm[jj + perm[kk + perm[ll]]]] % 32) * 4;\n        t0 *= t0;\n        n0 = t0 * t0 * (grad4[gi0] * x0 + grad4[gi0 + 1] * y0 + grad4[gi0 + 2] * z0 + grad4[gi0 + 3] * w0);\n      }\n      var t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1 - w1 * w1;\n      if (t1 < 0) n1 = 0.0;\n      else {\n        var gi1 = (perm[ii + i1 + perm[jj + j1 + perm[kk + k1 + perm[ll + l1]]]] % 32) * 4;\n        t1 *= t1;\n        n1 = t1 * t1 * (grad4[gi1] * x1 + grad4[gi1 + 1] * y1 + grad4[gi1 + 2] * z1 + grad4[gi1 + 3] * w1);\n      }\n      var t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2 - w2 * w2;\n      if (t2 < 0) n2 = 0.0;\n      else {\n        var gi2 = (perm[ii + i2 + perm[jj + j2 + perm[kk + k2 + perm[ll + l2]]]] % 32) * 4;\n        t2 *= t2;\n        n2 = t2 * t2 * (grad4[gi2] * x2 + grad4[gi2 + 1] * y2 + grad4[gi2 + 2] * z2 + grad4[gi2 + 3] * w2);\n      }\n      var t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3 - w3 * w3;\n      if (t3 < 0) n3 = 0.0;\n      else {\n        var gi3 = (perm[ii + i3 + perm[jj + j3 + perm[kk + k3 + perm[ll + l3]]]] % 32) * 4;\n        t3 *= t3;\n        n3 = t3 * t3 * (grad4[gi3] * x3 + grad4[gi3 + 1] * y3 + grad4[gi3 + 2] * z3 + grad4[gi3 + 3] * w3);\n      }\n      var t4 = 0.6 - x4 * x4 - y4 * y4 - z4 * z4 - w4 * w4;\n      if (t4 < 0) n4 = 0.0;\n      else {\n        var gi4 = (perm[ii + 1 + perm[jj + 1 + perm[kk + 1 + perm[ll + 1]]]] % 32) * 4;\n        t4 *= t4;\n        n4 = t4 * t4 * (grad4[gi4] * x4 + grad4[gi4 + 1] * y4 + grad4[gi4 + 2] * z4 + grad4[gi4 + 3] * w4);\n      }\n      // Sum up and scale the result to cover the range [-1,1]\n      return 27.0 * (n0 + n1 + n2 + n3 + n4);\n    }\n  };\n\n  function buildPermutationTable(random) {\n    var i;\n    var p = new Uint8Array(256);\n    for (i = 0; i < 256; i++) {\n      p[i] = i;\n    }\n    for (i = 0; i < 255; i++) {\n      var r = i + ~~(random() * (256 - i));\n      var aux = p[i];\n      p[i] = p[r];\n      p[r] = aux;\n    }\n    return p;\n  }\n  SimplexNoise._buildPermutationTable = buildPermutationTable;\n\n  function alea() {\n    // Johannes Baagøe <baagoe@baagoe.com>, 2010\n    var s0 = 0;\n    var s1 = 0;\n    var s2 = 0;\n    var c = 1;\n\n    var mash = masher();\n    s0 = mash(' ');\n    s1 = mash(' ');\n    s2 = mash(' ');\n\n    for (var i = 0; i < arguments.length; i++) {\n      s0 -= mash(arguments[i]);\n      if (s0 < 0) {\n        s0 += 1;\n      }\n      s1 -= mash(arguments[i]);\n      if (s1 < 0) {\n        s1 += 1;\n      }\n      s2 -= mash(arguments[i]);\n      if (s2 < 0) {\n        s2 += 1;\n      }\n    }\n    mash = null;\n    return function() {\n      var t = 2091639 * s0 + c * 2.3283064365386963e-10; // 2^-32\n      s0 = s1;\n      s1 = s2;\n      return s2 = t - (c = t | 0);\n    };\n  }\n  function masher() {\n    var n = 0xefc8249d;\n    return function(data) {\n      data = data.toString();\n      for (var i = 0; i < data.length; i++) {\n        n += data.charCodeAt(i);\n        var h = 0.02519603282416938 * n;\n        n = h >>> 0;\n        h -= n;\n        h *= n;\n        n = h >>> 0;\n        h -= n;\n        n += h * 0x100000000; // 2^32\n      }\n      return (n >>> 0) * 2.3283064365386963e-10; // 2^-32\n    };\n  }\n\n  // amd\n  if (typeof define !== 'undefined' && define.amd) define(function() {return SimplexNoise;});\n  // common js\n  if (typeof exports !== 'undefined') exports.SimplexNoise = SimplexNoise;\n  // browser\n  else if (typeof window !== 'undefined') window.SimplexNoise = SimplexNoise;\n  // nodejs\n  if (typeof module !== 'undefined') {\n    module.exports = SimplexNoise;\n  }\n\n})();\n","const SCALE = 0.5;\r\nconst biomes = [\r\n    createBiome(\"shallow\", 4, 0, 0.5, 2, 0, 0, 2, 1, \"rock-shallow\", 1, \"water-base\", 0.5, 1),\r\n    createBiome(\"kelp\", 8, 40, 0.25, 0, 2, 2, 3, 2, \"rock-kelp\", 4, \"water-kelp\", 0.5, 0.5),\r\n    createBiome(\"redgrass\", 8, 90, 0.75, 0, 2, 1, 1, 0.5, \"rock-medium\", 2, \"water-redgrass\", 0.75, 2),\r\n    createBiome(\"koosh\", 6, 150, 0.5, 1, 4, 2, 3, 1, \"rock-deep\", 3, \"water-koosh\", 2, 1),\r\n    createBiome(\"jellyshroom\", 8, 200, 0, 0, 2, 1, 4, 1, \"rock-scale\", 1, \"water-jelly\", 1.5, 2),\r\n    createBiome(\"grandreef\", 10, 300, 0.5, 3, 4, 2, 6, 2, \"rock-deep\", 3, \"water-greef\", 1, 1.5),\r\n    createBiome(\"bloodkelp\", 8, 450, 0.75, 1, 4, 2, 1, 1, \"rock-scale\", 1, \"water-bkelp\", 1.5, 1.25),\r\n    createBiome(\"lostriver\", 12, 700, 0, 0, 3, 1, 2, 1, \"rock-lr\", 2, \"water-lr\", 1, 1),\r\n    //mix into lr, using the dead space, createBiome(\"cove\", 10, 900, 0, 0, 1, 1, 3, 1, \"rock-lr\", 2, \"water-cove\", 2, 0.5), //has custom code\r\n    createBiome(\"lava\", 15, 1000, 0, 0, 1, 1, 0, 0, \"lava\", 6, \"water-ilz\", 2, 0.25),\r\n    createBiome(\"void\", 1, 1400, 0, 0, 0, 0, 0, 0, \"void\", 3, \"none\", 0, 0),\r\n];\r\nfunction createBiome(name, rows, d, ff, minF, varCAmt, varCRate, varFAmt, varFRate, tex, vars, water, ores, plants) {\r\n    const h = { rowsRequired: rows, floorFraction: ff, minFloorRows: minF };\r\n    const vc = { rate: varCRate, range: varCAmt };\r\n    const vf = { rate: varFRate, range: varFAmt };\r\n    return { name: name, height: h, variationCeil: vc, variationFloor: vf, depth: d, baseTerrainTexture: tex, terrainVariants: vars, waterColor: water, oreSpawnRate: ores, plantSpawnRate: plants };\r\n}\r\nimport { getRandomBetween, getRandomDecimalBetween, getArrayIndex, fitBCG, isDarkModeEnabled, setRandomRotations, setRotations, mirrorXs } from '../library';\r\nimport { isPhone } from '../browser';\r\nimport * as SimplexNoise from 'simplex-noise';\r\nconst simplex = new SimplexNoise();\r\nfunction allocateBiomes(rows, cols) {\r\n    const available = [];\r\n    let rowRem = rows;\r\n    let totalMin = 0;\r\n    let idx = 0;\r\n    for (const biome of biomes) {\r\n        if (biome.height.rowsRequired <= rowRem) {\r\n            available.push({ biome: biome, index: idx, height: new Array(cols), highest: 9999, lowest: -1 });\r\n            rowRem -= biome.height.rowsRequired;\r\n            totalMin += biome.height.rowsRequired;\r\n            idx++;\r\n        }\r\n        if (rowRem <= 0)\r\n            break;\r\n    }\r\n    //console.log(\"Available biome set is:\");\r\n    //console.log(available);\r\n    //const maxD = available[available.length-1].biome.depth;\r\n    const fac = rows / totalMin;\r\n    for (const slot of available) {\r\n        const amt = Math.floor(fac * slot.biome.height.rowsRequired);\r\n        const ceilPoint = slot.index == 0 ? 0 : available[slot.index - 1].lowest + 1;\r\n        const baseF = ceilPoint + amt;\r\n        const floorVarFromOther = slot.index == available.length - 1 ? { rate: 0, range: 0 } : available[slot.index + 1].biome.variationCeil;\r\n        const maxs = Math.min(3, slot.biome.variationFloor.rate, floorVarFromOther.rate);\r\n        const maxr = Math.min(20, amt * 0.5 * (1 - slot.biome.height.floorFraction), slot.biome.variationFloor.range, floorVarFromOther.range);\r\n        const floor = getSurface(cols, maxs, baseF - maxr, baseF + maxr);\r\n        for (let x = 0; x < cols; x++) {\r\n            const col = { biome: slot, topRow: 0, bottomRow: 0, rowsAllocated: 0, airCeiling: 0, airFloor: 0, solidFloor: 0, x: 0 };\r\n            slot.height[x] = col;\r\n            //const amt = Math.floor(fac*slot.biome.rowsRequired)+offsets[x];\r\n            col.topRow = slot.index == 0 ? 0 : available[slot.index - 1].height[x].bottomRow + 1;\r\n            col.airCeiling = col.topRow;\r\n            col.airFloor = col.bottomRow;\r\n            col.solidFloor = col.bottomRow;\r\n            col.bottomRow = floor[x]; //slot.topRow[x]+slot.rowsAllocated[x]-1;\r\n            col.rowsAllocated = col.bottomRow - col.topRow + 1; //slot.topRow[x]+slot.rowsAllocated[x]-1;\r\n            slot.highest = Math.min(slot.highest, col.topRow);\r\n            slot.lowest = Math.max(slot.lowest, col.bottomRow);\r\n        }\r\n    }\r\n    while (available[available.length - 1].highest >= rows) {\r\n        available.pop();\r\n    }\r\n    available[available.length - 1].lowest = rows - 1;\r\n    for (let x = 0; x < cols; x++) {\r\n        available[available.length - 1].height[x].bottomRow = rows - 1;\r\n    }\r\n    console.log(\"Calculated biome stack is:\");\r\n    console.log(available);\r\n    return available;\r\n}\r\nfunction getBiomeAtRow(row, biomes, x) {\r\n    if (biomes.length == 1 || row < biomes[1].height[x].topRow)\r\n        return biomes[0];\r\n    if (row >= biomes[biomes.length - 1].height[x].topRow)\r\n        return biomes[biomes.length - 1];\r\n    for (const biome of biomes) {\r\n        if (row >= biome.height[x].topRow && row <= biome.height[x].bottomRow)\r\n            return biome;\r\n    }\r\n    console.log(\"No biome available at row=\" + row + \" of \" + biomes + \" @ \" + x);\r\n    return null;\r\n}\r\nfunction addLooseImage(elem, img, w, h) {\r\n    let tile = document.createElement('div'); /*\r\n    if (img == \"air\" || img == \"empty\" || img == null) {\r\n        tile.style.width = w.toString()+\"px\";\r\n        tile.style.height = h.toString()+\"px\";\r\n    }*/\r\n    tile.className = \"tile-subnautica-\" + img;\r\n    elem.appendChild(tile);\r\n    return tile;\r\n}\r\nfunction addPositionedImage(elem, img, x, y, w, h) {\r\n    img = modifyImageLocational(img);\r\n    if (!img || img == \"air\" || img == \"empty\")\r\n        return null;\r\n    let added = addLooseImage(elem, img, w, h);\r\n    added.style.position = \"relative\";\r\n    added.style.left = x.toString() + \"px\";\r\n    added.style.top = y.toString() + \"px\";\r\n    //if (img.startsWith(\"geothermal\"))\r\n    //\tscale *= 2;\r\n    added.style.transformOrigin = \"top left\";\r\n    //added.style.transform = \"scale(\"+scale+\")\";\r\n    //if (img == \"spawner\")\r\n    //\tadded.style.transform = added.style.transform+\" translate(-16px)\";\r\n    return added;\r\n}\r\nfunction addImageToRow(elem, img, z) {\r\n    let tile = document.createElement('div');\r\n    tile.className = \"tile-subnautica-\" + img; /*\r\n    const seek = \"translate(\";\r\n    if (elem.style.transform.includes(seek)) {\r\n        const idx = elem.style.transform.indexOf(seek);\r\n        const args = elem.style.transform.substring(idx+seek.length, elem.style.transform.indexOf(\")\", idx));\r\n        console.log(args);\r\n        img.offsetX -= x;\r\n        img.offsetY -= y;\r\n    }*/ /*\r\n    if (isDarkModeEnabled() && (img.includes(\"water\") || img.includes(\"cave\"))) {\r\n        *tile.style.filter = \"saturate(\"+0.75+\") brightness(\"+0.125+\")\";\r\n    }*/\r\n    tile.style.zIndex = z.toString();\r\n    elem.appendChild(tile);\r\n    return tile;\r\n}\r\n/*\r\nfunction addObjectToRow(elem:HTMLElement, img:placedObject, z:number, lastX:number, lastY:number) {\r\n    let add = addImageToRow(elem, img.texture, img.offsetX, img.offsetY, z, lastX, lastY);\r\n    //overlay\r\n    add = addImageToRow(elem, img.texture, img.offsetX, img.offsetY, z, lastX, lastY);\r\n}\r\n*/\r\nfunction buildImage(grid, waterOverlay, rows, cols, tiles) {\r\n    var w = 128 * SCALE;\r\n    var h = 128 * SCALE;\r\n    var x = 0;\r\n    var y = 0;\r\n    for (var k = 0; k < rows; k++) {\r\n        x = 0;\r\n        let tilerow = document.createElement(\"div\");\r\n        let waterrow = document.createElement(\"div\");\r\n        for (var i = 0; i < cols; i++) {\r\n            let idx = getArrayIndex(cols, i, k);\r\n            const tile = tiles[idx];\r\n            let addTile = tilerow;\r\n            let addWater = waterrow;\r\n            let tileTex = modifyImageLocational(tile.baseTexture);\r\n            if (!tileTex)\r\n                tileTex = \"empty\";\r\n            addTile = addImageToRow(addTile, tileTex, 0);\r\n            if (isDarkModeEnabled()) {\r\n                //add = addImageToRow(add, \"dark\");\r\n                if ((!tile.backgroundWater || tile.backgroundWater == \"empty\") && (!tile.tileOverlay || tile.tileOverlay == \"empty\"))\r\n                    tile.tileOverlay = \"cave\"; //tile.biome.biome.waterColor;\r\n            }\r\n            if (tile.backgroundWater) {\r\n                tile.backgroundWater = modifyImageLocational(tile.backgroundWater);\r\n                if (tile.backgroundWater)\r\n                    addTile = addImageToRow(addTile, tile.backgroundWater, 1);\r\n            }\r\n            let flag = false;\r\n            if (tile.tileOverlay) {\r\n                tile.tileOverlay = modifyImageLocational(tile.tileOverlay);\r\n                if (tile.tileOverlay) {\r\n                    addWater = addImageToRow(addWater, tile.tileOverlay, 4);\r\n                    flag = true;\r\n                }\r\n            }\r\n            if (!flag)\r\n                addWater = addImageToRow(addWater, \"empty\", 4);\r\n            x += w;\r\n        }\r\n        grid.appendChild(tilerow);\r\n        waterOverlay.appendChild(waterrow);\r\n        y += h;\r\n    }\r\n    fitBCG(grid, SCALE);\r\n    fitBCG(waterOverlay, SCALE);\r\n}\r\nfunction getRandomBiomeTerrain(x, y, biome) {\r\n    const f = (y - biome.height[x].topRow) / biome.height[x].rowsAllocated;\r\n    const bottom = y >= biome.height[x].bottomRow + 1 - (1 / SCALE);\r\n    if (biome.biome.name == \"bloodkelp\" && bottom)\r\n        return \"bkelp-floor\";\r\n    let tex = biome.biome.baseTerrainTexture;\r\n    const noise = ((1 + simplex.noise2D(x * 0.1, y * 0.1)) / 2);\r\n    let variant = 1 + Math.floor(noise * biome.biome.terrainVariants);\r\n    if (biome.biome.name == \"lostriver\") {\r\n        if (f < 0.2) {\r\n            tex = \"lr\";\r\n            variant = 4;\r\n        }\r\n        else if (f < 0.3) {\r\n            tex = \"lr\";\r\n            variant = 3;\r\n        }\r\n    }\r\n    else if (biome.biome.name == \"cove\") {\r\n        tex = \"lr\"; /*\r\n        if (bottom) {\r\n            variant = 1+Math.floor(noise*2);\r\n        }\r\n        else */\r\n        if (f < 0.25) {\r\n            variant = 8;\r\n        }\r\n        else if (f < 0.9975) {\r\n            variant = 7;\r\n        }\r\n        else {\r\n            variant = 6;\r\n        }\r\n    }\r\n    return tex + variant;\r\n}\r\nfunction modifyImageLocational(img) {\r\n    if (isDarkModeEnabled()) {\r\n        if (img && (img.includes(\"water-\") || img.includes(\"cave-\") || img.includes(\"brine-\"))) {\r\n            img = \"dark-\" + img;\r\n        }\r\n        else if (img && img.endsWith(\"-glow_toggle\")) {\r\n            img = null;\r\n        }\r\n    }\r\n    return img;\r\n}\r\n/*\r\nfunction addBlock(tiles:gridSlot[], idx:number, img:texture) {\r\n    const tile = tiles[idx];\r\n    if (!tile) {\r\n        console.log(\"Null tile index @ \"+idx+\" / \"+tiles.length+\"!\");\r\n        console.trace();\r\n        return;\r\n    }\r\n    if (!tile.objects) {\r\n        tile.objects = [];\r\n    }\r\n    if (img.mainTexture == \"*remove\")\r\n        tile.objects.pop();\r\n    else\r\n        tile.objects.push({texture:img, offsetX:x ? x : 0, offsetY:y ? y : 0});\r\n}\r\n*/\r\nfunction genBlob(rows, cols, tiles, x, y, type, s, exclude, store) {\r\n    const rx = getRandomDecimalBetween(s[0], s[1]);\r\n    const ry = getRandomDecimalBetween(s[0], s[1]);\r\n    const mx = Math.max(0, Math.floor(x - rx));\r\n    const my = Math.max(0, Math.floor(y - ry));\r\n    const px = Math.min(cols - 1, Math.floor(x + rx));\r\n    const py = Math.min(rows - 1, Math.floor(y + ry));\r\n    const ms = 0.95;\r\n    const slopeX = getRandomDecimalBetween(-ms, ms);\r\n    const slopeY = getRandomDecimalBetween(-ms, ms);\r\n    for (let i = mx; i <= px; i++) {\r\n        for (let k = my; k <= py; k++) {\r\n            const di = i - x;\r\n            const dk = k - y;\r\n            if (di * di + dk * dk <= rx * ry + 0.5) {\r\n                const dx = i + Math.floor(slopeX * dk);\r\n                const dy = k + Math.floor(slopeY * di);\r\n                if (dx < 0 || dy < 0 || dx >= cols || dy >= rows)\r\n                    continue;\r\n                const idx = getArrayIndex(cols, dx, dy);\r\n                if (idx >= 0 && idx < tiles.length && !(exclude && exclude(idx)) && !store.includes(idx)) {\r\n                    tiles[idx].backgroundWater = type;\r\n                    store.push(idx);\r\n                    if (type.includes(\"water\") || type.includes(\"cave\"))\r\n                        tiles[idx].isAir = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction getSurface(cols, maxslope, top, bottom) {\r\n    const ret = new Array(cols);\r\n    let lastY = -1;\r\n    for (let x = 0; x < cols; x++) {\r\n        let y = getRandomBetween(top, bottom);\r\n        const diff = y - lastY;\r\n        if (lastY >= 0 && Math.abs(diff) > maxslope)\r\n            y = lastY + Math.sign(diff);\r\n        lastY = y;\r\n        ret[x] = y;\r\n    }\r\n    return ret;\r\n}\r\nfunction generateBiomeFloor(cols, tiles, biome, maxslope, minfrac, minFloorRows) {\r\n    const middle = getSurface(cols, biome.biome.variationFloor.rate, biome.highest + (biome.lowest - biome.highest) * minfrac, biome.lowest - 1 - minFloorRows);\r\n    for (let x = 0; x < cols; x++) {\r\n        const col = biome.height[x];\r\n        //console.log(biome.biome.name+\"floor @ \"+x+\": \"+biome.topRow+\" > \"+bottom[x]+\" [\"+biome.topRow+\"-\"+col.bottomRow+\"]\");\r\n        col.airFloor = Math.min(middle[x], col.bottomRow - 1);\r\n        col.solidFloor = col.airFloor;\r\n        if (biome.index <= 6 && biome.index != 4) { //shallows to bkelp, skip jellyshroom\r\n            for (let y = col.topRow; y <= col.bottomRow; y++) {\r\n                const idx = getArrayIndex(cols, x, y);\r\n                tiles[idx].tileOverlay = biome.biome.waterColor;\r\n                if (y <= col.airFloor) {\r\n                    tiles[idx].backgroundWater = biome.biome.waterColor;\r\n                    tiles[idx].isAir = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction addObject(objects, illum, obj, x, y, dx, dy) {\r\n    return addObjectOfSizeAt(objects, illum, obj, x, y, 128, 128, dx, dy);\r\n}\r\nfunction addObjectOfSizeAt(objects, illum, obj, x, y, w, h, dx, dy) {\r\n    x *= 128; //convert from tile to px\r\n    y *= 128;\r\n    if (dx)\r\n        x += dx;\r\n    if (dy)\r\n        y += dy;\r\n    let ret = [];\r\n    if (obj.mainTexture)\r\n        ret.push(addPositionedImage(objects, obj.mainTexture, x, y, w, h));\r\n    if (obj.illumTexture)\r\n        ret.push(addPositionedImage(illum, obj.illumTexture, x, y, w, h));\r\n    return ret;\r\n}\r\nfunction generateTallPlant(cols, objects, illum, x, rootY, topY, baseTex, topTex, rootTex) {\r\n    const dx = getRandomBetween(-32, 32);\r\n    for (let y = topY; y <= rootY; y++) {\r\n        const top = y == topY;\r\n        const bottom = y == rootY;\r\n        //const idx = getArrayIndex(cols, x, y);\r\n        const arr = top ? topTex : (bottom && rootTex ? rootTex : baseTex);\r\n        const obj = arr[getRandomBetween(0, arr.length - 1)];\r\n        //addBlock(tiles, idx, obj);\r\n        addObject(objects, illum, obj, x, y, dx);\r\n    }\r\n    //console.log(\"Plant @ \"+x+\", \"+rootY+\" > \"+baseTex[0]);\r\n}\r\nfunction generateDoubleWidePlant(cols, objects, illum, x, rootY, topY, baseTex, middleTex, topTex) {\r\n    const dx = getRandomBetween(-16, 16);\r\n    for (let y = rootY; y >= topY; y--) {\r\n        const top = y == topY;\r\n        const bottom = y == rootY;\r\n        const spr = top ? topTex : (bottom || !middleTex ? baseTex : middleTex);\r\n        let str = spr.mainTexture ? spr.mainTexture : spr.illumTexture;\r\n        if (str && str.charAt(str.length - 2) == '*') {\r\n            const num = parseInt(str.charAt(str.length - 1));\r\n            str = str.substring(0, str.length - 2);\r\n            const isr = spr.illumTexture ? spr.illumTexture.substring(0, spr.illumTexture.indexOf('*')) + spr.illumTexture.substring(spr.illumTexture.indexOf('*') + 2) : null;\r\n            //console.log(spr.mainTexture+\"/\"+spr.illumTexture+\" > \"+isr);\r\n            for (let i = 0; i < num; i++) {\r\n                let yy = y - i;\r\n                //const idx1 = getArrayIndex(cols, x, yy);\r\n                //const idx2 = getArrayIndex(cols, x+1, yy);\r\n                //addBlock(tiles, idx1, createTextureWithSuffix(spr, str, (i+1).toString()+\"-left\"));\r\n                //addBlock(tiles, idx2, createTextureWithSuffix(spr, str, (i+1).toString()+\"-right\"));\r\n                addObject(objects, illum, createTextureWithSuffix(spr, str, isr, (i + 1).toString() + \"-left\"), x, yy, dx);\r\n                addObject(objects, illum, createTextureWithSuffix(spr, str, isr, (i + 1).toString() + \"-right\"), x + 1, yy, dx);\r\n            }\r\n            y -= num - 1;\r\n        }\r\n        else {\r\n            //const idx1 = getArrayIndex(cols, x, y);\r\n            //const idx2 = getArrayIndex(cols, x+1, y);\r\n            //addBlock(tiles, idx1, createTextureWithSuffix(spr, str, \"-left\"));\r\n            //addBlock(tiles, idx2, createTextureWithSuffix(spr, str, \"-right\"));\r\n            addObject(objects, illum, createTextureWithSuffix(spr, str, null, \"-left\"), x, y, dx);\r\n            addObject(objects, illum, createTextureWithSuffix(spr, str, null, \"-right\"), x + 1, y, dx);\r\n        }\r\n    }\r\n}\r\nfunction generateCreepvine(rows, cols, tiles, biomes, objects, illum) {\r\n    let biome = biomes[1];\r\n    for (let x = 0; x < cols; x++) {\r\n        if (getRandomBetween(0, 3) > 0) {\r\n            const col = biome.height[x];\r\n            const n = getRandomBetween(0, 6);\r\n            let root = -1;\r\n            let top = -1;\r\n            switch (n) {\r\n                case 0:\r\n                case 1:\r\n                case 2:\r\n                    root = col.solidFloor;\r\n                    top = Math.max(col.topRow, root - getRandomBetween(4, 8));\r\n                    generateTallPlant(cols, objects, illum, x, root, top, [{ mainTexture: \"creepvine-1\" }, { mainTexture: \"creepvine-2\" }, { mainTexture: \"creepvine-3\" }, { mainTexture: \"creepvine-4\" }, { mainTexture: \"creepvine-5\" }], [{ mainTexture: \"creepvine-top1\" }], null);\r\n                    break;\r\n                case 3:\r\n                case 4:\r\n                case 5:\r\n                    if (x < cols - 1 && Math.abs(biome.height[x].solidFloor - biome.height[x + 1].solidFloor) <= 1) {\r\n                        root = Math.max(biome.height[x].solidFloor, biome.height[x + 1].solidFloor);\r\n                        top = Math.max(col.topRow, root - 3);\r\n                        generateDoubleWidePlant(cols, objects, illum, x, root, top, { mainTexture: \"large-creepvine-bottom*2\" }, n == 5 ? createDualTexture(\"creepvine-seed\") : { mainTexture: \"large-creepvine-center\" }, { mainTexture: \"large-creepvine-top*3\" });\r\n                        x += 1;\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction generateReefPods(rows, cols, tiles, biomes, objects, illum) {\r\n    let biome = biomes[5];\r\n    for (let x = 0; x < cols - 1; x++) {\r\n        if (getRandomBetween(0, 3) > 0) {\r\n            if (Math.abs(biome.height[x].solidFloor - biome.height[x + 1].solidFloor) <= 1) {\r\n                let root = Math.max(biome.height[x].solidFloor, biome.height[x + 1].solidFloor);\r\n                let top = Math.max(biome.height[x].topRow + 2, biome.height[x + 1].topRow + 2, root - getRandomBetween(2, 5));\r\n                //generateTallPlant(cols, tiles, x, root, top, [\"reef-pod-root\"], [\"reef-pod\"]);\r\n                generateDoubleWidePlant(cols, objects, illum, x, root, top, { mainTexture: \"reef-pod-bottom*2\" }, { mainTexture: \"reef-pod-middle\" }, createDualTexture(\"reef-pod-top*2\"));\r\n                x += 2;\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction generateBloodKelp(rows, cols, tiles, biomes, objects, illum) {\r\n    let biome = biomes[6];\r\n    for (let x = 0; x < cols; x++) {\r\n        if (getRandomBetween(0, 1) > 0) {\r\n            let root = biome.height[x].solidFloor;\r\n            let top = Math.max(biome.height[x].topRow, root - getRandomBetween(3, 12));\r\n            generateTallPlant(cols, objects, illum, x, root, top, [{ mainTexture: \"bkelp-middle1\" }, { mainTexture: \"bkelp-middle2\" }, { mainTexture: \"bkelp-middle3\" }], [{ mainTexture: \"bkelp-top1\" }, { mainTexture: \"bkelp-top2\" }], [createDualTexture(\"bkelp-bottom1\"), createDualTexture(\"bkelp-bottom2\")]);\r\n        }\r\n    }\r\n}\r\nfunction generateKoosh(rows, cols, tiles, biomes, objects, illum) {\r\n    let biome = biomes[3];\r\n    for (let x = 0; x < cols - 1; x++) {\r\n        if (getRandomBetween(0, 4) > 0) {\r\n            if (Math.abs(biome.height[x].solidFloor - biome.height[x + 1].solidFloor) <= 1) {\r\n                let root = Math.max(biome.height[x].solidFloor, biome.height[x + 1].solidFloor);\r\n                generateDoubleWidePlant(cols, objects, illum, x, root, root - 1, createDualTexture(\"koosh-bottom\"), null, createDualTexture(\"koosh-top\"));\r\n                tiles[getArrayIndex(cols, x, root)].groundObjects = 2;\r\n                tiles[getArrayIndex(cols, x + 1, root)].groundObjects = 2;\r\n                tiles[getArrayIndex(cols, x, root - 1)].groundObjects = 2;\r\n                tiles[getArrayIndex(cols, x + 1, root - 1)].groundObjects = 2;\r\n                x += 2;\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction createTextureWithSuffix(tex, basename, baseillum, suffix) {\r\n    const start = basename ? basename : tex.mainTexture;\r\n    let illum = tex.illumTexture ? (baseillum ? baseillum : tex.illumTexture) + suffix : null;\r\n    let ret = { mainTexture: start + suffix, illumTexture: illum };\r\n    return ret;\r\n}\r\nfunction createDualTexture(tex) {\r\n    let ret = { mainTexture: tex, illumTexture: tex + \"-glow\" };\r\n    return ret;\r\n}\r\nfunction createFullGlowTexture(tex) {\r\n    let ret = { mainTexture: null, illumTexture: tex };\r\n    return ret;\r\n}\r\nfunction generateGroundDeco(rows, cols, tiles, biomes, lrdata, objects, illum) {\r\n    for (const biome of biomes) {\r\n        const nPlant = 12 * biome.biome.plantSpawnRate;\r\n        const nOre = 6 * biome.biome.oreSpawnRate;\r\n        for (let i = 0; i < nPlant; i++) {\r\n            const gen = getRandomPlant(biome);\r\n            if (gen) {\r\n                let x = getRandomBetween(0, cols - 1);\r\n                if (lrdata && biome.index == 7 && Math.abs(x - lrdata.shaftLocation) <= 2)\r\n                    continue;\r\n                let y = Math.min(biome.height[x].solidFloor, rows - 1);\r\n                const idx = getArrayIndex(cols, x, y);\r\n                if (tiles[idx].groundObjects >= 1)\r\n                    continue;\r\n                if (gen.mainTexture == \"wigglegrass\" || gen.mainTexture == \"acidmushroom\" || gen.mainTexture == \"whitemushroom\") {\r\n                    const n = getRandomBetween(2, 5);\r\n                    for (let k = 0; k < n; k++)\r\n                        addObject(objects, illum, gen, x, y, getRandomBetween(-60, 60));\r\n                }\r\n                else {\r\n                    const varX = gen.mainTexture != \"membrain\" ? 48 : 24;\r\n                    //addBlock(tiles, idx, gen, getRandomBetween(-varX, varX), getRandomBetween(2, 12));\r\n                    addObject(objects, illum, gen, x, y, getRandomBetween(-varX, varX));\r\n                }\r\n                tiles[idx].groundObjects++;\r\n            }\r\n        }\r\n        for (let i = 0; i < nOre; i++) {\r\n            const gen = getRandomOre(biome);\r\n            if (gen) {\r\n                let x = getRandomBetween(0, cols - 1);\r\n                if (lrdata && biome.index == 7 && Math.abs(x - lrdata.shaftLocation) <= 2)\r\n                    continue;\r\n                let y = Math.min(biome.height[x].solidFloor, rows - 1);\r\n                const idx = getArrayIndex(cols, x, y);\r\n                if (tiles[idx].groundObjects >= 1)\r\n                    continue;\r\n                const varX = gen.illumTexture == \"abysso\" || gen.mainTexture == \"azurite\" ? 48 : 24;\r\n                //addBlock(tiles, idx, gen, getRandomBetween(-varX, varX), getRandomBetween(2, 12));\r\n                addObject(objects, illum, gen, x, y, getRandomBetween(-varX, varX));\r\n                tiles[idx].groundObjects++;\r\n            }\r\n        }\r\n    }\r\n    if (biomes.length <= 7 || !lrdata)\r\n        return;\r\n    for (let x = 0; x < cols; x++) {\r\n        if (lrdata.coveFloor[x] >= 0 && getRandomBetween(0, 3) == 0 && Math.abs(lrdata.treeX - x) > 1) {\r\n            const gen = getRandomOre(biomes[7]);\r\n            if (gen) {\r\n                const y = lrdata.coveFloor[x];\r\n                const idx = getArrayIndex(cols, x, y);\r\n                if (tiles[idx].groundObjects >= 1)\r\n                    continue;\r\n                const varX = gen.illumTexture == \"abysso\" || gen.mainTexture == \"azurite\" ? 48 : 24;\r\n                addObject(objects, illum, gen, x, y, getRandomBetween(-varX, varX));\r\n                tiles[idx].groundObjects++;\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction getRandomOre(biome) {\r\n    let li = [{ mainTexture: \"quartz\" }];\r\n    if (biome.index >= 3 && biome.index <= 7) {\r\n        li.push({ mainTexture: \"lithium\" });\r\n    }\r\n    if (biome.index >= 3 && biome.index != 4 && biome.index <= 6) {\r\n        li.push(createDualTexture(\"azurite\"));\r\n    }\r\n    if (biome.index >= 4 && biome.index <= 7) {\r\n        li.push({ mainTexture: \"magnetite\" });\r\n    }\r\n    if (biome.index >= 5 && biome.index <= 7) {\r\n        li.push(createDualTexture(\"ruby\"));\r\n    }\r\n    if (biome.index >= 6 && biome.index <= 7) {\r\n        li.push(createDualTexture(\"uranium\"));\r\n    }\r\n    if (biome.index == 6) {\r\n        li.push(createFullGlowTexture(\"abysso\"));\r\n    }\r\n    if (biome.index == 7) {\r\n        li.push({ mainTexture: \"sulfur\" });\r\n    }\r\n    if (biome.index >= 7) {\r\n        li.push({ mainTexture: \"nickel\" });\r\n    }\r\n    if (biome.index >= 8) {\r\n        li.push(createFullGlowTexture(\"kyanite\"));\r\n    }\r\n    return li.length == 0 ? null : li[getRandomBetween(0, li.length - 1)];\r\n}\r\nfunction getRandomPlant(biome) {\r\n    let li = [];\r\n    if (biome.index == 0) {\r\n        li.push(createDualTexture(\"wigglegrass\"));\r\n        li.push(createDualTexture(\"acidmushroom\"));\r\n    }\r\n    if (biome.index >= 2 && biome.index <= 3) {\r\n        li.push({ mainTexture: \"redwort\" });\r\n    }\r\n    if (biome.index >= 2 && biome.index <= 5 && biome.index != 4) {\r\n        li.push(createDualTexture(\"alkaliplant\"));\r\n    }\r\n    if ((biome.index >= 4 && biome.index <= 5) || biome.index == 2) {\r\n        li.push(createFullGlowTexture(\"violetbeau\"));\r\n    }\r\n    if (biome.index >= 5 && biome.index <= 7) {\r\n        li.push(createDualTexture(\"gabefeather\"));\r\n    }\r\n    if (biome.index == 5) { //grand reef only\r\n        li.push(createDualTexture(\"membrain\"));\r\n    }\r\n    if (biome.index >= 6) {\r\n        li.push({ mainTexture: \"whitemushroom\" });\r\n    }\r\n    if (biome.index == 7) { //lost river only\r\n        li.push(createDualTexture(\"ghostweed\"));\r\n        li.push(createDualTexture(\"crabkelp\"));\r\n    }\r\n    return li.length == 0 ? null : li[getRandomBetween(0, li.length - 1)];\r\n}\r\nfunction getRandomSmallFish(biome) {\r\n    let li = [];\r\n    if (biome.index <= 5 && biome.index != 4) { //grand reef and above except jellyshroom\r\n        li.push(createDualTexture(\"peeper\"));\r\n        li.push({ mainTexture: \"bladderfish\" });\r\n    }\r\n    if (biome.index == 0) {\r\n        li.push(createDualTexture(\"rabbitray\"));\r\n    }\r\n    if (biome.index == 0 || biome.index == 3) {\r\n        li.push(createDualTexture(\"boomerang\"));\r\n    }\r\n    if (biome.index == 3 || biome.index == 7) { //koosh, lr\r\n        li.push(createDualTexture(\"mesmer1\"));\r\n        li.push(createDualTexture(\"mesmer2\"));\r\n    }\r\n    if (biome.index == 1) {\r\n        li.push(createDualTexture(\"hoopfish\"));\r\n    }\r\n    if (biome.index == 2 || biome.index == 4) {\r\n        li.push(createDualTexture(\"biter\"));\r\n    }\r\n    if (biome.index == 2 || biome.index == 6 || biome.index == 7) { //red grass, blood kelp, lr\r\n        li.push(createDualTexture(\"reginald\"));\r\n    }\r\n    if (biome.index == 4) {\r\n        li.push(createDualTexture(\"oculus\"));\r\n    }\r\n    if (biome.index == 4 || biome.index == 5) {\r\n        li.push({ mainTexture: \"eyeye\" });\r\n    }\r\n    if (biome.index == 6) { //bkelp\r\n        li.push(createDualTexture(\"blighter\"));\r\n    }\r\n    if (biome.index == 6 || biome.index == 7) { //bkelp, lr\r\n        li.push(createDualTexture(\"spinefish\"));\r\n    }\r\n    if (biome.index >= 8) { //ilz\r\n        li.push(createDualTexture(\"magmarang\"));\r\n    }\r\n    return li.length == 0 ? null : li[getRandomBetween(0, li.length - 1)];\r\n}\r\nfunction generateRedGrass(rows, cols, tiles, biomes, objects, illum) {\r\n    let biome = biomes[2];\r\n    for (let x = 0; x < cols; x++) {\r\n        if (getRandomBetween(0, 5) > 0) {\r\n            let y = biome.height[x].airFloor;\r\n            const idx = getArrayIndex(cols, x, y);\r\n            if (tiles[idx].isAir)\r\n                addObject(objects, illum, { mainTexture: \"red-grass\" }, x, y);\r\n        }\r\n    }\r\n}\r\nfunction generateGrassTowers(rows, cols, tiles, biomes) {\r\n    let biome = biomes[2];\r\n    let set = [];\r\n    let max = 999;\r\n    for (let x = getRandomBetween(3, 5); x < cols - 4; x++) {\r\n        let y0 = biome.height[x].airFloor;\r\n        let y = Math.max(biome.height[x].topRow + 2, (biome.height[x].topRow + biome.height[x].bottomRow) / 2, y0 - Math.ceil(getRandomDecimalBetween(Math.max(biome.height[x].rowsAllocated * 0.25, 3), Math.max(biome.height[x].rowsAllocated * 0.67, 7))));\r\n        if (y0 - y >= 2) {\r\n            const foreground = getRandomBetween(0, 2) == 0;\r\n            let slots = [];\r\n            max = Math.min(max, y);\r\n            for (let yy = y; yy <= y0; yy++) {\r\n                const w = yy == y ? 1 : Math.min(1, getRandomBetween(0, 2));\r\n                for (let xx = x - w; xx <= x + w; xx++) {\r\n                    const idx = getArrayIndex(cols, xx, yy);\r\n                    tiles[idx].tileOverlay = null;\r\n                    if (foreground)\r\n                        tiles[idx].backgroundWater = null;\r\n                    biome.height[xx].airFloor = Math.min(biome.height[xx].airFloor, yy - 1);\r\n                    if (foreground)\r\n                        biome.height[xx].solidFloor = Math.min(biome.height[xx].solidFloor, yy - 1);\r\n                    tiles[idx].isAir = false;\r\n                    slots.push(idx);\r\n                }\r\n            }\r\n            set.push({ centerX: x, baseY: y0, top: y, gridSlots: slots, foreground: false });\r\n            x += getRandomBetween(5, 9);\r\n        }\r\n    }\r\n    return { towers: set, highestY: max };\r\n}\r\nfunction generateKelpCaves(rows, cols, tiles, biomes, objects, illum, towers) {\r\n    let biome = biomes[1];\r\n    let caves = [];\r\n    const func = towers ? function (idx) {\r\n        for (let data of towers.towers) {\r\n            if (data.gridSlots.includes(idx))\r\n                return true;\r\n        }\r\n        return false;\r\n    } : null;\r\n    for (let i = 0; i < 5; i++) {\r\n        let x = getRandomBetween(2, cols - 3);\r\n        let y = getRandomBetween(biome.highest + 6, biome.lowest);\r\n        //const idx = getArrayIndex(cols, x, y);\r\n        //addBlock(blocks, idx, \"bkelp\");\r\n        genBlob(rows, cols, tiles, x, y, \"cave\", [3, 5], func, caves);\r\n    }\r\n    for (let i = 0; i < 125; i++) {\r\n        const idx = caves[getRandomBetween(0, caves.length - 1)];\r\n        const tile = tiles[idx];\r\n        if (tile.y < biome.height[tile.x].topRow)\r\n            continue;\r\n        const idxu = getArrayIndex(cols, tile.x, tile.y - 1);\r\n        if (!caves.includes(idxu)) {\r\n            const n2 = getRandomBetween(1, 3);\r\n            for (let n = 0; n < n2; n++)\r\n                addObject(objects, illum, createFullGlowTexture(\"stinger\"), tile.x, tile.y, getRandomBetween(-48, 48));\r\n        }\r\n    }\r\n    return caves;\r\n}\r\nfunction generateJellyshroomCave(rows, cols, tiles, biomes, objects, illum) {\r\n    let biome = biomes[4];\r\n    const caveCeil = getSurface(cols, 1.5, 0, Math.min(3, (biome.lowest - biome.highest) * 0.25));\r\n    const caveFloor = getSurface(cols, 0.5, 0, Math.min(8, (biome.lowest - biome.highest) * 0.33));\r\n    const ceilAdd = Math.min((biome.lowest - biome.highest) * 0.25, 5);\r\n    const floorAdd = Math.min((biome.lowest - biome.highest) * 0.25, 3);\r\n    for (let x = 0; x < cols; x++) {\r\n        const col = biome.height[x];\r\n        const y1 = col.topRow + ceilAdd + caveCeil[x];\r\n        const y2 = col.bottomRow - floorAdd - caveFloor[x];\r\n        col.airCeiling = Math.floor(y1);\r\n        col.airFloor = Math.floor(y2);\r\n        col.solidFloor = Math.floor(y2);\r\n        //console.log(\"Jellyshroom @ \"+x+\": \"+y1+\" > \"+y2);\r\n        for (let y = y1; y <= y2; y++) {\r\n            const idx = getArrayIndex(cols, x, y);\r\n            if (tiles[idx].biome == biome) {\r\n                tiles[idx].backgroundWater = \"jellycave-light\"; //\"jellycave\";\r\n                tiles[idx].isAir = true;\r\n            }\r\n        } /*\r\n        for (let y = y1-2; y < y1; y++) {\r\n            const idx = getArrayIndex(cols, x, y);\r\n            tiles[idx].backgroundWater = \"jellycave-light\";\r\n        }\r\n        for (let y = y2+1; y <= y2+3; y++) {\r\n            const idx = getArrayIndex(cols, x, y);\r\n            tiles[idx].backgroundWater = \"jellycave-light\";\r\n        }*/\r\n        for (let y = y1 - 2; y <= y2 + 3; y++) {\r\n            const idx = getArrayIndex(cols, x, y);\r\n            tiles[idx].tileOverlay = \"jellycave-light\";\r\n        }\r\n    }\r\n    for (let x = 0; x < cols - 1; x++) {\r\n        if (getRandomBetween(0, 2) == 0) {\r\n            if (Math.abs(biome.height[x].airFloor - biome.height[x + 1].airFloor) <= 1) {\r\n                let y = Math.max(biome.height[x].airFloor, biome.height[x + 1].airFloor);\r\n                if (getRandomBetween(0, 2) == 0)\r\n                    generateDoubleWidePlant(cols, objects, illum, x, y, y - 1, createDualTexture(\"jellyshroom-bottom\"), null, createFullGlowTexture(\"jellyshroom-top\"));\r\n                else\r\n                    generateDoubleWidePlant(cols, objects, illum, x, y, y - 1, createDualTexture(\"jellyshroom2-bottom\"), null, createFullGlowTexture(\"jellyshroom2-top\"));\r\n                tiles[getArrayIndex(cols, x, y)].groundObjects = 2;\r\n                tiles[getArrayIndex(cols, x + 1, y)].groundObjects = 2;\r\n                tiles[getArrayIndex(cols, x, y - 1)].groundObjects = 2;\r\n                tiles[getArrayIndex(cols, x + 1, y - 1)].groundObjects = 2;\r\n                x += 2;\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction generateLostRiverCave(rows, cols, tiles, biomes, objects, illum) {\r\n    const leftShaft = Math.random() < 0.5;\r\n    const divisions = [getRandomBetween(7, cols / 2), getRandomBetween(cols / 2, cols - 7)];\r\n    let shaft = leftShaft ? 5 : cols - 6;\r\n    let boneX = Math.round((leftShaft ? (divisions[1] + cols) / 2 : divisions[0] / 2) - 2); //cols-shaft;\r\n    //console.log(\"Shaft @ \"+shaft);\r\n    let biome = biomes[7];\r\n    const caveCeil = getSurface(cols, 0.5, 0, Math.min(2, (biome.lowest - biome.highest) * 0.25));\r\n    //const lake = getSurface(cols, 0.25, 0, Math.min(8, (biome.lowest-biome.highest)*0.33));\r\n    const bottom = getSurface(cols, 0.5, 0, Math.min(4, (biome.lowest - biome.highest) * 0.33));\r\n    const ceilAdd = Math.min((biome.lowest - biome.highest) * 0.25, 3);\r\n    const floorAdd = Math.min((biome.lowest - biome.highest) * 0.25, 5);\r\n    const amt1 = getRandomBetween(2, 5);\r\n    const amt2 = getRandomBetween(2, 5);\r\n    const riverFloor = new Array(cols);\r\n    for (let x = 0; x < cols; x++) {\r\n        const col = biome.height[x];\r\n        let y1 = col.topRow + ceilAdd + caveCeil[x];\r\n        if (Math.abs(x - boneX) <= 2)\r\n            bottom[x] = 0;\r\n        let y2 = col.bottomRow - floorAdd - bottom[x];\r\n        let lake = biome.highest + (biome.lowest - biome.highest) * 0.6;\r\n        const dd = Math.abs(shaft - x);\r\n        if (dd <= 2) {\r\n            y2 = col.bottomRow;\r\n            if (dd <= 1)\r\n                lake = col.bottomRow + 1;\r\n        }\r\n        else if (dd <= 5) {\r\n            y2 += 9 - dd;\r\n            //lake += (9-dd)*0.5;\r\n        }\r\n        if (leftShaft) {\r\n            if (x >= divisions[0]) {\r\n                y2 -= amt1;\r\n                lake -= x > divisions[0] ? amt1 : amt1 / 2;\r\n            }\r\n            if (x >= divisions[1]) {\r\n                y2 -= amt2;\r\n                lake -= x > divisions[1] ? amt2 : amt2 / 2;\r\n            }\r\n        }\r\n        else {\r\n            if (x <= divisions[1]) {\r\n                y2 -= amt1;\r\n                lake -= x < divisions[1] ? amt1 : amt1 / 2;\r\n            }\r\n            if (x <= divisions[0]) {\r\n                y2 -= amt2;\r\n                lake -= x < divisions[0] ? amt2 : amt2 / 2;\r\n            }\r\n        }\r\n        if (y2 > col.bottomRow)\r\n            y2 = col.bottomRow;\r\n        //console.log(\"Jellyshroom @ \"+x+\": \"+y1+\" > \"+y2);\r\n        col.airCeiling = Math.floor(y1);\r\n        col.airFloor = Math.floor(lake - 1);\r\n        col.solidFloor = Math.floor(y2);\r\n        riverFloor[x] = Math.floor(lake) + 3;\r\n        for (let y = y1; y <= y2; y++) {\r\n            const idx = getArrayIndex(cols, x, y);\r\n            tiles[idx].backgroundWater = biome.biome.waterColor;\r\n            if (y >= lake)\r\n                tiles[idx].tileOverlay = \"brine\";\r\n            else\r\n                tiles[idx].tileOverlay = biome.biome.waterColor + \"-light\";\r\n            if (Math.abs(y - lake) <= 1 && dd > 2)\r\n                tiles[idx].baseTexture = Math.random() < 0.5 ? \"lr2\" : \"lr1\"; /*\r\n        for (let y = y1-2; y < y1; y++) {\r\n            const idx = getArrayIndex(cols, x, y);\r\n            tiles[idx].backgroundWater = biome.biome.waterColor+\"-light\";\r\n        }\r\n        for (let y = y2+1; y <= y2+3; y++) {\r\n            const idx = getArrayIndex(cols, x, y);\r\n            tiles[idx].backgroundWater = biome.biome.waterColor+\"-light\";\r\n        }*/\r\n        }\r\n    } /*\r\n    let x = shaft-2;\r\n    for (let y = y1; y <= y2; y++) {\r\n\r\n    }*/\r\n    let boneY = riverFloor[boneX] - 4;\r\n    addObjectOfSizeAt(objects, illum, createDualTexture(\"lrskull\"), boneX, boneY + 0.4, 640, 384);\r\n    //cove\r\n    let treeX = cols - shaft;\r\n    const cl = biome.lowest - 5;\r\n    const coveFloor = new Array(cols);\r\n    let pillar1 = getRandomBetween(0, cols);\r\n    let pillar2 = getRandomBetween(0, cols);\r\n    let pillar3 = getRandomBetween(0, cols);\r\n    for (let x = 0; x < cols; x++) {\r\n        if ((leftShaft && x < shaft) || (!leftShaft && x > shaft)) {\r\n            coveFloor[x] = -1;\r\n            continue;\r\n        }\r\n        const dPl = Math.min(Math.abs(x - pillar1), Math.abs(x - pillar2), Math.abs(x - pillar3));\r\n        const dTr = Math.abs(x - treeX);\r\n        const col = biome.height[x];\r\n        let y1 = Math.max(riverFloor[x], col.solidFloor) + (dTr < 5 ? 2 : 3);\r\n        let y2 = biome.lowest - 3;\r\n        const solid = dTr <= 2 || dPl == 0;\r\n        coveFloor[x] = solid ? cl - 1 : (dPl == 1 ? y2 - 1 : y2);\r\n        for (let y = y1; y <= y2; y++) {\r\n            const idx = getArrayIndex(cols, x, y);\r\n            tiles[idx].tileOverlay = \"water-cove\";\r\n            if (y >= cl - getRandomBetween(1, 2))\r\n                tiles[idx].baseTexture = \"lr6\";\r\n            else if (y >= y1 * 0.7 + cl * 0.3)\r\n                tiles[idx].baseTexture = \"lr7\";\r\n            else\r\n                tiles[idx].baseTexture = \"lr8\";\r\n            if (y >= cl) {\r\n                if (solid || ((dTr == 3 || dPl == 1) && y == y2)) {\r\n                    tiles[idx].tileOverlay = null;\r\n                }\r\n                else {\r\n                    tiles[idx].tileOverlay = \"brine-cove\";\r\n                    tiles[idx].baseTexture = \"lr6\";\r\n                }\r\n            }\r\n            if (y >= cl) {\r\n                tiles[idx].baseTexture = y == cl ? (Math.random() < 0.5 ? \"lr2\" : \"lr1\") : \"rock-deep1\";\r\n            }\r\n        }\r\n    }\r\n    let treeY = coveFloor[treeX] - 1;\r\n    const lsh = getRandomBetween(0, 1) == 0;\r\n    addObjectOfSizeAt(objects, illum, createDualTexture(\"cove-tree\"), lsh ? treeX - 1 : treeX - 2, treeY - 1.33, 512, 512);\r\n    /*\r\n    const coveCeil = getSurface(cols, 0.5, 0, Math.min(5, (biome.lowest-biome.highest)*0.33));\r\n    const coveFloor = getSurface(cols, 0.5, 0, Math.min(3, (biome.lowest-biome.highest)*0.25));\r\n    const ceilAddCove = Math.min((biome.lowest-biome.highest)*0.25, 2);\r\n    const floorAddCove = Math.min((biome.lowest-biome.highest)*0.25, 1);\r\n    for (let x = 0; x < cols; x++) {\r\n        const col = biome.height[x];\r\n        let y1 = col.topRow+ceilAddCove+coveCeil[x];\r\n        let y2 = col.bottomRow-floorAddCove-coveFloor[x];\r\n        let yw = biome.highest+(biome.lowest-biome.highest)*0.667;\r\n        let d = 3;\r\n        //console.log(\"Jellyshroom @ \"+x+\": \"+y1+\" > \"+y2);\r\n        if (leftShaft) {\r\n            y1 += Math.max(0, x-4)*0.25;\r\n            y2 += Math.max(0, x-4)*0.75;\r\n            yw += Math.max(0, x-4)*0.125;\r\n            d -= Math.max(0, x-4)*0.125;\r\n        }\r\n        else {\r\n            y1 += Math.max(0, cols-x-4)*0.25;\r\n            y2 += Math.max(0, cols-x-4)*0.75;\r\n            yw += Math.max(0, cols-x-4)*0.125;\r\n            d -= Math.max(0, cols-x-4)*0.125;\r\n        }\r\n        y1 = Math.floor(y1);\r\n        y2 = Math.floor(y2);\r\n        if (y2 > col.bottomRow-d)\r\n            y2 = col.bottomRow-d;\r\n        col.airCeiling = Math.floor(y1);\r\n        col.airFloor = Math.floor(yw);\r\n        col.solidFloor = Math.floor(y2);\r\n        const edgeThresh = getRandomDecimalBetween(1.0, 2.5);\r\n        const edgeThresh2 = getRandomDecimalBetween(-1, 1);\r\n        for (let y = y1; y <= y2; y++) {\r\n            const idx = getArrayIndex(cols, x, y);\r\n            if (tiles[idx] == null) {\r\n                console.log(\"null tile @ \"+x+\", \"+y);\r\n                continue;\r\n            }\r\n            if (tiles[idx].biome == biome) {\r\n                if (y >= yw-5)\r\n                    tiles[idx].baseTexture = y >= yw-edgeThresh ? (Math.random() < 0.5 ? \"lr2\" : \"lr1\") : \"lr6\";\r\n                //tiles[idx].backgroundWater = biome.biome.waterColor;\r\n                if (y >= yw) {\r\n                    tiles[idx].tileOverlay = biome.biome.waterColor;\r\n                    if (y >= yw+edgeThresh2)\r\n                        tiles[idx].baseTexture = \"rock-lr1\";\r\n                }\r\n                else {\r\n                    tiles[idx].isAir = true;\r\n                    tiles[idx].tileOverlay = \"brine-blue\";\r\n                }\r\n            }\r\n        }\r\n    }*/\r\n    const lxc = Math.floor((divisions[0] + divisions[1]) / 2);\r\n    let ret = { shaftLocation: shaft, coveFloor: coveFloor, treeX: treeX, treeY: treeY, skullX: boneX, skullY: boneY, middleLakeXCenter: lxc, middleLakeLevel: riverFloor[lxc] - 3 };\r\n    return ret;\r\n}\r\nfunction generateILZCave(rows, cols, tiles, biomes, shaft, objects, illum) {\r\n    let biome = biomes[8];\r\n    const caves = [];\r\n    const cfloor = [];\r\n    const floor = getSurface(cols, 2, 0, 3);\r\n    for (let x = 0; x < cols; x++) {\r\n        const col = biome.height[x];\r\n        const dy = getRandomBetween(0, 3);\r\n        cfloor[x] = Math.min(rows - 1, col.bottomRow - 3) + floor[x] - 3;\r\n        col.solidFloor = Math.floor(cfloor[x]);\r\n        col.airCeiling = col.topRow + 2;\r\n        for (let y0 = col.airCeiling; y0 <= cfloor[x]; y0++) {\r\n            const idx = getArrayIndex(cols, x, y0);\r\n            tiles[idx].tileOverlay = biome.biome.waterColor;\r\n            let y = y0;\r\n            if ((x - cols / 2) < 7) {\r\n                y += dy;\r\n            }\r\n            const rsq = (x - cols / 2) * (x - cols / 2) + (y - cfloor[x]) * (y - cfloor[x]) * 1.25;\r\n            //console.log(x+\", \"+y+\" / \"+(cols/2)+\", \"+cfloor+\" > \"+rsq);\r\n            if (rsq <= 256 && rsq >= 81) {\r\n                caves.push(idx);\r\n                tiles[idx].backgroundWater = biome.biome.waterColor;\r\n                tiles[idx].isAir = true;\r\n            }\r\n            else {\r\n                col.solidFloor = Math.max(col.solidFloor, y0 - 1);\r\n            }\r\n        }\r\n    }\r\n    const left = shaft < 6;\r\n    const x2 = left ? cols - 6 : 5;\r\n    for (let x = x2 - 2; x <= x2 + 2; x++) {\r\n        const col = biome.height[x];\r\n        const cfloor = Math.min(rows - 1, col.bottomRow - 3);\r\n        for (let y = col.topRow; y <= cfloor; y++) {\r\n            const idx = getArrayIndex(cols, x, y);\r\n            if (!caves.includes(idx)) {\r\n                caves.push(idx);\r\n                tiles[idx].backgroundWater = biome.biome.waterColor;\r\n                tiles[idx].isAir = true;\r\n            }\r\n        }\r\n    }\r\n    for (let x = shaft - 2; x <= shaft + 2; x++) {\r\n        const col = biome.height[x];\r\n        for (let y = col.topRow; y <= cfloor[x]; y++) {\r\n            const idx = getArrayIndex(cols, x, y);\r\n            let tex = Math.abs(x - shaft) < 2 ? biome.biome.waterColor : \"magma\";\r\n            if (tex == \"magma\" || !caves.includes(idx)) {\r\n                caves.push(idx);\r\n                tiles[idx].tileOverlay = tex;\r\n                tiles[idx].isAir = true;\r\n            }\r\n        }\r\n    }\r\n    for (let x = 0; x < cols; x++) {\r\n        if (floor[x] == 3) {\r\n            const idx = getArrayIndex(cols, x, cfloor[x]);\r\n            tiles[idx].tileOverlay = \"magma\";\r\n            biome.height[x].solidFloor--;\r\n        }\r\n    }\r\n    //addBlock(tiles, idx, biome.biome.waterColor);\r\n    //addBlock(tiles, idx, \"magma\");\r\n    for (let x = 0; x < cols - 1; x++) {\r\n        if (getRandomBetween(0, 2) == 0) {\r\n            if (Math.abs(biome.height[x].solidFloor - biome.height[x + 1].solidFloor) <= 1) {\r\n                let y = Math.min(rows - 1, Math.round(Math.max(biome.height[x].solidFloor, biome.height[x + 1].solidFloor)));\r\n                if (getRandomBetween(0, 2) == 0)\r\n                    generateDoubleWidePlant(cols, objects, illum, x, y, y - 1, createDualTexture(\"lavashroom-bottom\"), null, createFullGlowTexture(\"lavashroom-top\"));\r\n                else\r\n                    generateDoubleWidePlant(cols, objects, illum, x, y, y - 1, createDualTexture(\"lavashroom2-bottom\"), null, createFullGlowTexture(\"lavashroom2-top\"));\r\n                tiles[getArrayIndex(cols, x, y)].groundObjects = 2;\r\n                tiles[getArrayIndex(cols, x + 1, y)].groundObjects = 2;\r\n                tiles[getArrayIndex(cols, x, y - 1)].groundObjects = 2;\r\n                tiles[getArrayIndex(cols, x + 1, y - 1)].groundObjects = 2;\r\n                x += 2;\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction getInterpolatedBiomeHeight(biome, f1, f2) {\r\n    const f = f2 ? getRandomDecimalBetween(f1, f2) : f1;\r\n    let ret = Math.floor(biome.highest + (biome.lowest - biome.highest) * f);\r\n    if (ret < biome.highest)\r\n        return biome.highest;\r\n    if (ret > biome.lowest)\r\n        return biome.lowest;\r\n    return ret;\r\n}\r\nfunction addCreatureAtRandomizedPosition(cols, objects, illum, creature, biome, w, h, f1, f2, lowestY) {\r\n    const wT = Math.ceil(w / 128);\r\n    const hT = Math.ceil(h / 128);\r\n    const x = getRandomBetween(wT, cols - wT);\r\n    let y = f1 ? getInterpolatedBiomeHeight(biome, f1, f2) : getRandomBetween(biome.highest, biome.lowest);\r\n    for (let dx = Math.max(0, x - wT); dx <= Math.min(x + wT, cols - 1); dx++) {\r\n        y = Math.max(biome.height[dx].airCeiling + 1, Math.min(biome.height[dx].solidFloor - hT - 1, y));\r\n    }\r\n    if (lowestY)\r\n        y = Math.min(lowestY, y);\r\n    let elems = addObjectOfSizeAt(objects, illum, creature, x, y, w, h);\r\n    setRandomRotations(elems, 5);\r\n    flipWithChance(elems, 0.5);\r\n}\r\nexport function flipWithChance(elems, chance) {\r\n    if (Math.random() < chance)\r\n        mirrorXs(elems);\r\n}\r\nfunction generateLargeCreatures(rows, cols, tiles, biomes, objects, illum, towers, lrdata) {\r\n    if (biomes.length > 1) { //kelp\r\n        for (let i = 0; i < 3; i++)\r\n            addCreatureAtRandomizedPosition(cols, objects, illum, { mainTexture: \"stalker\" }, biomes[1], 512, 192);\r\n    }\r\n    if (biomes.length > 2 && towers && towers.highestY - biomes[2].highest > 3) { //red grass\r\n        if (Math.random() <= 0.67)\r\n            addCreatureAtRandomizedPosition(cols, objects, illum, createDualTexture(\"reefback1\"), biomes[2], 1536, 512, 0.125, 0.5, towers ? towers.highestY - 4 : null);\r\n        if (Math.random() <= 0.67)\r\n            addCreatureAtRandomizedPosition(cols, objects, illum, createDualTexture(\"reefback2\"), biomes[2], 1536, 512, 0.125, 0.5, towers ? towers.highestY - 4 : null);\r\n    }\r\n    if (biomes.length > 3) { //koosh\r\n        if (Math.random() <= 0.67)\r\n            addCreatureAtRandomizedPosition(cols, objects, illum, createDualTexture(\"ampeel\"), biomes[3], 512, 256);\r\n        const ns = getRandomBetween(0, 3);\r\n        for (let i = 0; i < ns; i++)\r\n            addCreatureAtRandomizedPosition(cols, objects, illum, createDualTexture(\"boneshark\"), biomes[3], 384, 192);\r\n    }\r\n    if (biomes.length > 4) { //jellyshroom\r\n        addCreatureAtRandomizedPosition(cols, objects, illum, { mainTexture: \"crabsnake1\" }, biomes[4], 384, 288, 0.5);\r\n        addCreatureAtRandomizedPosition(cols, objects, illum, { mainTexture: \"crabsnake2\" }, biomes[4], 512, 64, 0.5);\r\n    }\r\n    if (biomes.length > 5) { //grand reef\r\n        addCreatureAtRandomizedPosition(cols, objects, illum, createDualTexture(\"ghostlevi\"), biomes[5], 1152, 384, 0.2, 0.5);\r\n        for (let i = 0; i < 3; i++) {\r\n            const idx = getRandomBetween(1, 2);\r\n            addCreatureAtRandomizedPosition(cols, objects, illum, createDualTexture(\"deepstalker\" + idx), biomes[5], idx == 1 ? 384 : 512, idx == 1 ? 205 : 192, 0.5, 0.8);\r\n        }\r\n    }\r\n    if (biomes.length > 6) { //bkelp\r\n        addCreatureAtRandomizedPosition(cols, objects, illum, createDualTexture(\"ampeel2\"), biomes[6], 512, 320);\r\n        addCreatureAtRandomizedPosition(cols, objects, illum, createDualTexture(\"warper\"), biomes[6], 256, 192);\r\n    }\r\n    if (biomes.length > 7 && lrdata) { //lr\r\n        const prY = biomes[7].height[lrdata.shaftLocation].bottomRow - getRandomBetween(3, 6) - 5;\r\n        for (let i = 0; i < 2; i++) {\r\n            flipWithChance(addObjectOfSizeAt(objects, illum, createDualTexture(\"prowler\"), lrdata.shaftLocation + getRandomBetween(-2, 2), prY - i, 384, 240), 0.5);\r\n            flipWithChance(addObjectOfSizeAt(objects, illum, createDualTexture(\"prowler\"), lrdata.middleLakeXCenter + getRandomBetween(-2, 2), lrdata.middleLakeLevel - 2 - i, 384, 240), 0.5);\r\n            flipWithChance(addObjectOfSizeAt(objects, illum, createDualTexture(\"prowler\"), lrdata.skullX + getRandomBetween(-2, 2), lrdata.skullY + getRandomBetween(-3, 1) - i, 384, 240), 0.5);\r\n        }\r\n        const n = getRandomBetween(0, 6);\r\n        if (n != 0)\r\n            addObjectOfSizeAt(objects, illum, createFullGlowTexture(\"ghostrays1\"), lrdata.treeX - 3.5, lrdata.treeY - 2, 960, 540);\r\n        if (n != 1)\r\n            addObjectOfSizeAt(objects, illum, createFullGlowTexture(\"ghostrays2\"), lrdata.treeX - 3.5, lrdata.treeY - 2, 960, 540);\r\n    }\r\n    if (biomes.length > 8) { //ilz\r\n        if (Math.random() <= 0.5)\r\n            addCreatureAtRandomizedPosition(cols, objects, illum, createDualTexture(\"dragon\"), biomes[8], 1280, 640, 0.4);\r\n        if (Math.random() <= 0.67)\r\n            addCreatureAtRandomizedPosition(cols, objects, illum, { mainTexture: \"crimsonray1\" }, biomes[8], 512, 256);\r\n        if (Math.random() <= 0.67)\r\n            addCreatureAtRandomizedPosition(cols, objects, illum, { mainTexture: \"crimsonray2\" }, biomes[8], 512, 256);\r\n        if (Math.random() <= 0.8)\r\n            addCreatureAtRandomizedPosition(cols, objects, illum, createDualTexture(\"larva\"), biomes[8], 128, 64);\r\n    }\r\n}\r\nfunction generateSmallCreatures(rows, cols, tiles, biomes, objects, illum, kelpcaves, towers, lrdata) {\r\n    for (const biome of biomes) {\r\n        const n = Math.max(5, (biome.lowest - biome.highest) * 0.8);\r\n        for (let i = 0; i < n; i++) {\r\n            const gen = getRandomSmallFish(biome);\r\n            if (gen) {\r\n                let x = getRandomBetween(0, cols - 1);\r\n                let y = Math.round(getRandomBetween(biome.index == 0 ? 0 : biome.height[x].airCeiling + 1, biome.height[x].solidFloor - 1));\r\n                const idx = getArrayIndex(cols, x, y);\r\n                if (idx >= tiles.length || idx < 0 || !tiles[idx].isAir) {\r\n                    continue;\r\n                }\r\n                const n2 = gen.mainTexture != \"biter\" && gen.mainTexture != \"blighter\" && gen.mainTexture != \"rabbitray\" && gen.mainTexture != \"mesmer2\" ? getRandomBetween(1, 3) : 1;\r\n                const ang = Math.random() < 0.33 && n2 > 1 ? getRandomBetween(-90, 90) : getRandomBetween(-30, 30);\r\n                const flip = Math.random() < 0.5;\r\n                for (let k = 0; k < n2; k++) {\r\n                    const elems = addObject(objects, illum, gen, x, y, getRandomBetween(-48, 48), getRandomBetween(-48, 48));\r\n                    setRotations(elems, ang);\r\n                    if (flip)\r\n                        mirrorXs(elems);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    if (kelpcaves) {\r\n        for (let i = 0; i < 16; i++) {\r\n            const idx = kelpcaves[getRandomBetween(0, kelpcaves.length - 1)];\r\n            const tile = tiles[idx];\r\n            setRandomRotations(addObject(objects, illum, createDualTexture(\"shuttlebug\"), tile.x, tile.y, getRandomBetween(-16, 16), getRandomBetween(-16, 16)), 180);\r\n        }\r\n    }\r\n}\r\nexport default function setPageBackground() {\r\n    if (isPhone)\r\n        return;\r\n    let w = 128 * SCALE;\r\n    let h = 128 * SCALE;\r\n    let x = 0;\r\n    let y = 0;\r\n    //var height = findHighestNode(0, document.documentElement.childNodes);\r\n    let body = document.body;\r\n    let html = document.documentElement;\r\n    var rh = document.body.offsetHeight; //Math.max(body.offsetHeight, html.clientHeight, html.offsetHeight, window.innerHeight, document.body.clientHeight);\r\n    var rw = Math.max(window.innerWidth, document.body.clientWidth);\r\n    //console.log(rw+\" x \"+rh);\r\n    let rows = Math.ceil(rh / h);\r\n    let cols = Math.ceil(rw / w);\r\n    let tw = cols * w;\r\n    let th = rows * h;\r\n    console.log(\"Generating subnautica tileset with \" + cols + \" columns and \" + rows + \" rows\");\r\n    let tag = \"background-content\";\r\n    let container = document.getElementById(tag);\r\n    if (container == null) {\r\n        container = document.createElement(\"div\");\r\n        container.id = tag;\r\n        console.log(\"Injecting background element.\");\r\n        document.body.prepend(container);\r\n    }\r\n    while (container.firstChild) {\r\n        container.removeChild(container.firstChild);\r\n    }\r\n    const biomes = allocateBiomes(rows, cols);\r\n    let tiles = new Array(cols * rows);\r\n    let grid = document.createElement(\"div\");\r\n    container.appendChild(grid);\r\n    grid.className = \"tile-layer\";\r\n    grid.style.width = rw.toString() + \"px\";\r\n    grid.style.height = rh.toString() + \"px\";\r\n    grid.classList.add(\"tile-layer\");\r\n    let objects = document.createElement(\"div\");\r\n    objects.style.width = rw.toString() + \"px\";\r\n    objects.style.height = rh.toString() + \"px\";\r\n    objects.style.position = \"relative\";\r\n    objects.style.left = \"0px\";\r\n    objects.style.top = \"0px\";\r\n    objects.classList.add(\"entity-layer\");\r\n    container.appendChild(objects);\r\n    let water = document.createElement(\"div\"); //water overlay, not the base underlay\r\n    water.style.width = rw.toString() + \"px\";\r\n    water.style.height = rh.toString() + \"px\";\r\n    water.style.position = \"relative\";\r\n    water.style.left = \"0px\";\r\n    water.style.top = \"0px\";\r\n    water.classList.add(\"tile-layer\");\r\n    container.appendChild(water);\r\n    let illum = document.createElement(\"div\");\r\n    illum.style.width = rw.toString() + \"px\";\r\n    illum.style.height = rh.toString() + \"px\";\r\n    illum.style.position = \"relative\";\r\n    illum.style.left = \"0px\";\r\n    illum.style.top = \"0px\";\r\n    illum.classList.add(\"entity-layer\");\r\n    //illum.classList.add(\"glow-layer\");\r\n    container.appendChild(illum);\r\n    for (let i = 0; i < cols; i++) {\r\n        for (let k = 0; k < rows; k++) {\r\n            const idx = getArrayIndex(cols, i, k);\r\n            const tile = {};\r\n            tile.x = i;\r\n            tile.y = k;\r\n            tile.biome = getBiomeAtRow(k, biomes, i);\r\n            tile.baseTexture = getRandomBiomeTerrain(i, k, tile.biome);\r\n            tiles[idx] = tile;\r\n        }\r\n    }\r\n    for (const biome of biomes) {\r\n        generateBiomeFloor(cols, tiles, biome, 2, biome.biome.height.floorFraction, biome.biome.height.minFloorRows);\r\n    }\r\n    if (biomes.length > 4)\r\n        generateJellyshroomCave(rows, cols, tiles, biomes, objects, illum);\r\n    let towers = null;\r\n    if (biomes.length > 2) {\r\n        towers = generateGrassTowers(rows, cols, tiles, biomes);\r\n        generateRedGrass(rows, cols, tiles, biomes, objects, illum);\r\n    }\r\n    let kelpcaves = null;\r\n    if (biomes.length > 1) {\r\n        generateCreepvine(rows, cols, tiles, biomes, objects, illum);\r\n        kelpcaves = generateKelpCaves(rows, cols, tiles, biomes, objects, illum, towers);\r\n    }\r\n    if (biomes.length > 3)\r\n        generateKoosh(rows, cols, tiles, biomes, objects, illum);\r\n    if (biomes.length > 5)\r\n        generateReefPods(rows, cols, tiles, biomes, objects, illum);\r\n    if (biomes.length > 6)\r\n        generateBloodKelp(rows, cols, tiles, biomes, objects, illum);\r\n    let lrdata = null;\r\n    if (biomes.length > 7) {\r\n        lrdata = generateLostRiverCave(rows, cols, tiles, biomes, objects, illum); //includes cove\r\n        if (biomes.length > 8)\r\n            generateILZCave(rows, cols, tiles, biomes, lrdata.shaftLocation, objects, illum);\r\n    }\r\n    generateGroundDeco(rows, cols, tiles, biomes, lrdata, objects, illum);\r\n    generateSmallCreatures(rows, cols, tiles, biomes, objects, illum, kelpcaves, towers, lrdata);\r\n    generateLargeCreatures(rows, cols, tiles, biomes, objects, illum, towers, lrdata);\r\n    buildImage(grid, water, rows, cols, tiles);\r\n    fitBCG(objects, SCALE);\r\n    fitBCG(illum, SCALE);\r\n}\r\n//window.addEventListener('resize', debounce(setPageBackground, 100));\r\n"],"sourceRoot":""}