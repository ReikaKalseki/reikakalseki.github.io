(self.webpackChunksitecore=self.webpackChunksitecore||[]).push([[394],{21:(e,t,o)=>{var r;!function(){"use strict";var i=.5*(Math.sqrt(3)-1),n=(3-Math.sqrt(3))/6,l=1/6,a=(Math.sqrt(5)-1)/4,s=(5-Math.sqrt(5))/20;function h(e){var t;t="function"==typeof e?e:e?function(){var e=0,t=0,o=0,r=1,i=u();e=i(" "),t=i(" "),o=i(" ");for(var n=0;n<arguments.length;n++)(e-=i(arguments[n]))<0&&(e+=1),(t-=i(arguments[n]))<0&&(t+=1),(o-=i(arguments[n]))<0&&(o+=1);return i=null,function(){var i=2091639*e+2.3283064365386963e-10*r;return e=t,t=o,o=i-(r=0|i)}}(e):Math.random,this.p=c(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var o=0;o<512;o++)this.perm[o]=this.p[255&o],this.permMod12[o]=this.perm[o]%12}function c(e){var t,o=new Uint8Array(256);for(t=0;t<256;t++)o[t]=t;for(t=0;t<255;t++){var r=t+~~(e()*(256-t)),i=o[t];o[t]=o[r],o[r]=i}return o}function u(){var e=4022871197;return function(t){t=t.toString();for(var o=0;o<t.length;o++){var r=.02519603282416938*(e+=t.charCodeAt(o));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}h.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(e,t){var o,r,l=this.permMod12,a=this.perm,s=this.grad3,h=0,c=0,u=0,d=(e+t)*i,m=Math.floor(e+d),g=Math.floor(t+d),f=(m+g)*n,p=e-(m-f),x=t-(g-f);p>x?(o=1,r=0):(o=0,r=1);var b=p-o+n,w=x-r+n,M=p-1+2*n,y=x-1+2*n,v=255&m,T=255&g,k=.5-p*p-x*x;if(k>=0){var F=3*l[v+a[T]];h=(k*=k)*k*(s[F]*p+s[F+1]*x)}var R=.5-b*b-w*w;if(R>=0){var Y=3*l[v+o+a[T+r]];c=(R*=R)*R*(s[Y]*b+s[Y+1]*w)}var O=.5-M*M-y*y;if(O>=0){var C=3*l[v+1+a[T+1]];u=(O*=O)*O*(s[C]*M+s[C+1]*y)}return 70*(h+c+u)},noise3D:function(e,t,o){var r,i,n,a,s,h,c,u,d,m,g=this.permMod12,f=this.perm,p=this.grad3,x=.3333333333333333*(e+t+o),b=Math.floor(e+x),w=Math.floor(t+x),M=Math.floor(o+x),y=(b+w+M)*l,v=e-(b-y),T=t-(w-y),k=o-(M-y);v>=T?T>=k?(s=1,h=0,c=0,u=1,d=1,m=0):v>=k?(s=1,h=0,c=0,u=1,d=0,m=1):(s=0,h=0,c=1,u=1,d=0,m=1):T<k?(s=0,h=0,c=1,u=0,d=1,m=1):v<k?(s=0,h=1,c=0,u=0,d=1,m=1):(s=0,h=1,c=0,u=1,d=1,m=0);var F=v-s+l,R=T-h+l,Y=k-c+l,O=v-u+2*l,C=T-d+2*l,j=k-m+2*l,A=v-1+.5,S=T-1+.5,L=k-1+.5,W=255&b,E=255&w,q=255&M,X=.6-v*v-T*T-k*k;if(X<0)r=0;else{var z=3*g[W+f[E+f[q]]];r=(X*=X)*X*(p[z]*v+p[z+1]*T+p[z+2]*k)}var N=.6-F*F-R*R-Y*Y;if(N<0)i=0;else{var D=3*g[W+s+f[E+h+f[q+c]]];i=(N*=N)*N*(p[D]*F+p[D+1]*R+p[D+2]*Y)}var I=.6-O*O-C*C-j*j;if(I<0)n=0;else{var _=3*g[W+u+f[E+d+f[q+m]]];n=(I*=I)*I*(p[_]*O+p[_+1]*C+p[_+2]*j)}var U=.6-A*A-S*S-L*L;if(U<0)a=0;else{var V=3*g[W+1+f[E+1+f[q+1]]];a=(U*=U)*U*(p[V]*A+p[V+1]*S+p[V+2]*L)}return 32*(r+i+n+a)},noise4D:function(e,t,o,r){var i,n,l,h,c,u,d,m,g,f,p,x,b,w,M,y,v,T=this.perm,k=this.grad4,F=(e+t+o+r)*a,R=Math.floor(e+F),Y=Math.floor(t+F),O=Math.floor(o+F),C=Math.floor(r+F),j=(R+Y+O+C)*s,A=e-(R-j),S=t-(Y-j),L=o-(O-j),W=r-(C-j),E=0,q=0,X=0,z=0;A>S?E++:q++,A>L?E++:X++,A>W?E++:z++,S>L?q++:X++,S>W?q++:z++,L>W?X++:z++;var N=A-(u=E>=3?1:0)+s,D=S-(d=q>=3?1:0)+s,I=L-(m=X>=3?1:0)+s,_=W-(g=z>=3?1:0)+s,U=A-(f=E>=2?1:0)+2*s,V=S-(p=q>=2?1:0)+2*s,B=L-(x=X>=2?1:0)+2*s,G=W-(b=z>=2?1:0)+2*s,H=A-(w=E>=1?1:0)+3*s,P=S-(M=q>=1?1:0)+3*s,J=L-(y=X>=1?1:0)+3*s,K=W-(v=z>=1?1:0)+3*s,Q=A-1+4*s,Z=S-1+4*s,$=L-1+4*s,ee=W-1+4*s,te=255&R,oe=255&Y,re=255&O,ie=255&C,ne=.6-A*A-S*S-L*L-W*W;if(ne<0)i=0;else{var le=T[te+T[oe+T[re+T[ie]]]]%32*4;i=(ne*=ne)*ne*(k[le]*A+k[le+1]*S+k[le+2]*L+k[le+3]*W)}var ae=.6-N*N-D*D-I*I-_*_;if(ae<0)n=0;else{var se=T[te+u+T[oe+d+T[re+m+T[ie+g]]]]%32*4;n=(ae*=ae)*ae*(k[se]*N+k[se+1]*D+k[se+2]*I+k[se+3]*_)}var he=.6-U*U-V*V-B*B-G*G;if(he<0)l=0;else{var ce=T[te+f+T[oe+p+T[re+x+T[ie+b]]]]%32*4;l=(he*=he)*he*(k[ce]*U+k[ce+1]*V+k[ce+2]*B+k[ce+3]*G)}var ue=.6-H*H-P*P-J*J-K*K;if(ue<0)h=0;else{var de=T[te+w+T[oe+M+T[re+y+T[ie+v]]]]%32*4;h=(ue*=ue)*ue*(k[de]*H+k[de+1]*P+k[de+2]*J+k[de+3]*K)}var me=.6-Q*Q-Z*Z-$*$-ee*ee;if(me<0)c=0;else{var ge=T[te+1+T[oe+1+T[re+1+T[ie+1]]]]%32*4;c=(me*=me)*me*(k[ge]*Q+k[ge+1]*Z+k[ge+2]*$+k[ge+3]*ee)}return 27*(i+n+l+h+c)}},h._buildPermutationTable=c,void 0===(r=function(){return h}.call(t,o,t,e))||(e.exports=r),t.SimplexNoise=h,e.exports=h}()},394:(e,t,o)=>{"use strict";o.r(t),o.d(t,{flipWithChance:()=>C,default:()=>j});var r=o(621),i=o(212),n=o(21);const l=[a("shallow",4,0,.5,2,0,0,2,1,"rock-shallow",1,"water-base",.5,1),a("kelp",8,40,.25,0,2,2,3,2,"rock-kelp",4,"water-kelp",.5,.5),a("redgrass",8,90,.75,0,2,1,1,.5,"rock-medium",2,"water-redgrass",.75,2),a("koosh",6,150,.5,1,4,2,3,1,"rock-deep",3,"water-koosh",2,1),a("jellyshroom",8,200,0,0,2,1,4,1,"rock-scale",1,"water-jelly",1.5,2),a("grandreef",10,300,.5,3,4,2,6,2,"rock-deep",3,"water-greef",1,1.5),a("bloodkelp",8,450,.75,1,4,2,1,1,"rock-scale",1,"water-bkelp",1.5,1.25),a("lostriver",12,700,0,0,3,1,2,1,"rock-lr",2,"water-lr",1,1),a("lava",15,1e3,0,0,1,1,0,0,"lava",6,"water-ilz",2,.25),a("void",1,1400,0,0,0,0,0,0,"void",3,"none",0,0)];function a(e,t,o,r,i,n,l,a,s,h,c,u,d,m){return{name:e,height:{rowsRequired:t,floorFraction:r,minFloorRows:i},variationCeil:{rate:l,range:n},variationFloor:{rate:s,range:a},depth:o,baseTerrainTexture:h,terrainVariants:c,waterColor:u,oreSpawnRate:d,plantSpawnRate:m}}const s=new n;function h(e,t){const o=[];let r=e,i=0,n=0;for(const e of l)if(e.height.rowsRequired<=r&&(o.push({biome:e,index:n,height:new Array(t),highest:9999,lowest:-1}),r-=e.height.rowsRequired,i+=e.height.rowsRequired,n++),r<=0)break;const a=e/i;for(const e of o){const r=Math.floor(a*e.biome.height.rowsRequired),i=(0==e.index?0:o[e.index-1].lowest+1)+r,n=e.index==o.length-1?{rate:0,range:0}:o[e.index+1].biome.variationCeil,l=Math.min(3,e.biome.variationFloor.rate,n.rate),s=Math.min(20,.5*r*(1-e.biome.height.floorFraction),e.biome.variationFloor.range,n.range),h=p(t,l,i-s,i+s);for(let r=0;r<t;r++){const t={biome:e,topRow:0,bottomRow:0,rowsAllocated:0,airCeiling:0,airFloor:0,solidFloor:0,x:0};e.height[r]=t,t.topRow=0==e.index?0:o[e.index-1].height[r].bottomRow+1,t.airCeiling=t.topRow,t.airFloor=t.bottomRow,t.solidFloor=t.bottomRow,t.bottomRow=h[r],t.rowsAllocated=t.bottomRow-t.topRow+1,e.highest=Math.min(e.highest,t.topRow),e.lowest=Math.max(e.lowest,t.bottomRow)}}for(;o[o.length-1].highest>=e;)o.pop();o[o.length-1].lowest=e-1;for(let r=0;r<t;r++)o[o.length-1].height[r].bottomRow=e-1;return console.log("Calculated biome stack is:"),console.log(o),o}function c(e,t,o){if(1==t.length||e<t[1].height[o].topRow)return t[0];if(e>=t[t.length-1].height[o].topRow)return t[t.length-1];for(const r of t)if(e>=r.height[o].topRow&&e<=r.height[o].bottomRow)return r;return console.log("No biome available at row="+e+" of "+t+" @ "+o),null}function u(e,t,o,r,i,n){if(!(t=g(t))||"air"==t||"empty"==t)return null;let l=function(e,t,o,r){let i=document.createElement("div");return i.className="tile-subnautica-"+t,e.appendChild(i),i}(e,t);return l.style.position="relative",l.style.left=o.toString()+"px",l.style.top=r.toString()+"px",l.style.transformOrigin="top left",l}function d(e,t,o){let r=document.createElement("div");return r.className="tile-subnautica-"+t,r.style.zIndex=o.toString(),e.appendChild(r),r}function m(e,t,o){const r=(t-o.height[e].topRow)/o.height[e].rowsAllocated,i=t>=o.height[e].bottomRow+1-1;if("bloodkelp"==o.biome.name&&i)return"bkelp-floor";let n=o.biome.baseTerrainTexture;const l=(1+s.noise2D(.1*e,.1*t))/2;let a=1+Math.floor(l*o.biome.terrainVariants);return"lostriver"==o.biome.name?r<.2?(n="lr",a=4):r<.3&&(n="lr",a=3):"cove"==o.biome.name&&(n="lr",a=r<.25?8:r<.9975?7:6),n+a}function g(e){return(0,r.w7)()&&(e&&(e.includes("water-")||e.includes("cave-")||e.includes("brine-"))?e="dark-"+e:e&&e.endsWith("-glow_toggle")&&(e=null)),e}function f(e,t,o,i,n,l,a,s,h){const c=(0,r.sT)(a[0],a[1]),u=(0,r.sT)(a[0],a[1]),d=Math.max(0,Math.floor(i-c)),m=Math.max(0,Math.floor(n-u)),g=Math.min(t-1,Math.floor(i+c)),f=Math.min(e-1,Math.floor(n+u)),p=.95,x=(0,r.sT)(-p,p),b=(0,r.sT)(-p,p);for(let a=d;a<=g;a++)for(let d=m;d<=f;d++){const m=a-i,g=d-n;if(m*m+g*g<=c*u+.5){const i=a+Math.floor(x*g),n=d+Math.floor(b*m);if(i<0||n<0||i>=t||n>=e)continue;const c=(0,r.Yy)(t,e,i,n);!(c>=0&&c<o.length)||s&&s(c)||h.includes(c)||(o[c].backgroundWater=l,h.push(c),(l.includes("water")||l.includes("cave"))&&(o[c].isAir=!0))}}}function p(e,t,o,i){const n=new Array(e);let l=-1;for(let a=0;a<e;a++){let e=(0,r.sc)(o,i);const s=e-l;l>=0&&Math.abs(s)>t&&(e=l+Math.sign(s)),l=e,n[a]=e}return n}function x(e,t,o,i,n,l,a){const s=p(t,i.biome.variationFloor.rate,i.highest+(i.lowest-i.highest)*l,i.lowest-1-a);for(let n=0;n<t;n++){const l=i.height[n];if(l.airFloor=Math.min(s[n],l.bottomRow-1),l.solidFloor=l.airFloor,i.index<=6&&4!=i.index)for(let a=l.topRow;a<=l.bottomRow;a++){const s=(0,r.Yy)(t,e,n,a);o[s].tileOverlay=i.biome.waterColor,a<=l.airFloor&&(o[s].backgroundWater=i.biome.waterColor,o[s].isAir=!0)}}}function b(e,t,o,r,i,n,l){return w(e,t,o,r,i,0,0,n,l)}function w(e,t,o,r,i,n,l,a,s){r*=64,i*=64,a&&(r+=a),s&&(i+=s);let h=[];return o.mainTexture&&h.push(u(e,o.mainTexture,r,i)),o.illumTexture&&h.push(u(t,o.illumTexture,r,i)),h}function M(e,t,o,i,n,l,a,s,h){const c=(0,r.sc)(-32,32);for(let e=l;e<=n;e++){const u=e==n,d=e==l?s:u&&h?h:a;b(t,o,d[(0,r.sc)(0,d.length-1)],i,e,c)}}function y(e,t,o,i,n,l,a,s,h){const c=(0,r.sc)(-16,16);for(let e=n;e>=l;e--){const r=e==n,u=e==l?h:r||!s?a:s;let d=u.mainTexture?u.mainTexture:u.illumTexture;if(d&&"*"==d.charAt(d.length-2)){const r=parseInt(d.charAt(d.length-1));d=d.substring(0,d.length-2);const n=u.illumTexture?u.illumTexture.substring(0,u.illumTexture.indexOf("*"))+u.illumTexture.substring(u.illumTexture.indexOf("*")+2):null;for(let l=0;l<r;l++){let r=e-l;b(t,o,v(u,d,n,(l+1).toString()+"-left"),i,r,c),b(t,o,v(u,d,n,(l+1).toString()+"-right"),i+1,r,c)}e-=r-1}else b(t,o,v(u,d,null,"-left"),i,e,c),b(t,o,v(u,d,null,"-right"),i+1,e,c)}}function v(e,t,o,r){return{mainTexture:(t||e.mainTexture)+r,illumTexture:e.illumTexture?(o||e.illumTexture)+r:null}}function T(e){return{mainTexture:e,illumTexture:e+"-glow"}}function k(e){return{mainTexture:null,illumTexture:e}}function F(e){let t=[{mainTexture:"quartz"}];return e.index>=3&&e.index<=7&&t.push({mainTexture:"lithium"}),e.index>=3&&4!=e.index&&e.index<=6&&t.push(T("azurite")),e.index>=4&&e.index<=7&&t.push({mainTexture:"magnetite"}),e.index>=5&&e.index<=7&&t.push(T("ruby")),e.index>=6&&e.index<=7&&t.push(T("uranium")),6==e.index&&t.push(k("abysso")),7==e.index&&t.push({mainTexture:"sulfur"}),e.index>=7&&t.push({mainTexture:"nickel"}),e.index>=8&&t.push(k("kyanite")),0==t.length?null:t[(0,r.sc)(0,t.length-1)]}function R(e){let t=[];return 0==e.index&&(t.push(T("wigglegrass")),t.push(T("acidmushroom"))),e.index>=2&&e.index<=3&&t.push({mainTexture:"redwort"}),e.index>=2&&e.index<=5&&4!=e.index&&t.push(T("alkaliplant")),(e.index>=4&&e.index<=5||2==e.index)&&t.push(k("violetbeau")),e.index>=5&&e.index<=7&&t.push(T("gabefeather")),5==e.index&&t.push(T("membrain")),e.index>=6&&t.push({mainTexture:"whitemushroom"}),7==e.index&&(t.push(T("ghostweed")),t.push(T("crabkelp"))),0==t.length?null:t[(0,r.sc)(0,t.length-1)]}function Y(e){let t=[];return e.index<=5&&4!=e.index&&(t.push(T("peeper")),t.push({mainTexture:"bladderfish"})),0==e.index&&t.push(T("rabbitray")),0!=e.index&&3!=e.index||t.push(T("boomerang")),3!=e.index&&7!=e.index||(t.push(T("mesmer1")),t.push(T("mesmer2"))),1==e.index&&t.push(T("hoopfish")),2!=e.index&&4!=e.index||t.push(T("biter")),2!=e.index&&6!=e.index&&7!=e.index||t.push(T("reginald")),4==e.index&&t.push(T("oculus")),4!=e.index&&5!=e.index||t.push({mainTexture:"eyeye"}),6==e.index&&t.push(T("blighter")),6!=e.index&&7!=e.index||t.push(T("spinefish")),e.index>=8&&t.push(T("magmarang")),0==t.length?null:t[(0,r.sc)(0,t.length-1)]}function O(e,t,o,i,n,l,a,s,h,c){const u=Math.ceil(l/64),d=Math.ceil(a/64),m=(0,r.sc)(u,e-u);let g=s?function(e,t,o){const i=o?(0,r.sT)(t,o):t;let n=Math.floor(e.highest+(e.lowest-e.highest)*i);return n<e.highest?e.highest:n>e.lowest?e.lowest:n}(n,s,h):(0,r.sc)(n.highest,n.lowest);for(let t=Math.max(0,m-u);t<=Math.min(m+u,e-1);t++)g=Math.max(n.height[t].airCeiling+1,Math.min(n.height[t].solidFloor-d-1,g));c&&(g=Math.min(c,g));let f=w(t,o,i,m,g);(0,r.MY)(f,5),C(f,.5)}function C(e,t){Math.random()<t&&(0,r.L_)(e)}function j(){if(i.M)return;document.body,document.documentElement;var e=document.body.offsetHeight,t=Math.max(window.innerWidth,document.body.clientWidth);let o=Math.ceil(e/64),n=Math.ceil(t/64);console.log("Generating subnautica tileset with "+n+" columns and "+o+" rows");let l="background-content",a=document.getElementById(l);for(null==a&&(a=document.createElement("div"),a.id=l,console.log("Injecting background element."),document.body.prepend(a));a.firstChild;)a.removeChild(a.firstChild);const s=h(o,n);let u=new Array(n*o),v=document.createElement("div");a.appendChild(v),v.className="tile-layer",v.style.width=t.toString()+"px",v.style.height=e.toString()+"px",v.classList.add("tile-layer");let j=document.createElement("div");j.style.width=t.toString()+"px",j.style.height=e.toString()+"px",j.style.position="relative",j.style.left="0px",j.style.top="0px",j.classList.add("entity-layer"),a.appendChild(j);let A=document.createElement("div");A.style.width=t.toString()+"px",A.style.height=e.toString()+"px",A.style.position="relative",A.style.left="0px",A.style.top="0px",A.classList.add("tile-layer"),a.appendChild(A);let S=document.createElement("div");S.style.width=t.toString()+"px",S.style.height=e.toString()+"px",S.style.position="relative",S.style.left="0px",S.style.top="0px",S.classList.add("entity-layer"),a.appendChild(S);for(let e=0;e<n;e++)for(let t=0;t<o;t++){const i=(0,r.Yy)(n,o,e,t),l={};l.x=e,l.y=t,l.biome=c(t,s,e),l.baseTexture=m(e,t,l.biome),u[i]=l}for(const e of s)x(o,n,u,e,0,e.biome.height.floorFraction,e.biome.height.minFloorRows);s.length>4&&function(e,t,o,i,n,l){let a=i[4];const s=p(t,1.5,0,Math.min(3,.25*(a.lowest-a.highest))),h=p(t,.5,0,Math.min(8,.33*(a.lowest-a.highest))),c=Math.min(.25*(a.lowest-a.highest),5),u=Math.min(.25*(a.lowest-a.highest),3);for(let i=0;i<t;i++){const n=a.height[i],l=n.topRow+c+s[i],d=n.bottomRow-u-h[i];n.airCeiling=Math.floor(l),n.airFloor=Math.floor(d),n.solidFloor=Math.floor(d);for(let n=l;n<=d;n++){const l=(0,r.Yy)(t,e,i,n);o[l].biome==a&&(o[l].backgroundWater="jellycave-light",o[l].isAir=!0)}for(let n=l-2;n<=d+3;n++)o[(0,r.Yy)(t,e,i,n)].tileOverlay="jellycave-light"}for(let i=0;i<t-1;i++)if(0==(0,r.sc)(0,2)&&Math.abs(a.height[i].airFloor-a.height[i+1].airFloor)<=1){let s=Math.max(a.height[i].airFloor,a.height[i+1].airFloor);0==(0,r.sc)(0,2)?y(0,n,l,i,s,s-1,T("jellyshroom-bottom"),null,k("jellyshroom-top")):y(0,n,l,i,s,s-1,T("jellyshroom2-bottom"),null,k("jellyshroom2-top")),o[(0,r.Yy)(t,e,i,s)].groundObjects=2,o[(0,r.Yy)(t,e,i+1,s)].groundObjects=2,o[(0,r.Yy)(t,e,i,s-1)].groundObjects=2,o[(0,r.Yy)(t,e,i+1,s-1)].groundObjects=2,i+=2}}(o,n,u,s,j,S);let L=null;s.length>2&&(L=function(e,t,o,i){let n=i[2],l=[],a=999;for(let i=(0,r.sc)(3,5);i<t-4;i++){let s=n.height[i].airFloor,h=Math.max(n.height[i].topRow+2,Math.ceil((n.height[i].topRow+n.height[i].bottomRow)/2),s-Math.ceil((0,r.sT)(Math.max(.25*n.height[i].rowsAllocated,3),Math.max(Math.ceil(.67*n.height[i].rowsAllocated),7))));if(s-h>=2){const c=0==(0,r.sc)(0,2);let u=[];a=Math.min(a,h);for(let l=h;l<=s;l++){const a=l==h?1:Math.min(1,(0,r.sc)(0,2));for(let s=i-a;s<=i+a;s++){const i=(0,r.Yy)(t,e,s,l);o[i].tileOverlay=null,c&&(o[i].backgroundWater=null),n.height[s].airFloor=Math.min(n.height[s].airFloor,l-1),c&&(n.height[s].solidFloor=Math.min(n.height[s].solidFloor,l-1)),o[i].isAir=!1,u.push(i)}}l.push({centerX:i,baseY:s,top:h,gridSlots:u,foreground:!1}),i+=(0,r.sc)(5,9)}}return{towers:l,highestY:a}}(o,n,u,s),function(e,t,o,i,n,l){let a=i[2];for(let i=0;i<t;i++)if((0,r.sc)(0,5)>0){let s=Math.ceil(a.height[i].airFloor);o[(0,r.Yy)(t,e,i,s)].isAir&&b(n,l,{mainTexture:"red-grass"},i,s)}}(o,n,u,s,j,S));let W=null;s.length>1&&(function(e,t,o,i,n,l){let a=i[1];for(let e=0;e<t;e++)if((0,r.sc)(0,3)>0){const o=a.height[e],i=(0,r.sc)(0,6);let s=-1,h=-1;switch(i){case 0:case 1:case 2:s=o.solidFloor,h=Math.max(o.topRow,s-(0,r.sc)(4,8)),M(0,n,l,e,s,h,[{mainTexture:"creepvine-1"},{mainTexture:"creepvine-2"},{mainTexture:"creepvine-3"},{mainTexture:"creepvine-4"},{mainTexture:"creepvine-5"}],[{mainTexture:"creepvine-top1"}],null);break;case 3:case 4:case 5:e<t-1&&Math.abs(a.height[e].solidFloor-a.height[e+1].solidFloor)<=1&&(s=Math.max(a.height[e].solidFloor,a.height[e+1].solidFloor),h=Math.max(o.topRow,s-3),y(0,n,l,e,s,h,{mainTexture:"large-creepvine-bottom*2"},5==i?T("creepvine-seed"):{mainTexture:"large-creepvine-center"},{mainTexture:"large-creepvine-top*3"}),e+=1)}}}(0,n,0,s,j,S),W=function(e,t,o,i,n,l,a){let s=i[1],h=[];const c=a?function(e){for(let t of a.towers)if(t.gridSlots.includes(e))return!0;return!1}:null;for(let i=0;i<5;i++)f(e,t,o,(0,r.sc)(2,t-3),(0,r.sc)(s.highest+6,s.lowest),"cave",[3,5],c,h);for(let i=0;i<125;i++){const i=o[h[(0,r.sc)(0,h.length-1)]];if(i.y<s.height[i.x].topRow)continue;const a=(0,r.Yy)(t,e,i.x,i.y-1);if(!h.includes(a)){const e=(0,r.sc)(1,3);for(let t=0;t<e;t++)b(n,l,k("stinger"),i.x,i.y,(0,r.sc)(-48,48))}}return h}(o,n,u,s,j,S,L)),s.length>3&&function(e,t,o,i,n,l){let a=i[3];for(let i=0;i<t-1;i++)if((0,r.sc)(0,4)>0&&Math.abs(a.height[i].solidFloor-a.height[i+1].solidFloor)<=1){let s=Math.max(a.height[i].solidFloor,a.height[i+1].solidFloor);y(0,n,l,i,s,s-1,T("koosh-bottom"),null,T("koosh-top")),o[(0,r.Yy)(t,e,i,s)].groundObjects=2,o[(0,r.Yy)(t,e,i+1,s)].groundObjects=2,o[(0,r.Yy)(t,e,i,s-1)].groundObjects=2,o[(0,r.Yy)(t,e,i+1,s-1)].groundObjects=2,i+=2}}(o,n,u,s,j,S),s.length>5&&function(e,t,o,i,n,l){let a=i[5];for(let e=0;e<t-1;e++)if((0,r.sc)(0,3)>0&&Math.abs(a.height[e].solidFloor-a.height[e+1].solidFloor)<=1){let t=Math.max(a.height[e].solidFloor,a.height[e+1].solidFloor);y(0,n,l,e,t,Math.max(a.height[e].topRow+2,a.height[e+1].topRow+2,t-(0,r.sc)(2,5)),{mainTexture:"reef-pod-bottom*2"},{mainTexture:"reef-pod-middle"},T("reef-pod-top*2")),e+=2}}(0,n,0,s,j,S),s.length>6&&function(e,t,o,i,n,l){let a=i[6];for(let e=0;e<t;e++)if((0,r.sc)(0,1)>0){let t=a.height[e].solidFloor;M(0,n,l,e,t,Math.max(a.height[e].topRow,t-(0,r.sc)(3,12)),[{mainTexture:"bkelp-middle1"},{mainTexture:"bkelp-middle2"},{mainTexture:"bkelp-middle3"}],[{mainTexture:"bkelp-top1"},{mainTexture:"bkelp-top2"}],[T("bkelp-bottom1"),T("bkelp-bottom2")])}}(0,n,0,s,j,S);let E=null;s.length>7&&(E=function(e,t,o,i,n,l){const a=Math.random()<.5,s=[(0,r.sc)(7,t/2),(0,r.sc)(t/2,t-7)];let h=a?5:t-6,c=Math.round((a?(s[1]+t)/2:s[0]/2)-2),u=i[7];const d=p(t,.5,0,Math.min(2,.25*(u.lowest-u.highest))),m=p(t,.5,0,Math.min(4,.33*(u.lowest-u.highest))),g=Math.min(.25*(u.lowest-u.highest),3),f=Math.min(.25*(u.lowest-u.highest),5),x=(0,r.sc)(2,5),b=(0,r.sc)(2,5),M=new Array(t);for(let i=0;i<t;i++){const n=u.height[i];let l=n.topRow+g+d[i];Math.abs(i-c)<=2&&(m[i]=0);let p=n.bottomRow-f-m[i],w=u.highest+.6*(u.lowest-u.highest);const y=Math.abs(h-i);y<=2?(p=n.bottomRow,y<=1&&(w=n.bottomRow+1)):y<=5&&(p+=9-y),a?(i>=s[0]&&(p-=x,w-=i>s[0]?x:x/2),i>=s[1]&&(p-=b,w-=i>s[1]?b:b/2)):(i<=s[1]&&(p-=x,w-=i<s[1]?x:x/2),i<=s[0]&&(p-=b,w-=i<s[0]?b:b/2)),p>n.bottomRow&&(p=n.bottomRow),n.airCeiling=Math.floor(l),n.airFloor=Math.floor(w-1),n.solidFloor=Math.floor(p),M[i]=Math.floor(w)+3;for(let n=l;n<=p;n++){const l=(0,r.Yy)(t,e,i,n);o[l].backgroundWater=u.biome.waterColor,o[l].tileOverlay=n>=w?"brine":u.biome.waterColor+"-light",Math.abs(n-w)<=1&&y>2&&(o[l].baseTexture=Math.random()<.5?"lr2":"lr1")}}let y=M[c]-4;w(n,l,T("lrskull"),c,y+.4);let v=t-h;const k=u.lowest-5,F=new Array(t);let R=(0,r.sc)(0,t),Y=(0,r.sc)(0,t),O=(0,r.sc)(0,t);for(let i=0;i<t;i++){if(a&&i<h||!a&&i>h){F[i]=-1;continue}const n=Math.min(Math.abs(i-R),Math.abs(i-Y),Math.abs(i-O)),l=Math.abs(i-v),s=u.height[i];let c=Math.max(M[i],s.solidFloor)+(l<5?2:3),d=u.lowest-3;const m=l<=2||0==n;F[i]=m?k-1:1==n?d-1:d;for(let a=c;a<=d;a++){const s=(0,r.Yy)(t,e,i,a);o[s].tileOverlay="water-cove",a>=k-(0,r.sc)(1,2)?o[s].baseTexture="lr6":o[s].baseTexture=a>=.7*c+.3*k?"lr7":"lr8",a>=k&&(m||(3==l||1==n)&&a==d?o[s].tileOverlay=null:(o[s].tileOverlay="brine-cove",o[s].baseTexture="lr6")),a>=k&&(o[s].baseTexture=a==k?Math.random()<.5?"lr2":"lr1":"rock-deep1")}}let C=F[v]-1;const j=0==(0,r.sc)(0,1);w(n,l,T("cove-tree"),j?v-1:v-2,C-1.33);const A=Math.floor((s[0]+s[1])/2);return{shaftLocation:h,coveFloor:F,treeX:v,treeY:C,skullX:c,skullY:y,middleLakeXCenter:A,middleLakeLevel:M[A]-3}}(o,n,u,s,j,S),s.length>8&&function(e,t,o,i,n,l,a){let s=i[8];const h=[],c=[],u=p(t,2,0,3);for(let i=0;i<t;i++){const n=s.height[i],l=(0,r.sc)(0,3);c[i]=Math.min(e-1,n.bottomRow-3)+u[i]-3,n.solidFloor=Math.floor(c[i]),n.airCeiling=n.topRow+2;for(let a=n.airCeiling;a<=c[i];a++){const u=(0,r.Yy)(t,e,i,a);o[u].tileOverlay=s.biome.waterColor;let d=a;i-t/2<7&&(d+=l);const m=(i-t/2)*(i-t/2)+(d-c[i])*(d-c[i])*1.25;m<=256&&m>=81?(h.push(u),o[u].backgroundWater=s.biome.waterColor,o[u].isAir=!0):n.solidFloor=Math.max(n.solidFloor,a-1)}}const d=n<6?t-6:5;for(let i=d-2;i<=d+2;i++){const n=s.height[i],l=Math.min(e-1,n.bottomRow-3);for(let a=n.topRow;a<=l;a++){const n=(0,r.Yy)(t,e,i,a);h.includes(n)||(h.push(n),o[n].backgroundWater=s.biome.waterColor,o[n].isAir=!0)}}for(let i=n-2;i<=n+2;i++)for(let l=s.height[i].topRow;l<=c[i];l++){const a=(0,r.Yy)(t,e,i,l);let c=Math.abs(i-n)<2?s.biome.waterColor:"magma";"magma"!=c&&h.includes(a)||(h.push(a),o[a].tileOverlay=c,o[a].isAir=!0)}for(let i=0;i<t;i++)3==u[i]&&(o[(0,r.Yy)(t,e,i,c[i])].tileOverlay="magma",s.height[i].solidFloor--);for(let i=0;i<t-1;i++)if(0==(0,r.sc)(0,2)&&Math.abs(s.height[i].solidFloor-s.height[i+1].solidFloor)<=1){let n=Math.min(e-1,Math.round(Math.max(s.height[i].solidFloor,s.height[i+1].solidFloor)));0==(0,r.sc)(0,2)?y(0,l,a,i,n,n-1,T("lavashroom-bottom"),null,k("lavashroom-top")):y(0,l,a,i,n,n-1,T("lavashroom2-bottom"),null,k("lavashroom2-top")),o[(0,r.Yy)(t,e,i,n)].groundObjects=2,o[(0,r.Yy)(t,e,i+1,n)].groundObjects=2,o[(0,r.Yy)(t,e,i,n-1)].groundObjects=2,o[(0,r.Yy)(t,e,i+1,n-1)].groundObjects=2,i+=2}}(o,n,u,s,E.shaftLocation,j,S)),function(e,t,o,i,n,l,a){for(const s of i){const i=12*s.biome.plantSpawnRate,h=6*s.biome.oreSpawnRate;for(let h=0;h<i;h++){const i=R(s);if(i){let h=(0,r.sc)(0,t-1);if(n&&7==s.index&&Math.abs(h-n.shaftLocation)<=2)continue;let c=Math.min(s.height[h].solidFloor,e-1);const u=(0,r.Yy)(t,e,h,c);if(o[u].groundObjects>=1)continue;if("wigglegrass"==i.mainTexture||"acidmushroom"==i.mainTexture||"whitemushroom"==i.mainTexture){const e=(0,r.sc)(2,5);for(let t=0;t<e;t++)b(l,a,i,h,c,(0,r.sc)(-60,60))}else{const e="membrain"!=i.mainTexture?48:24;b(l,a,i,h,c,(0,r.sc)(-e,e))}o[u].groundObjects++}}for(let i=0;i<h;i++){const i=F(s);if(i){let h=(0,r.sc)(0,t-1);if(n&&7==s.index&&Math.abs(h-n.shaftLocation)<=2)continue;let c=Math.min(s.height[h].solidFloor,e-1);const u=(0,r.Yy)(t,e,h,c);if(o[u].groundObjects>=1)continue;const d="abysso"==i.illumTexture||"azurite"==i.mainTexture?48:24;b(l,a,i,h,c,(0,r.sc)(-d,d)),o[u].groundObjects++}}}if(!(i.length<=7)&&n)for(let s=0;s<t;s++)if(n.coveFloor[s]>=0&&0==(0,r.sc)(0,3)&&Math.abs(n.treeX-s)>1){const h=F(i[7]);if(h){const i=n.coveFloor[s],c=(0,r.Yy)(t,e,s,i);if(o[c].groundObjects>=1)continue;const u="abysso"==h.illumTexture||"azurite"==h.mainTexture?48:24;b(l,a,h,s,i,(0,r.sc)(-u,u)),o[c].groundObjects++}}}(o,n,u,s,E,j,S),function(e,t,o,i,n,l,a,s,h){for(const a of i){const i=Math.max(5,.8*(a.lowest-a.highest));for(let s=0;s<i;s++){const i=Y(a);if(i){let s=(0,r.sc)(0,t-1),h=Math.round((0,r.sc)(0==a.index?0:a.height[s].airCeiling+1,a.height[s].solidFloor-1));const c=(0,r.Yy)(t,e,s,h);if(c>=o.length||c<0||!o[c].isAir)continue;const u="biter"!=i.mainTexture&&"blighter"!=i.mainTexture&&"rabbitray"!=i.mainTexture&&"mesmer2"!=i.mainTexture?(0,r.sc)(1,3):1,d=Math.random()<.33&&u>1?(0,r.sc)(-90,90):(0,r.sc)(-30,30),m=Math.random()<.5;for(let e=0;e<u;e++){const e=b(n,l,i,s,h,(0,r.sc)(-48,48),(0,r.sc)(-48,48));(0,r.Fl)(e,d),m&&(0,r.L_)(e)}}}}if(a)for(let e=0;e<16;e++){const e=o[a[(0,r.sc)(0,a.length-1)]];(0,r.MY)(b(n,l,T("shuttlebug"),e.x,e.y,(0,r.sc)(-16,16),(0,r.sc)(-16,16)),180)}}(o,n,u,s,j,S,W),function(e,t,o,i,n,l,a,s){if(i.length>1)for(let e=0;e<3;e++)O(t,n,l,{mainTexture:"stalker"},i[1],256,96);if(i.length>2&&a&&a.highestY-i[2].highest>3&&(Math.random()<=.67&&O(t,n,l,T("reefback1"),i[2],768,256,.125,.5,a?a.highestY-4:null),Math.random()<=.67&&O(t,n,l,T("reefback2"),i[2],768,256,.125,.5,a?a.highestY-4:null)),i.length>3){Math.random()<=.67&&O(t,n,l,T("ampeel"),i[3],256,128);const e=(0,r.sc)(0,3);for(let o=0;o<e;o++)O(t,n,l,T("boneshark"),i[3],192,96)}if(i.length>4&&(O(t,n,l,{mainTexture:"crabsnake1"},i[4],192,144,.5),O(t,n,l,{mainTexture:"crabsnake2"},i[4],256,32,.5)),i.length>5){O(t,n,l,T("ghostlevi"),i[5],576,192,.2,.5);for(let e=0;e<3;e++){const e=(0,r.sc)(1,2);O(t,n,l,T("deepstalker"+e),i[5],1==e?192:256,1==e?102:96,.5,.8)}}if(i.length>6&&(O(t,n,l,T("ampeel2"),i[6],256,160),O(t,n,l,T("warper"),i[6],128,96)),i.length>7&&s){const e=i[7].height[s.shaftLocation].bottomRow-(0,r.sc)(3,6)-5;for(let t=0;t<2;t++)C(w(n,l,T("prowler"),s.shaftLocation+(0,r.sc)(-2,2),e-t),.5),C(w(n,l,T("prowler"),s.middleLakeXCenter+(0,r.sc)(-2,2),s.middleLakeLevel-2-t),.5),C(w(n,l,T("prowler"),s.skullX+(0,r.sc)(-2,2),s.skullY+(0,r.sc)(-3,1)-t),.5);const t=(0,r.sc)(0,6);0!=t&&w(n,l,k("ghostrays1"),s.treeX-3.5,s.treeY-2),1!=t&&w(n,l,k("ghostrays2"),s.treeX-3.5,s.treeY-2)}i.length>8&&(Math.random()<=.5&&O(t,n,l,T("dragon"),i[8],640,320,.4),Math.random()<=.67&&O(t,n,l,{mainTexture:"crimsonray1"},i[8],256,128),Math.random()<=.67&&O(t,n,l,{mainTexture:"crimsonray2"},i[8],256,128),Math.random()<=.8&&O(t,n,l,T("larva"),i[8],64,32))}(0,n,0,s,j,S,L,E),function(e,t,o,i,n){for(var l=0;l<o;l++){let s=document.createElement("div"),h=document.createElement("div");for(var a=0;a<i;a++){const e=n[(0,r.Yy)(i,o,a,l)];let t=s,c=h,u=g(e.baseTexture);u||(u="empty"),t=d(t,u,0),(0,r.w7)()&&(e.backgroundWater&&"empty"!=e.backgroundWater||e.tileOverlay&&"empty"!=e.tileOverlay||(e.tileOverlay="cave")),e.backgroundWater&&(e.backgroundWater=g(e.backgroundWater),e.backgroundWater&&(t=d(t,e.backgroundWater,1)));let m=!1;e.tileOverlay&&(e.tileOverlay=g(e.tileOverlay),e.tileOverlay&&(c=d(c,e.tileOverlay,4),m=!0)),m||(c=d(c,"empty",4))}e.appendChild(s),t.appendChild(h)}(0,r.xE)(e,1),(0,r.xE)(t,1)}(v,A,o,n,u),(0,r.xE)(j,1),(0,r.xE)(S,1)}}}]);
//# sourceMappingURL=394.bundle.js.map