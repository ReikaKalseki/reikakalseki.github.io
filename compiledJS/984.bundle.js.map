{"version":3,"sources":["webpack://sitecore/./se/backgroundgen.ts"],"names":["STARFIELD_SIZE","addImageToRow","elem","img","tile","document","createElement","className","appendChild","addImage","ix","iy","iw","ih","modifyImageLocational","svgimg","createElementNS","setAttributeNS","toString","isTransparent","x","y","Math","cos","sin","random","getRandomFunctionalBlock","i","k","idx","f","image","cargo","index","sides","placeRoom","rows","cols","front","back","points","w","h","edge","abs","n","px","entry","push","putConveyorAt","type","startsWith","tryConnectConveyor","p1","p2","min","max","corner","setPageBackground","body","documentElement","rh","getElementById","scrollHeight","rw","window","innerWidth","clientWidth","ceil","console","log","Array","idxl","idxr","idxu","idxd","idxld","idxrd","makeHalls","wrapInArmor","length","makeConveyors","tag","container","id","prepend","firstChild","removeChild","svg","style","position","imgw","imgh","row","add","flag","div","width","height","buildImage"],"mappings":"sJAAA,MACMA,EAAiB,IAGvB,SAASC,EAAcC,EAAMC,GACzB,IAAIC,EAAOC,SAASC,cAAc,OAGlC,OAFAF,EAAKG,UAAY,WAAaJ,EAC9BD,EAAKM,YAAYJ,GACVA,EAEX,SAASK,EAASP,EAAMC,EAAKO,EAAIC,EAAIC,EAAIC,GACrCV,EAAMW,EAAsBJ,EAAIC,EAAIR,GAIpC,IAAIY,EAASV,SAASW,gBAAgB,6BAA8B,SACpED,EAAOE,eAAe,KAAM,KAAML,EAAGM,YACrCH,EAAOE,eAAe,KAAM,KAAMJ,EAAGK,YACrCH,EAAOE,eAAe,+BAAgC,QAAQ,QAAmBd,EAAK,OACtFY,EAAOE,eAAe,KAAM,KAAMP,EAAGQ,YACrCH,EAAOE,eAAe,KAAM,KAAMN,EAAGO,YACrCH,EAAOE,eAAe,KAAM,KAAQ,MACpCf,EAAKM,YAAYO,GA+CrB,SAASI,EAAchB,GACnB,OAAQA,GACJ,IAAK,MACL,IAAK,UACL,IAAK,SACL,IAAK,SACL,IAAK,gBACL,IAAK,gBACL,IAAK,gBACL,IAAK,gBACL,IAAK,OACL,IAAK,QACD,OAAO,EACX,QACI,OAAO,GAGnB,SAASW,EAAsBM,EAAGC,EAAGlB,GAcjC,MAbW,SAAPA,GACI,OAEAA,EADQmB,KAAKC,IAAQ,IAAJH,GAAiC,IAArBE,KAAKC,IAAQ,IAAJH,GAAwC,IAArBE,KAAKE,IAAQ,IAAJH,GACxD,EAAI,cAAgB,aAE9B,OAEAlB,EADQmB,KAAKC,IAAQ,IAAJH,GAAiC,IAArBE,KAAKC,IAAQ,IAAJH,GAAwC,IAArBE,KAAKE,IAAQ,IAAJH,GACxD,EAAI,cAAgB,iBAGtB,UAAPlB,GAAmBmB,KAAKG,SAAW,MACxCtB,EAAMmB,KAAKG,SAAW,GAAM,WAAa,YAEtCtB,EAEX,SAASuB,EAAyBC,EAAGC,EAAGC,GACpC,IAAIC,EAAoB,IAAhBR,KAAKG,SAmCb,OAjCIK,EAAI,IACI,CAAEC,MAAO,UAAWC,OAAO,EAAOZ,EAAGO,EAAGN,EAAGO,EAAGK,MAAOJ,EAAKK,MAAO,CAAC,IAAK,IAAK,IAAK,MAEpFJ,EAAI,IACD,CAAEC,MAAO,cAAeC,OAAO,EAAMZ,EAAGO,EAAGN,EAAGO,EAAGK,MAAOJ,EAAKK,MAAO,CAAC,IAAK,IAAK,MAElFJ,EAAI,IACD,CAAEC,MAAO,QAASC,OAAO,EAAOZ,EAAGO,EAAGN,EAAGO,EAAGK,MAAOJ,EAAKK,MAAO,CAAC,IAAK,IAAK,IAAK,MAElFJ,EAAI,GACD,CAAEC,MAAO,UAAWC,OAAO,EAAOZ,EAAGO,EAAGN,EAAGO,EAAGK,MAAOJ,EAAKK,MAAO,CAAC,IAAK,IAAK,IAAK,MAEpFJ,EAAI,GACD,CAAEC,MAAO,OAAQC,OAAO,EAAOZ,EAAGO,EAAGN,EAAGO,EAAGK,MAAOJ,EAAKK,MAAO,CAAC,IAAK,IAAK,IAAK,MAEjFJ,EAAI,IACD,CAAEC,MAAO,UAAWC,OAAO,EAAOZ,EAAGO,EAAGN,EAAGO,EAAGK,MAAOJ,EAAKK,MAAO,CAAC,IAAK,IAAK,IAAK,MAEpFJ,EAAI,GACD,CAAEC,MAAO,OAAQC,OAAO,EAAOZ,EAAGO,EAAGN,EAAGO,EAAGK,MAAOJ,EAAKK,MAAO,CAAC,IAAK,IAAK,IAAK,MAEjFJ,EAAI,GACD,CAAEC,MAAO,OAAQC,OAAO,EAAMZ,EAAGO,EAAGN,EAAGO,EAAGK,MAAOJ,EAAKK,MAAO,CAAC,IAAK,MAEtEJ,EAAI,IACD,CAAEC,MAAO,UAAWC,OAAO,EAAMZ,EAAGO,EAAGN,EAAGO,EAAGK,MAAOJ,EAAKK,MAAO,CAAC,MAEpEJ,EAAI,IACD,CAAEC,MAAO,WAAYC,OAAO,EAAMZ,EAAGO,EAAGN,EAAGO,EAAGK,MAAOJ,EAAKK,MAAO,CAAC,IAAK,MAGvE,CAAEH,MAAO,QAASC,OAAO,EAAMZ,EAAGO,EAAGN,EAAGO,EAAGK,MAAOJ,EAAKK,MAAO,CAAC,IAAK,IAAK,IAAK,MAI9F,SAASC,EAAUf,EAAGC,EAAGe,EAAMC,EAAMC,EAAOC,EAAMC,GAG9C,IAFA,IAAIC,GAAI,QAAiB,EAAG,GACxBC,GAAI,QAAiB,EAAG,GACnBd,EAAI,EAAGA,EAAIc,EAAGd,IACnB,IAAK,IAAID,GAAKc,EAAGd,GAAKc,EAAGd,IAAK,CAC1B,IAAIE,GAAM,QAAcQ,EAAMjB,EAAIO,EAAGN,EAAIO,GACrCe,EAAQrB,KAAKsB,IAAIjB,IAAMc,GAAU,GAALb,GAAUA,GAAKc,EAAI,EACnDJ,EAAMT,GAAOc,EAAO,eAAiB,QACrCJ,EAAKV,GAAO,eAGpB,IAAIgB,GAAI,QAAiB,EAAO,EAAJJ,EAAQ,GACpC,IAASd,EAAI,EAAGA,EAAIkB,EAAGlB,IAAK,CACxB,IAAImB,GAAK,QAAiB1B,EAAIqB,EAAGrB,EAAIqB,GAErC,GAAkB,SAAdH,EADAT,GAAM,QAAcQ,EAAMS,EAAIzB,EAAIqB,EAAI,KACC,gBAAdJ,EAAMT,IAAwC,OAAdS,EAAMT,GAAnE,CAEA,IAAIkB,EAAQrB,EAAyBoB,EAAIzB,EAAIqB,EAAI,EAAGb,GACpDS,EAAMT,GAAOkB,EAAMhB,MACD,eAAdO,EAAMT,KACNS,GAAM,QAAcD,EAAMS,EAAIzB,EAAIqB,EAAI,IAAM,eAE9B,WAAdJ,EAAMT,KACNS,GAAM,QAAcD,EAAMS,EAAIzB,EAAIqB,EAAI,IAAM,WAE9B,YAAdJ,EAAMT,KACNS,GAAM,QAAcD,EAAMS,EAAIzB,EAAIqB,EAAI,IAAM,WAC5CJ,GAAM,QAAcD,EAAMS,EAAK,EAAGzB,EAAIqB,EAAI,IAAM,WAChDJ,GAAM,QAAcD,EAAMS,EAAK,EAAGzB,EAAIqB,EAAI,IAAM,YAEhDK,EAAMf,OACNQ,EAAOQ,KAAKD,KAGxB,SAASE,EAAcb,EAAMC,EAAMC,EAAOC,EAAMV,EAAKqB,GAChC,SAAbX,EAAKV,IAAgC,gBAAbU,EAAKV,IAAuC,OAAbU,EAAKV,IAA8B,SAAbU,EAAKV,MACjE,SAAbU,EAAKV,IAAiC,SAAdS,EAAMT,IAAmBS,EAAMT,GAAKsB,WAAW,WACvED,EAAO,SACXZ,EAAMT,GAAqB,SAAbU,EAAKV,GAAmB,QAAUqB,GAGxD,SAASE,EAAmBhB,EAAMC,EAAMC,EAAOC,EAAMc,EAAIC,GAErD,IAAK,IAAI3B,EAAIL,KAAKiC,IAAIF,EAAGjC,EAAGkC,EAAGlC,GAAK,EAAGO,EAAIL,KAAKkC,IAAIH,EAAGjC,EAAGkC,EAAGlC,GAAIO,IAC7DsB,EAAcb,EAAMC,EAAMC,EAAOC,GAAM,QAAcF,EAAMV,EAAG0B,EAAGhC,GAAI,UAEzE,IAASM,EAAIL,KAAKiC,IAAIF,EAAGhC,EAAGiC,EAAGjC,GAAK,EAAGM,EAAIL,KAAKkC,IAAIH,EAAGhC,EAAGiC,EAAGjC,GAAIM,IAC7DsB,EAAcb,EAAMC,EAAMC,EAAOC,GAAM,QAAcF,EAAMiB,EAAGlC,EAAGO,GAAI,UAEzE,IAAI8B,EAGIA,EAFJH,EAAGjC,EAAIgC,EAAGhC,EACNiC,EAAGlC,EAAIiC,EAAGjC,EACD,gBAGA,gBAITkC,EAAGlC,EAAIiC,EAAGjC,EACD,gBAGA,gBAGjB6B,EAAcb,EAAMC,EAAMC,EAAOC,GAAM,QAAcF,EAAMiB,EAAGlC,EAAGiC,EAAGhC,GAAIoC,GAuG7D,SAASC,IACpB,GAAI,IACA,OAOOrD,SAASsD,KACTtD,SAASuD,gBACpB,IAAIC,EAAKxD,SAASyD,eAAe,iBAAiBC,aAC9CC,EAAK1C,KAAKkC,IAAIS,OAAOC,WAAY7D,SAASsD,KAAKQ,aAEnD,IAAI/B,EAAOd,KAAK8C,KAAKP,EATb,IAUJxB,EAAOf,KAAK8C,KAAKJ,EAXb,IAcRK,QAAQC,IAAI,8BAAgCjC,EAAO,gBAAkBD,EAAO,SAC5E,IAAIG,EAAO,IAAIgC,MAAMlC,EAAOD,GACxBE,EAAQ,IAAIiC,MAAMlC,EAAOD,GAC7B,IAAK,IAAIR,EAAI,EAAGA,EAAIQ,EAAMR,IACtB,IAAK,IAAID,EAAI,EAAGA,EAAIU,EAAMV,IAAK,CAC3B,IAAIE,GAAM,QAAcQ,EAAMV,EAAGC,GACjCW,EAAKV,GAAO,MACZS,EAAMT,GAAO,MAGrB,IAAIW,EAAS,GACb,IAASZ,EAAI,EAAGA,EAAW,IAAPQ,EAAaR,IAC7BO,GAAU,QAAiB,EAAGE,EAAO,IAAI,QAAiB,EAAGD,EAAO,GAAIA,EAAMC,EAAMC,EAAOC,EAAMC,IAlEzG,SAAmBJ,EAAMC,EAAMC,EAAOC,GAClC,IAAK,IAAIX,EAAI,EAAGA,EAAIQ,EAAMR,IACtB,IAAK,IAAID,EAAI,EAAGA,EAAIU,EAAMV,IAAK,CAC3B,IAAIE,GAAM,QAAcQ,EAAMV,EAAGC,GACjC,GAAkB,gBAAdU,EAAMT,GAAwB,CAC9B,IAAI2C,GAAO,QAAcnC,EAAMV,EAAI,EAAGC,GAClC6C,GAAO,QAAcpC,EAAMV,EAAI,EAAGC,GAClC8C,GAAO,QAAcrC,EAAMV,EAAGC,EAAI,GAClC+C,GAAO,QAActC,EAAMV,EAAGC,EAAI,GACtC,GAAmB,gBAAfU,EAAMoC,IAA0C,gBAAfpC,EAAMqC,IAA0C,SAAfrC,EAAMkC,IAAkC,SAAdjC,EAAKkC,GAAkB,CACnH,IAAIG,GAAQ,QAAcvC,EAAMV,EAAI,EAAGC,EAAI,GACvCiD,GAAQ,QAAcxC,EAAMV,EAAI,EAAGC,EAAI,GACvB,gBAAhBU,EAAMsC,IAA4C,gBAAhBtC,EAAMuC,KACxCvC,EAAMT,GAAO,YAuDjCiD,CAAU1C,EAAMC,EAAMC,EAAOC,GAhDjC,SAAqBH,EAAMC,EAAMC,EAAOC,GACpC,IAAK,IAAIX,EAAI,EAAGA,EAAIQ,EAAMR,IACtB,IAAK,IAAID,EAAI,EAAGA,EAAIU,EAAMV,IAAK,CAC3B,IAAIE,GAAM,QAAcQ,EAAMV,EAAGC,GACjC,GAAiB,OAAbW,EAAKV,GAAe,CACpB,IAAI2C,GAAO,QAAcnC,EAAMV,EAAI,EAAGC,GAClC6C,GAAO,QAAcpC,EAAMV,EAAI,EAAGC,GAClC8C,GAAO,QAAcrC,EAAMV,EAAGC,EAAI,GAClC+C,GAAO,QAActC,EAAMV,EAAGC,EAAI,GACpB,gBAAdW,EAAKmC,IAAyC,gBAAdnC,EAAKoC,IAAyC,gBAAdpC,EAAKiC,IAAyC,gBAAdjC,EAAKkC,KACrGlC,EAAKV,GAAO,WAuC5BkD,CAAY3C,EAAMC,EAAMC,EAAOC,GAtInC,SAAuBH,EAAMC,EAAMC,EAAOC,EAAMC,GAC5C,IAAK,IAAIZ,EAAI,EAAGA,EAAIQ,EAAMR,IACtB,IAAK,IAAID,EAAI,EAAGA,EAAIU,EAAMV,IAClBL,KAAKG,SAAW,IAEC,gBAAbc,EADAV,GAAM,QAAcQ,EAAMV,EAAGC,KACgB,SAAdU,EAAMT,IAElB,gBAAfS,GADO,QAAcD,EAAMV,EAAGC,EAAI,MAElCW,EAAKV,GAAO,SAQhC,GAAIW,EAAOwC,QAAU,EACjB,IAASrD,EAAI,EAAGA,EAAIL,KAAKkC,IAAI,EAAGhB,EAAOwC,OAAS,GAAIrD,IAGhDyB,EAAmBhB,EAAMC,EAAMC,EAAOC,EAF7BC,GAAO,QAAiB,EAAGA,EAAOwC,OAAS,IAC3CxC,GAAO,QAAiB,EAAGA,EAAOwC,OAAS,KAO5D,IAASpD,EAAI,EAAGA,EAAIQ,EAAMR,IACtB,IAASD,EAAI,EAAGA,EAAIU,EAAMV,IAAK,CAC3B,IAAIE,EAiBiB,eAAdS,EAjBHT,GAAM,QAAcQ,EAAMV,EAAGC,IAkB7BU,GAAM,QAAcD,EAAMV,EAAGC,EAAI,IAAM,cAEpB,eAAdU,EAAMT,KACXS,GAAM,QAAcD,EAAMV,EAAGC,EAAI,IAAM,eAEzB,WAAdU,EAAMT,GACNS,GAAM,QAAcD,EAAMV,EAAGC,EAAI,IAAM,UAEpB,WAAdU,EAAMT,KACXS,GAAM,QAAcD,EAAMV,EAAGC,EAAI,IAAM,WAEzB,YAAdU,EAAMT,KACNS,GAAM,QAAcD,EAAMV,EAAGC,EAAI,IAAM,WACvCU,GAAM,QAAcD,EAAMV,EAAI,EAAGC,EAAI,IAAM,WAC3CU,GAAM,QAAcD,EAAMV,EAAI,EAAGC,IAAM,aA2EnDqD,CAAc7C,EAAMC,EAAMC,EAAOC,EAAMC,GACvC,IAAI0C,EAAM,qBACNC,EAAY9E,SAASyD,eAAeoB,GAOxC,IANiB,MAAbC,IACAA,EAAY9E,SAASC,cAAc,OACnC6E,EAAUC,GAAKF,EACfb,QAAQC,IAAI,iCACZjE,SAASyD,eAAe,iBAAiBuB,QAAQF,IAE9CA,EAAUG,YACbH,EAAUI,YAAYJ,EAAUG,YAGpC,IAAIE,EAAMnF,SAASW,gBAAgB,KAAc,OAM7C,IAUID,EASR,IAxBAyE,EAAIvE,eAAe,KAAM,QAAS+C,EAAG9C,YACrCsE,EAAIvE,eAAe,KAAM,SAAU4C,EAAG3C,YACtCsE,EAAIJ,GAAK,eAEL,QACIrE,EAASV,SAASW,gBAAgB,6BAA8B,UAC7DC,eAAe,KAAM,KAAM,OAClCF,EAAOE,eAAe,KAAM,KAAM,OAClCF,EAAOE,eAAe,+BAAgC,QAAQ,QAAmB,OAAQ,OACzFF,EAAOE,eAAe,KAAM,MAAM,QAAiB,GAAI+C,EAAK,KAAK9C,YACjEH,EAAOE,eAAe,KAAM,MAAM,QAAiB,GAAI+C,EAAK,KAAK9C,YACjEH,EAAOE,eAAe,KAAM,KAAQ,MACpCuE,EAAIhF,YAAYO,IAEhB,QACIA,EAASV,SAASW,gBAAgB,6BAA8B,UAC7DC,eAAe,KAAM,KAAM,OAClCF,EAAOE,eAAe,KAAM,KAAM,OAClCF,EAAOE,eAAe,+BAAgC,QAAQ,QAAmB,SAAU,OAC3FF,EAAOE,eAAe,KAAM,MAAM,QAAiB,GAAI+C,EAAK,KAAK9C,YACjEH,EAAOE,eAAe,KAAM,MAAM,QAAiB,GAAI+C,EAAK,KAAK9C,YACjEH,EAAOE,eAAe,KAAM,KAAQ,MACpCuE,EAAIhF,YAAYO,IAEXY,EAAI,EAAGA,EAAIqC,EAAIrC,GAAK3B,EACzB,IAAS4B,EAAI,EAAGA,EAAIiC,EAAIjC,GAAK5B,EACzBS,EAAS+E,EAAK,YAAa7D,EAAGC,EAAG5B,EAAgBA,GAGzDmF,EAAU3E,YAAYgF,GACtB,IAAItF,EAAOG,SAASC,cAAc,OAClCJ,EAAKuF,MAAMC,SAAW,WACtBxF,EAAKkF,GAAK,cACVlF,EAAKK,UAAY,aACjB4E,EAAU3E,YAAYN,GA/W1B,SAAoBA,EAAMkC,EAAMC,EAAMC,EAAOC,EAAMoD,EAAMC,GAKrD,IAJA,IAIShE,EAAI,EAAGA,EAAIQ,EAAMR,IAAK,CAE3B,IAAIiE,EAAMxF,SAASC,cAAc,OACjC,IAAK,IAAIqB,EAAI,EAAGA,EAAIU,EAAMV,IAAK,CAC3B,IAAIE,GAAM,QAAcQ,EAAMV,EAAGC,GAC7BzB,EAAMmC,EAAMT,GAChB,IAAIiE,EAAMD,EACNE,GAAO,EAoBX,GAnBI5E,EAAchB,IAAqB,OAAboC,EAAKV,KAE3BiE,EAAM7F,EAAc6F,EADThF,EAAsBa,EAAGC,EAAGW,EAAKV,KAE5CkE,GAAO,GAEA,OAAP5F,IAEiB,OAAboC,EAAKV,KACLiE,EAAM7F,EAAc6F,EAAK,UAElB,SAAP3F,IAEA2F,EAAM7F,EAAc6F,EADpB3F,EAAMW,EAAsBa,EAAGC,EAAGzB,KAGtC4F,GAAO,IAEP,UAGAD,GAAOD,EAAK,CACZ,IAAIG,EAAM3F,SAASC,cAAc,OACjC0F,EAAIP,MAAMQ,MAjCd,IAiCwB/E,WAAa,KACjC8E,EAAIP,MAAMS,OAjCd,IAiCyBhF,WAAa,KAClC4E,EAAItF,YAAYwF,IAIxB9F,EAAKM,YAAYqF,IAGrB,QAAO3F,EAnEG,GA0YViG,CAAWjG,EAAMkC,EAAMC,EAAMC,EAAOC","file":"984.bundle.js","sourcesContent":["const SCALE = 1;\r\nconst STARFIELD_SIZE = 2000;\r\nimport { xmas, hallow, viskey, visval, xkey, ykey, hkey, wkey, getRandomBetween, getOrCreateImgPath, getArrayIndex, fitBCG, svgNamespace, isDarkModeEnabled } from '../library';\r\nimport { isPhone } from '../browser';\r\nfunction addImageToRow(elem, img) {\r\n    let tile = document.createElement('div');\r\n    tile.className = \"tile-se-\" + img;\r\n    elem.appendChild(tile);\r\n    return tile;\r\n}\r\nfunction addImage(elem, img, ix, iy, iw, ih) {\r\n    img = modifyImageLocational(ix, iy, img);\r\n    //var pre = '<image x=\"'+ix+'\" y=\"'+iy+'\" width=\"'+iw+'\" height=\"'+ih+'\" xlink:href=\"'+getImageRoot();\r\n    //var post = '.png\" />';\r\n    //return pre+img+post;\r\n    var svgimg = document.createElementNS('http://www.w3.org/2000/svg', 'image');\r\n    svgimg.setAttributeNS(null, wkey, iw.toString());\r\n    svgimg.setAttributeNS(null, hkey, ih.toString());\r\n    svgimg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', getOrCreateImgPath(img, \"se\"));\r\n    svgimg.setAttributeNS(null, xkey, ix.toString());\r\n    svgimg.setAttributeNS(null, ykey, iy.toString());\r\n    svgimg.setAttributeNS(null, viskey, visval);\r\n    elem.appendChild(svgimg);\r\n}\r\nfunction buildImage(elem, rows, cols, front, back, imgw, imgh) {\r\n    var w = 64 * SCALE;\r\n    var h = 64 * SCALE;\r\n    var x = 0;\r\n    var y = 0;\r\n    for (var k = 0; k < rows; k++) {\r\n        x = 0;\r\n        let row = document.createElement(\"div\");\r\n        for (var i = 0; i < cols; i++) {\r\n            var idx = getArrayIndex(cols, i, k);\r\n            var img = front[idx];\r\n            let add = row;\r\n            let flag = false;\r\n            if (isTransparent(img) && back[idx] != \"sky\") {\r\n                var bimg = modifyImageLocational(i, k, back[idx]);\r\n                add = addImageToRow(add, bimg);\r\n                flag = true;\r\n            }\r\n            if (img != \"air\") {\r\n                //console.log(\"Got \"+img+\" @ \"+i+\", \"+k);\r\n                if (back[idx] != \"sky\") {\r\n                    add = addImageToRow(add, \"inner\");\r\n                }\r\n                if (img != \"inner\") {\r\n                    img = modifyImageLocational(i, k, img);\r\n                    add = addImageToRow(add, img);\r\n                }\r\n                flag = true;\r\n            }\r\n            if (isDarkModeEnabled() && flag) {\r\n                //add = addImageToRow(add, \"dark\");\r\n            }\r\n            if (add == row) {\r\n                let div = document.createElement('div');\r\n                div.style.width = w.toString() + \"px\";\r\n                div.style.height = h.toString() + \"px\";\r\n                add.appendChild(div);\r\n            }\r\n            x += w;\r\n        }\r\n        elem.appendChild(row);\r\n        y += h;\r\n    }\r\n    fitBCG(elem, SCALE);\r\n}\r\nfunction isTransparent(img) {\r\n    switch (img) {\r\n        case \"air\":\r\n        case \"gravgen\":\r\n        case \"conv_v\":\r\n        case \"conv_h\":\r\n        case \"convcorner-dl\":\r\n        case \"convcorner-ul\":\r\n        case \"convcorner-dr\":\r\n        case \"convcorner-ur\":\r\n        case \"prog\":\r\n        case \"inner\":\r\n            return true;\r\n        default:\r\n            return false;\r\n    }\r\n}\r\nfunction modifyImageLocational(x, y, img) {\r\n    if (img == \"armor\") {\r\n        if (xmas) {\r\n            var v = Math.cos(x * 0.25) + Math.cos(x * 0.75) * 0.43 - Math.sin(y * 0.47) * 0.72;\r\n            img = v > 0 ? \"armor_green\" : \"armor_red\";\r\n        }\r\n        if (hallow) {\r\n            var v = Math.cos(x * 0.25) + Math.cos(x * 0.75) * 0.43 - Math.sin(y * 0.47) * 0.72;\r\n            img = v > 0 ? \"armor_black\" : \"armor_orange\";\r\n        }\r\n    }\r\n    else if (img == \"conv_h\" && Math.random() < 0.05) {\r\n        img = Math.random() < 0.5 ? \"sorter-l\" : \"sorter-r\";\r\n    }\r\n    return img;\r\n}\r\nfunction getRandomFunctionalBlock(i, k, idx) {\r\n    var f = Math.random() * 1.5;\r\n    var entry = null;\r\n    if (f < 0.05) {\r\n        entry = { image: \"gravgen\", cargo: false, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    else if (f < 0.15) {\r\n        entry = { image: \"assembler_b\", cargo: true, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"d\"] };\r\n    }\r\n    else if (f < 0.25) {\r\n        entry = { image: \"timer\", cargo: false, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    else if (f < 0.4) {\r\n        entry = { image: \"battery\", cargo: false, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    else if (f < 0.5) {\r\n        entry = { image: \"prog\", cargo: false, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    else if (f < 0.75) {\r\n        entry = { image: \"catwalk\", cargo: false, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    else if (f < 0.8) {\r\n        entry = { image: \"door\", cargo: false, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    else if (f < 0.9) {\r\n        entry = { image: \"cent\", cargo: true, x: i, y: k, index: idx, sides: [\"u\", \"d\"] };\r\n    }\r\n    else if (f < 1.1) {\r\n        entry = { image: \"blast_b\", cargo: true, x: i, y: k, index: idx, sides: [\"d\"] };\r\n    }\r\n    else if (f < 1.3) {\r\n        entry = { image: \"stone_br\", cargo: true, x: i, y: k, index: idx, sides: [\"d\", \"r\"] };\r\n    }\r\n    else {\r\n        entry = { image: \"cargo\", cargo: true, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    return entry;\r\n}\r\nfunction placeRoom(x, y, rows, cols, front, back, points) {\r\n    var w = getRandomBetween(2, 4);\r\n    var h = getRandomBetween(4, 5);\r\n    for (var k = 0; k < h; k++) {\r\n        for (var i = -w; i <= w; i++) {\r\n            var idx = getArrayIndex(cols, x + i, y + k);\r\n            var edge = (Math.abs(i) == w || k == 0 || k == h - 1); // && (k != h-2 || back[idx] != \"interiorwall\");\r\n            front[idx] = edge ? \"interiorwall\" : \"inner\";\r\n            back[idx] = \"interiorwall\";\r\n        }\r\n    }\r\n    var n = getRandomBetween(2, w * 2 - 1);\r\n    for (var i = 0; i < n; i++) {\r\n        var px = getRandomBetween(x - w, x + w);\r\n        var idx = getArrayIndex(cols, px, y + h - 2);\r\n        if (front[idx] != \"inner\" && front[idx] != \"interiorwall\" && front[idx] != \"air\")\r\n            continue;\r\n        var entry = getRandomFunctionalBlock(px, y + h - 2, idx);\r\n        front[idx] = entry.image;\r\n        if (front[idx] == \"assembler_b\") {\r\n            front[getArrayIndex(cols, px, y + h - 3)] = \"assembler_t\";\r\n        }\r\n        if (front[idx] == \"blast_b\") {\r\n            front[getArrayIndex(cols, px, y + h - 3)] = \"blast_t\";\r\n        }\r\n        if (front[idx] == \"stone_br\") {\r\n            front[getArrayIndex(cols, px, y + h - 3)] = \"stone_tr\";\r\n            front[getArrayIndex(cols, px - 1, y + h - 3)] = \"stone_tl\";\r\n            front[getArrayIndex(cols, px - 1, y + h - 2)] = \"stone_bl\";\r\n        }\r\n        if (entry.cargo)\r\n            points.push(entry);\r\n    }\r\n}\r\nfunction putConveyorAt(rows, cols, front, back, idx, type) {\r\n    if (back[idx] == \"armor\" || back[idx] == \"interiorwall\" || back[idx] == \"sky\" || back[idx] == \"cargo\") {\r\n        if (back[idx] == \"cargo\" || front[idx] == \"cargo\" || front[idx].startsWith(\"conv\"))\r\n            type = \"cargo\";\r\n        front[idx] = (back[idx] == \"armor\") ? \"cargo\" : type;\r\n    }\r\n}\r\nfunction tryConnectConveyor(rows, cols, front, back, p1, p2) {\r\n    //console.log(\"Connecting \"+p1.x+\",\"+p1.y+\" -> \"+p2.x+\",\"+p2.y);\r\n    for (var i = Math.min(p1.x, p2.x) + 1; i < Math.max(p1.x, p2.x); i++) {\r\n        putConveyorAt(rows, cols, front, back, getArrayIndex(cols, i, p1.y), \"conv_h\");\r\n    }\r\n    for (var i = Math.min(p1.y, p2.y) + 1; i < Math.max(p1.y, p2.y); i++) {\r\n        putConveyorAt(rows, cols, front, back, getArrayIndex(cols, p2.x, i), \"conv_v\");\r\n    }\r\n    var corner = \"convcorner\";\r\n    if (p2.y < p1.y) {\r\n        if (p2.x < p1.x) {\r\n            corner = \"convcorner-ur\";\r\n        }\r\n        else {\r\n            corner = \"convcorner-ul\";\r\n        }\r\n    }\r\n    else {\r\n        if (p2.x < p1.x) {\r\n            corner = \"convcorner-dr\";\r\n        }\r\n        else {\r\n            corner = \"convcorner-dl\";\r\n        }\r\n    }\r\n    putConveyorAt(rows, cols, front, back, getArrayIndex(cols, p2.x, p1.y), corner);\r\n}\r\nfunction makeConveyors(rows, cols, front, back, points) {\r\n    for (var k = 0; k < rows; k++) {\r\n        for (var i = 0; i < cols; i++) {\r\n            if (Math.random() < 0.2) {\r\n                var idx = getArrayIndex(cols, i, k);\r\n                if (back[idx] == \"interiorwall\" && front[idx] == \"inner\") {\r\n                    var idxd = getArrayIndex(cols, i, k + 1);\r\n                    if (front[idxd] == \"interiorwall\") {\r\n                        back[idx] = \"cargo\";\r\n                        //var entry = {x:i, y:k, index:getArrayIndex(cols, i, k), sides:[\"l\", \"r\", \"u\", \"d\"]};\r\n                        //points.push(entry);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    if (points.length >= 2) {\r\n        for (var i = 0; i < Math.max(1, points.length / 3); i++) {\r\n            var p1 = points[getRandomBetween(0, points.length - 1)];\r\n            var p2 = points[getRandomBetween(0, points.length - 1)];\r\n            tryConnectConveyor(rows, cols, front, back, p1, p2);\r\n        }\r\n    }\r\n    //for (var i = 0; k < points.length; i++) {\r\n    //\tvar entry = points[i];\r\n    //}\r\n    for (var k = 0; k < rows; k++) {\r\n        for (var i = 0; i < cols; i++) {\r\n            var idx = getArrayIndex(cols, i, k);\r\n            /*\r\n                    if (front[idx] == \"conv_h\" || front[idx] == \"conv_v\" || front[idx].startsWith(\"convcorner\")) {\r\n                        var c = 0;\r\n                        if (front[getArrayIndex(cols, i+1, k)] == \"conv_h\" || front[getArrayIndex(cols, i+1, k)] == \"assembler_b\")\r\n                            c++;\r\n                        if (front[getArrayIndex(cols, i-1, k)] == \"conv_h\" || front[getArrayIndex(cols, i-1, k)] == \"assembler_b\")\r\n                            c++;\r\n                        if (front[getArrayIndex(cols, i, k-1)] == \"conv_v\" || front[getArrayIndex(cols, i, k-1)] == \"assembler_b\")\r\n                            c++;\r\n                        if (front[getArrayIndex(cols, i, k+1)] == \"conv_v\" || front[getArrayIndex(cols, i, k+1)] == \"assembler_t\")\r\n                            c++;\r\n                        if (c >= 3) {\r\n                            front[idx] = \"cargo\";\r\n                        }\r\n                    }\r\n                    else\r\n            */ if (front[idx] == \"assembler_b\") {\r\n                front[getArrayIndex(cols, i, k - 1)] = \"assembler_t\";\r\n            }\r\n            else if (front[idx] == \"assembler_t\") {\r\n                front[getArrayIndex(cols, i, k + 1)] = \"assembler_b\";\r\n            }\r\n            if (front[idx] == \"blast_b\") {\r\n                front[getArrayIndex(cols, i, k - 1)] = \"blast_t\";\r\n            }\r\n            else if (front[idx] == \"blast_t\") {\r\n                front[getArrayIndex(cols, i, k + 1)] = \"blast_b\";\r\n            }\r\n            if (front[idx] == \"stone_br\") {\r\n                front[getArrayIndex(cols, i, k - 1)] = \"stone_tr\";\r\n                front[getArrayIndex(cols, i - 1, k - 1)] = \"stone_tl\";\r\n                front[getArrayIndex(cols, i - 1, k)] = \"stone_bl\";\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction makeHalls(rows, cols, front, back) {\r\n    for (var k = 0; k < rows; k++) {\r\n        for (var i = 0; i < cols; i++) {\r\n            var idx = getArrayIndex(cols, i, k);\r\n            if (front[idx] == \"interiorwall\") {\r\n                var idxl = getArrayIndex(cols, i - 1, k);\r\n                var idxr = getArrayIndex(cols, i + 1, k);\r\n                var idxu = getArrayIndex(cols, i, k - 1);\r\n                var idxd = getArrayIndex(cols, i, k + 1);\r\n                if (front[idxu] == \"interiorwall\" && front[idxd] == \"interiorwall\" && front[idxl] == \"inner\" && back[idxr] == \"inner\") {\r\n                    var idxld = getArrayIndex(cols, i - 1, k + 1);\r\n                    var idxrd = getArrayIndex(cols, i + 1, k + 1);\r\n                    if (front[idxld] == \"interiorwall\" && front[idxrd] == \"interiorwall\") {\r\n                        front[idx] = \"inner\";\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction wrapInArmor(rows, cols, front, back) {\r\n    for (var k = 0; k < rows; k++) {\r\n        for (var i = 0; i < cols; i++) {\r\n            var idx = getArrayIndex(cols, i, k);\r\n            if (back[idx] == \"sky\") {\r\n                var idxl = getArrayIndex(cols, i - 1, k);\r\n                var idxr = getArrayIndex(cols, i + 1, k);\r\n                var idxu = getArrayIndex(cols, i, k - 1);\r\n                var idxd = getArrayIndex(cols, i, k + 1);\r\n                if (back[idxu] == \"interiorwall\" || back[idxd] == \"interiorwall\" || back[idxl] == \"interiorwall\" || back[idxr] == \"interiorwall\") {\r\n                    back[idx] = \"armor\";\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nexport default function setPageBackground() {\r\n    if (isPhone)\r\n        return;\r\n    let tail = '</svg>';\r\n    let w = 64 * SCALE;\r\n    let h = 64 * SCALE;\r\n    let x = 0;\r\n    let y = 0;\r\n    //var height = findHighestNode(0, document.documentElement.childNodes);\r\n    let body = document.body;\r\n    let html = document.documentElement;\r\n    var rh = document.getElementById(\"main-scroller\").scrollHeight; //document.body.offsetHeight;//Math.max(body.offsetHeight, html.clientHeight, html.offsetHeight, window.innerHeight, document.body.clientHeight);\r\n    var rw = Math.max(window.innerWidth, document.body.clientWidth);\r\n    //console.log(rw+\" x \"+rh);\r\n    let rows = Math.ceil(rh / h);\r\n    let cols = Math.ceil(rw / w);\r\n    let tw = cols * w;\r\n    let th = rows * h;\r\n    console.log(\"Generating SE tileset with \" + cols + \" columns and \" + rows + \" rows\");\r\n    let back = new Array(cols * rows);\r\n    let front = new Array(cols * rows);\r\n    for (var k = 0; k < rows; k++) {\r\n        for (var i = 0; i < cols; i++) {\r\n            var idx = getArrayIndex(cols, i, k);\r\n            back[idx] = \"sky\";\r\n            front[idx] = \"air\";\r\n        }\r\n    }\r\n    let points = [];\r\n    for (var k = 0; k < rows * 0.75; k++) {\r\n        placeRoom(getRandomBetween(4, cols - 4), getRandomBetween(2, rows - 2), rows, cols, front, back, points);\r\n    }\r\n    makeHalls(rows, cols, front, back);\r\n    wrapInArmor(rows, cols, front, back);\r\n    makeConveyors(rows, cols, front, back, points);\r\n    let tag = \"background-content\";\r\n    let container = document.getElementById(tag);\r\n    if (container == null) {\r\n        container = document.createElement(\"div\");\r\n        container.id = tag;\r\n        console.log(\"Injecting background element.\");\r\n        document.getElementById(\"main-scroller\").prepend(container);\r\n    }\r\n    while (container.firstChild) {\r\n        container.removeChild(container.firstChild);\r\n    }\r\n    //console.log(elem);\t\r\n    let svg = document.createElementNS(svgNamespace, \"svg\");\r\n    svg.setAttributeNS(null, \"width\", rw.toString());\r\n    svg.setAttributeNS(null, \"height\", rh.toString());\r\n    svg.id = \"skybox-layer\";\r\n    //svg.style.position = \"absolute\";\r\n    if (xmas) {\r\n        var svgimg = document.createElementNS('http://www.w3.org/2000/svg', 'image');\r\n        svgimg.setAttributeNS(null, wkey, \"320\");\r\n        svgimg.setAttributeNS(null, hkey, \"320\");\r\n        svgimg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', getOrCreateImgPath(\"xmas\", \"se\"));\r\n        svgimg.setAttributeNS(null, xkey, getRandomBetween(32, rw - 350).toString());\r\n        svgimg.setAttributeNS(null, ykey, getRandomBetween(32, rw - 350).toString());\r\n        svgimg.setAttributeNS(null, viskey, visval);\r\n        svg.appendChild(svgimg);\r\n    }\r\n    if (hallow) {\r\n        var svgimg = document.createElementNS('http://www.w3.org/2000/svg', 'image');\r\n        svgimg.setAttributeNS(null, wkey, \"320\");\r\n        svgimg.setAttributeNS(null, hkey, \"320\");\r\n        svgimg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', getOrCreateImgPath(\"hallow\", \"se\"));\r\n        svgimg.setAttributeNS(null, xkey, getRandomBetween(32, rw - 350).toString());\r\n        svgimg.setAttributeNS(null, ykey, getRandomBetween(32, rw - 350).toString());\r\n        svgimg.setAttributeNS(null, viskey, visval);\r\n        svg.appendChild(svgimg);\r\n    }\r\n    for (var i = 0; i < rw; i += STARFIELD_SIZE) {\r\n        for (var k = 0; k < rh; k += STARFIELD_SIZE) {\r\n            addImage(svg, \"starfield\", i, k, STARFIELD_SIZE, STARFIELD_SIZE);\r\n        }\r\n    }\r\n    container.appendChild(svg);\r\n    let elem = document.createElement(\"div\");\r\n    elem.style.position = \"absolute\";\r\n    elem.id = \"block-layer\";\r\n    elem.className = \"tile-layer\";\r\n    container.appendChild(elem);\r\n    //container.style.width = rw.toString()+\"px\";\r\n    //container.style.height = rh.toString()+\"px\";\r\n    buildImage(elem, rows, cols, front, back, rw, rh);\r\n}\r\n//window.addEventListener('resize', debounce(setPageBackground, 100));\r\n"],"sourceRoot":""}