{"version":3,"sources":["webpack://sitecore/./node_modules/ts-debounce/dist/src/index.esm.js","webpack://sitecore/./se/backgroundgen.ts"],"names":["r","e","n","i","t","o","a","isImmediate","u","callback","c","maxWait","v","Date","now","l","f","d","slice","call","arguments","this","Promise","clearTimeout","setTimeout","apply","forEach","resolve","push","reject","cancel","STARFIELD_SIZE","addImageToRow","elem","img","tile","document","createElement","className","appendChild","addImage","ix","iy","iw","ih","modifyImageLocational","svgimg","createElementNS","setAttributeNS","toString","isTransparent","x","y","Math","cos","sin","random","getRandomFunctionalBlock","k","idx","image","cargo","index","sides","placeRoom","rows","cols","front","back","points","w","h","edge","abs","px","entry","putConveyorAt","type","startsWith","tryConnectConveyor","p1","p2","min","max","corner","setPageBackground","body","html","documentElement","rh","offsetHeight","clientHeight","window","innerHeight","rw","innerWidth","clientWidth","ceil","console","log","Array","idxl","idxr","idxu","idxd","idxld","idxrd","makeHalls","wrapInArmor","length","makeConveyors","tag","container","getElementById","id","prepend","firstChild","removeChild","svg","style","position","width","height","imgw","imgh","row","add","flag","div","buildImage","addEventListener"],"mappings":"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","file":"984.bundle.js","sourcesContent":["function r(r,e,n){var i,t,o;void 0===e&&(e=50),void 0===n&&(n={});var a=null!=(i=n.isImmediate)&&i,u=null!=(t=n.callback)&&t,c=n.maxWait,v=Date.now(),l=[];function f(){if(void 0!==c){var r=Date.now()-v;if(r+e>=c)return c-r}return e}var d=function(){var e=[].slice.call(arguments),n=this;return new Promise(function(i,t){var c=a&&void 0===o;if(void 0!==o&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,v=Date.now(),!a){var i=r.apply(n,e);u&&u(i),l.forEach(function(r){return(0,r.resolve)(i)}),l=[]}},f()),c){var d=r.apply(n,e);return u&&u(d),i(d)}l.push({resolve:i,reject:t})})};return d.cancel=function(r){void 0!==o&&clearTimeout(o),l.forEach(function(e){return(0,e.reject)(r)}),l=[]},d}export{r as debounce};\n//# sourceMappingURL=index.esm.js.map\n","const SCALE = 1;\r\nconst STARFIELD_SIZE = 2000;\r\nimport { debounce } from \"ts-debounce\";\r\nimport { xmas, hallow, viskey, visval, xkey, ykey, hkey, wkey, getRandomBetween, getOrCreateImgPath, getArrayIndex, fitBCG, svgNamespace, isDarkModeEnabled } from '../library';\r\nimport { isPhone } from '../browser';\r\nfunction addImageToRow(elem, img) {\r\n    let tile = document.createElement('div');\r\n    tile.className = \"tile-se-\" + img;\r\n    elem.appendChild(tile);\r\n    return tile;\r\n}\r\nfunction addImage(elem, img, ix, iy, iw, ih) {\r\n    img = modifyImageLocational(ix, iy, img);\r\n    //var pre = '<image x=\"'+ix+'\" y=\"'+iy+'\" width=\"'+iw+'\" height=\"'+ih+'\" xlink:href=\"'+getImageRoot();\r\n    //var post = '.png\" />';\r\n    //return pre+img+post;\r\n    var svgimg = document.createElementNS('http://www.w3.org/2000/svg', 'image');\r\n    svgimg.setAttributeNS(null, wkey, iw.toString());\r\n    svgimg.setAttributeNS(null, hkey, ih.toString());\r\n    svgimg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', getOrCreateImgPath(img, \"se\"));\r\n    svgimg.setAttributeNS(null, xkey, ix.toString());\r\n    svgimg.setAttributeNS(null, ykey, iy.toString());\r\n    svgimg.setAttributeNS(null, viskey, visval);\r\n    elem.appendChild(svgimg);\r\n}\r\nfunction buildImage(elem, rows, cols, front, back, imgw, imgh) {\r\n    var w = 64 * SCALE;\r\n    var h = 64 * SCALE;\r\n    var x = 0;\r\n    var y = 0;\r\n    for (var k = 0; k < rows; k++) {\r\n        x = 0;\r\n        let row = document.createElement(\"div\");\r\n        for (var i = 0; i < cols; i++) {\r\n            var idx = getArrayIndex(cols, i, k);\r\n            var img = front[idx];\r\n            let add = row;\r\n            let flag = false;\r\n            if (isTransparent(img) && back[idx] != \"sky\") {\r\n                var bimg = modifyImageLocational(i, k, back[idx]);\r\n                add = addImageToRow(add, bimg);\r\n                flag = true;\r\n            }\r\n            if (img != \"air\") {\r\n                //console.log(\"Got \"+img+\" @ \"+i+\", \"+k);\r\n                if (back[idx] != \"sky\") {\r\n                    add = addImageToRow(add, \"inner\");\r\n                }\r\n                if (img != \"inner\") {\r\n                    img = modifyImageLocational(i, k, img);\r\n                    add = addImageToRow(add, img);\r\n                }\r\n                flag = true;\r\n            }\r\n            if (isDarkModeEnabled() && flag) {\r\n                //add = addImageToRow(add, \"dark\");\r\n            }\r\n            if (add == row) {\r\n                let div = document.createElement('div');\r\n                div.style.width = w.toString() + \"px\";\r\n                div.style.height = h.toString() + \"px\";\r\n                add.appendChild(div);\r\n            }\r\n            x += w;\r\n        }\r\n        elem.appendChild(row);\r\n        y += h;\r\n    }\r\n    fitBCG(elem, SCALE);\r\n}\r\nfunction isTransparent(img) {\r\n    switch (img) {\r\n        case \"air\":\r\n        case \"gravgen\":\r\n        case \"conv_v\":\r\n        case \"conv_h\":\r\n        case \"convcorner-dl\":\r\n        case \"convcorner-ul\":\r\n        case \"convcorner-dr\":\r\n        case \"convcorner-ur\":\r\n        case \"prog\":\r\n        case \"inner\":\r\n            return true;\r\n        default:\r\n            return false;\r\n    }\r\n}\r\nfunction modifyImageLocational(x, y, img) {\r\n    if (img == \"armor\") {\r\n        if (xmas) {\r\n            var v = Math.cos(x * 0.25) + Math.cos(x * 0.75) * 0.43 - Math.sin(y * 0.47) * 0.72;\r\n            img = v > 0 ? \"armor_green\" : \"armor_red\";\r\n        }\r\n        if (hallow) {\r\n            var v = Math.cos(x * 0.25) + Math.cos(x * 0.75) * 0.43 - Math.sin(y * 0.47) * 0.72;\r\n            img = v > 0 ? \"armor_black\" : \"armor_orange\";\r\n        }\r\n    }\r\n    else if (img == \"conv_h\" && Math.random() < 0.05) {\r\n        img = Math.random() < 0.5 ? \"sorter-l\" : \"sorter-r\";\r\n    }\r\n    return img;\r\n}\r\nfunction getRandomFunctionalBlock(i, k, idx) {\r\n    var f = Math.random() * 1.5;\r\n    var entry = null;\r\n    if (f < 0.05) {\r\n        entry = { image: \"gravgen\", cargo: false, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    else if (f < 0.15) {\r\n        entry = { image: \"assembler_b\", cargo: true, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"d\"] };\r\n    }\r\n    else if (f < 0.25) {\r\n        entry = { image: \"timer\", cargo: false, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    else if (f < 0.4) {\r\n        entry = { image: \"battery\", cargo: false, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    else if (f < 0.5) {\r\n        entry = { image: \"prog\", cargo: false, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    else if (f < 0.75) {\r\n        entry = { image: \"catwalk\", cargo: false, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    else if (f < 0.8) {\r\n        entry = { image: \"door\", cargo: false, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    else if (f < 0.9) {\r\n        entry = { image: \"cent\", cargo: true, x: i, y: k, index: idx, sides: [\"u\", \"d\"] };\r\n    }\r\n    else if (f < 1.1) {\r\n        entry = { image: \"blast_b\", cargo: true, x: i, y: k, index: idx, sides: [\"d\"] };\r\n    }\r\n    else if (f < 1.3) {\r\n        entry = { image: \"stone_br\", cargo: true, x: i, y: k, index: idx, sides: [\"d\", \"r\"] };\r\n    }\r\n    else {\r\n        entry = { image: \"cargo\", cargo: true, x: i, y: k, index: idx, sides: [\"l\", \"r\", \"u\", \"d\"] };\r\n    }\r\n    return entry;\r\n}\r\nfunction placeRoom(x, y, rows, cols, front, back, points) {\r\n    var w = getRandomBetween(2, 4);\r\n    var h = getRandomBetween(4, 5);\r\n    for (var k = 0; k < h; k++) {\r\n        for (var i = -w; i <= w; i++) {\r\n            var idx = getArrayIndex(cols, x + i, y + k);\r\n            var edge = (Math.abs(i) == w || k == 0 || k == h - 1); // && (k != h-2 || back[idx] != \"interiorwall\");\r\n            front[idx] = edge ? \"interiorwall\" : \"inner\";\r\n            back[idx] = \"interiorwall\";\r\n        }\r\n    }\r\n    var n = getRandomBetween(2, w * 2 - 1);\r\n    for (var i = 0; i < n; i++) {\r\n        var px = getRandomBetween(x - w, x + w);\r\n        var idx = getArrayIndex(cols, px, y + h - 2);\r\n        if (front[idx] != \"inner\" && front[idx] != \"interiorwall\" && front[idx] != \"air\")\r\n            continue;\r\n        var entry = getRandomFunctionalBlock(px, y + h - 2, idx);\r\n        front[idx] = entry.image;\r\n        if (front[idx] == \"assembler_b\") {\r\n            front[getArrayIndex(cols, px, y + h - 3)] = \"assembler_t\";\r\n        }\r\n        if (front[idx] == \"blast_b\") {\r\n            front[getArrayIndex(cols, px, y + h - 3)] = \"blast_t\";\r\n        }\r\n        if (front[idx] == \"stone_br\") {\r\n            front[getArrayIndex(cols, px, y + h - 3)] = \"stone_tr\";\r\n            front[getArrayIndex(cols, px - 1, y + h - 3)] = \"stone_tl\";\r\n            front[getArrayIndex(cols, px - 1, y + h - 2)] = \"stone_bl\";\r\n        }\r\n        if (entry.cargo)\r\n            points.push(entry);\r\n    }\r\n}\r\nfunction putConveyorAt(rows, cols, front, back, idx, type) {\r\n    if (back[idx] == \"armor\" || back[idx] == \"interiorwall\" || back[idx] == \"sky\" || back[idx] == \"cargo\") {\r\n        if (back[idx] == \"cargo\" || front[idx] == \"cargo\" || front[idx].startsWith(\"conv\"))\r\n            type = \"cargo\";\r\n        front[idx] = (back[idx] == \"armor\") ? \"cargo\" : type;\r\n    }\r\n}\r\nfunction tryConnectConveyor(rows, cols, front, back, p1, p2) {\r\n    //console.log(\"Connecting \"+p1.x+\",\"+p1.y+\" -> \"+p2.x+\",\"+p2.y);\r\n    for (var i = Math.min(p1.x, p2.x) + 1; i < Math.max(p1.x, p2.x); i++) {\r\n        putConveyorAt(rows, cols, front, back, getArrayIndex(cols, i, p1.y), \"conv_h\");\r\n    }\r\n    for (var i = Math.min(p1.y, p2.y) + 1; i < Math.max(p1.y, p2.y); i++) {\r\n        putConveyorAt(rows, cols, front, back, getArrayIndex(cols, p2.x, i), \"conv_v\");\r\n    }\r\n    var corner = \"convcorner\";\r\n    if (p2.y < p1.y) {\r\n        if (p2.x < p1.x) {\r\n            corner = \"convcorner-ur\";\r\n        }\r\n        else {\r\n            corner = \"convcorner-ul\";\r\n        }\r\n    }\r\n    else {\r\n        if (p2.x < p1.x) {\r\n            corner = \"convcorner-dr\";\r\n        }\r\n        else {\r\n            corner = \"convcorner-dl\";\r\n        }\r\n    }\r\n    putConveyorAt(rows, cols, front, back, getArrayIndex(cols, p2.x, p1.y), corner);\r\n}\r\nfunction makeConveyors(rows, cols, front, back, points) {\r\n    for (var k = 0; k < rows; k++) {\r\n        for (var i = 0; i < cols; i++) {\r\n            if (Math.random() < 0.2) {\r\n                var idx = getArrayIndex(cols, i, k);\r\n                if (back[idx] == \"interiorwall\" && front[idx] == \"inner\") {\r\n                    var idxd = getArrayIndex(cols, i, k + 1);\r\n                    if (front[idxd] == \"interiorwall\") {\r\n                        back[idx] = \"cargo\";\r\n                        //var entry = {x:i, y:k, index:getArrayIndex(cols, i, k), sides:[\"l\", \"r\", \"u\", \"d\"]};\r\n                        //points.push(entry);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    if (points.length >= 2) {\r\n        for (var i = 0; i < Math.max(1, points.length / 3); i++) {\r\n            var p1 = points[getRandomBetween(0, points.length - 1)];\r\n            var p2 = points[getRandomBetween(0, points.length - 1)];\r\n            tryConnectConveyor(rows, cols, front, back, p1, p2);\r\n        }\r\n    }\r\n    //for (var i = 0; k < points.length; i++) {\r\n    //\tvar entry = points[i];\r\n    //}\r\n    for (var k = 0; k < rows; k++) {\r\n        for (var i = 0; i < cols; i++) {\r\n            var idx = getArrayIndex(cols, i, k);\r\n            /*\r\n                    if (front[idx] == \"conv_h\" || front[idx] == \"conv_v\" || front[idx].startsWith(\"convcorner\")) {\r\n                        var c = 0;\r\n                        if (front[getArrayIndex(cols, i+1, k)] == \"conv_h\" || front[getArrayIndex(cols, i+1, k)] == \"assembler_b\")\r\n                            c++;\r\n                        if (front[getArrayIndex(cols, i-1, k)] == \"conv_h\" || front[getArrayIndex(cols, i-1, k)] == \"assembler_b\")\r\n                            c++;\r\n                        if (front[getArrayIndex(cols, i, k-1)] == \"conv_v\" || front[getArrayIndex(cols, i, k-1)] == \"assembler_b\")\r\n                            c++;\r\n                        if (front[getArrayIndex(cols, i, k+1)] == \"conv_v\" || front[getArrayIndex(cols, i, k+1)] == \"assembler_t\")\r\n                            c++;\r\n                        if (c >= 3) {\r\n                            front[idx] = \"cargo\";\r\n                        }\r\n                    }\r\n                    else\r\n            */ if (front[idx] == \"assembler_b\") {\r\n                front[getArrayIndex(cols, i, k - 1)] = \"assembler_t\";\r\n            }\r\n            else if (front[idx] == \"assembler_t\") {\r\n                front[getArrayIndex(cols, i, k + 1)] = \"assembler_b\";\r\n            }\r\n            if (front[idx] == \"blast_b\") {\r\n                front[getArrayIndex(cols, i, k - 1)] = \"blast_t\";\r\n            }\r\n            else if (front[idx] == \"blast_t\") {\r\n                front[getArrayIndex(cols, i, k + 1)] = \"blast_b\";\r\n            }\r\n            if (front[idx] == \"stone_br\") {\r\n                front[getArrayIndex(cols, i, k - 1)] = \"stone_tr\";\r\n                front[getArrayIndex(cols, i - 1, k - 1)] = \"stone_tl\";\r\n                front[getArrayIndex(cols, i - 1, k)] = \"stone_bl\";\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction makeHalls(rows, cols, front, back) {\r\n    for (var k = 0; k < rows; k++) {\r\n        for (var i = 0; i < cols; i++) {\r\n            var idx = getArrayIndex(cols, i, k);\r\n            if (front[idx] == \"interiorwall\") {\r\n                var idxl = getArrayIndex(cols, i - 1, k);\r\n                var idxr = getArrayIndex(cols, i + 1, k);\r\n                var idxu = getArrayIndex(cols, i, k - 1);\r\n                var idxd = getArrayIndex(cols, i, k + 1);\r\n                if (front[idxu] == \"interiorwall\" && front[idxd] == \"interiorwall\" && front[idxl] == \"inner\" && back[idxr] == \"inner\") {\r\n                    var idxld = getArrayIndex(cols, i - 1, k + 1);\r\n                    var idxrd = getArrayIndex(cols, i + 1, k + 1);\r\n                    if (front[idxld] == \"interiorwall\" && front[idxrd] == \"interiorwall\") {\r\n                        front[idx] = \"inner\";\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction wrapInArmor(rows, cols, front, back) {\r\n    for (var k = 0; k < rows; k++) {\r\n        for (var i = 0; i < cols; i++) {\r\n            var idx = getArrayIndex(cols, i, k);\r\n            if (back[idx] == \"sky\") {\r\n                var idxl = getArrayIndex(cols, i - 1, k);\r\n                var idxr = getArrayIndex(cols, i + 1, k);\r\n                var idxu = getArrayIndex(cols, i, k - 1);\r\n                var idxd = getArrayIndex(cols, i, k + 1);\r\n                if (back[idxu] == \"interiorwall\" || back[idxd] == \"interiorwall\" || back[idxl] == \"interiorwall\" || back[idxr] == \"interiorwall\") {\r\n                    back[idx] = \"armor\";\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nexport default function setPageBackground() {\r\n    if (isPhone)\r\n        return;\r\n    let tail = '</svg>';\r\n    let w = 64 * SCALE;\r\n    let h = 64 * SCALE;\r\n    let x = 0;\r\n    let y = 0;\r\n    //var height = findHighestNode(0, document.documentElement.childNodes);\r\n    let body = document.body;\r\n    let html = document.documentElement;\r\n    var rh = Math.max(body.offsetHeight, html.clientHeight, html.offsetHeight, window.innerHeight, document.body.clientHeight);\r\n    var rw = Math.max(window.innerWidth, document.body.clientWidth);\r\n    //console.log(rw+\" x \"+rh);\r\n    let rows = Math.ceil(rh / h);\r\n    let cols = Math.ceil(rw / w);\r\n    let tw = cols * w;\r\n    let th = rows * h;\r\n    console.log(\"Generating SE tileset with \" + cols + \" columns and \" + rows + \" rows\");\r\n    let back = new Array(cols * rows);\r\n    let front = new Array(cols * rows);\r\n    for (var k = 0; k < rows; k++) {\r\n        for (var i = 0; i < cols; i++) {\r\n            var idx = getArrayIndex(cols, i, k);\r\n            back[idx] = \"sky\";\r\n            front[idx] = \"air\";\r\n        }\r\n    }\r\n    let points = [];\r\n    for (var k = 0; k < rows * 0.75; k++) {\r\n        placeRoom(getRandomBetween(4, cols - 4), getRandomBetween(2, rows - 2), rows, cols, front, back, points);\r\n    }\r\n    makeHalls(rows, cols, front, back);\r\n    wrapInArmor(rows, cols, front, back);\r\n    makeConveyors(rows, cols, front, back, points);\r\n    let tag = \"background-content\";\r\n    let container = document.getElementById(tag);\r\n    if (container == null) {\r\n        container = document.createElement(\"div\");\r\n        container.id = tag;\r\n        console.log(\"Injecting background element.\");\r\n        document.body.prepend(container);\r\n    }\r\n    while (container.firstChild) {\r\n        container.removeChild(container.firstChild);\r\n    }\r\n    //console.log(elem);\t\r\n    let svg = document.createElementNS(svgNamespace, \"svg\");\r\n    svg.setAttributeNS(null, \"width\", rw.toString());\r\n    svg.setAttributeNS(null, \"height\", rh.toString());\r\n    svg.id = \"skybox-layer\";\r\n    //svg.style.position = \"absolute\";\r\n    if (xmas) {\r\n        var svgimg = document.createElementNS('http://www.w3.org/2000/svg', 'image');\r\n        svgimg.setAttributeNS(null, wkey, \"320\");\r\n        svgimg.setAttributeNS(null, hkey, \"320\");\r\n        svgimg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', getOrCreateImgPath(\"xmas\", \"se\"));\r\n        svgimg.setAttributeNS(null, xkey, getRandomBetween(32, rw - 350).toString());\r\n        svgimg.setAttributeNS(null, ykey, getRandomBetween(32, rw - 350).toString());\r\n        svgimg.setAttributeNS(null, viskey, visval);\r\n        svg.appendChild(svgimg);\r\n    }\r\n    if (hallow) {\r\n        var svgimg = document.createElementNS('http://www.w3.org/2000/svg', 'image');\r\n        svgimg.setAttributeNS(null, wkey, \"320\");\r\n        svgimg.setAttributeNS(null, hkey, \"320\");\r\n        svgimg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', getOrCreateImgPath(\"hallow\", \"se\"));\r\n        svgimg.setAttributeNS(null, xkey, getRandomBetween(32, rw - 350).toString());\r\n        svgimg.setAttributeNS(null, ykey, getRandomBetween(32, rw - 350).toString());\r\n        svgimg.setAttributeNS(null, viskey, visval);\r\n        svg.appendChild(svgimg);\r\n    }\r\n    for (var i = 0; i < rw; i += STARFIELD_SIZE) {\r\n        for (var k = 0; k < rh; k += STARFIELD_SIZE) {\r\n            addImage(svg, \"starfield\", i, k, STARFIELD_SIZE, STARFIELD_SIZE);\r\n        }\r\n    }\r\n    container.appendChild(svg);\r\n    let elem = document.createElement(\"div\");\r\n    elem.style.position = \"absolute\";\r\n    elem.id = \"block-layer\";\r\n    elem.className = \"tile-layer\";\r\n    container.appendChild(elem);\r\n    container.style.width = rw.toString() + \"px\";\r\n    container.style.height = rh.toString() + \"px\";\r\n    buildImage(elem, rows, cols, front, back, rw, rh);\r\n}\r\nwindow.addEventListener('resize', debounce(setPageBackground, 100));\r\n"],"sourceRoot":""}